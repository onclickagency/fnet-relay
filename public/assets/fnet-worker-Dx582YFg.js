(function(){var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(e&&(t=e(e=0)),t),s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=e=>{let n={};for(var r in e)t(n,r,{get:e[r],enumerable:!0});return n},l=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},u=(n,r,a)=>(a=n==null?{}:e(i(n)),l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));function d(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+`-`+f[e[t+4]]+f[e[t+5]]+`-`+f[e[t+6]]+f[e[t+7]]+`-`+f[e[t+8]]+f[e[t+9]]+`-`+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}var f,p=o((()=>{f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1))}));function m(){if(!h){if(typeof crypto>`u`||!crypto.getRandomValues)throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);h=crypto.getRandomValues.bind(crypto)}return h(g)}var h,g,_=o((()=>{g=new Uint8Array(16)})),v,y,b=o((()=>{v=typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),y={randomUUID:v}}));function x(e,t,n){e||={};let r=e.random??e.rng?.()??m();if(r.length<16)throw Error(`Random bytes length must be >= 16`);if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n||=0,n<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return d(r)}function S(e,t,n){return y.randomUUID&&!t&&!e?y.randomUUID():x(e,t,n)}var C,w=o((()=>{b(),_(),p(),C=S})),T=o((()=>{w()})),E=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self,n.Dexie=r())})(e,(function(){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if(typeof n!=`function`&&n!==null)throw TypeError(`Class extends value `+String(n)+` is not a constructor or null`);e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var i=typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global,a=Object.keys,o=Array.isArray;typeof Promise<`u`&&!i.Promise&&(i.Promise=Promise);function s(e,t){return typeof t==`object`&&a(t).forEach(function(n){e[n]=t[n]}),e}var c=Object.getPrototypeOf,l={}.hasOwnProperty;function u(e,t){return l.call(e,t)}function d(e,t){typeof t==`function`&&(t=t(c(e))),(typeof Reflect>`u`?a:Reflect.ownKeys)(t).forEach(function(n){p(e,n,t[n])})}var f=Object.defineProperty;function p(e,t,n,r){f(e,t,s(n&&u(n,`get`)&&typeof n.get==`function`?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function m(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,`constructor`,e),{extend:d.bind(null,e.prototype)}}}}var h=Object.getOwnPropertyDescriptor;function g(e,t){var n=h(e,t),r;return n||(r=c(e))&&g(r,t)}var _=[].slice;function v(e,t,n){return _.call(e,t,n)}function y(e,t){return t(e)}function b(e){if(!e)throw Error(`Assertion Failed`)}function x(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function S(e,t){return e.reduce(function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function C(e,t){if(typeof t==`string`&&u(e,t))return e[t];if(!t)return e;if(typeof t!=`string`){for(var n=[],r=0,i=t.length;r<i;++r){var a=C(e,t[r]);n.push(a)}return n}var o=t.indexOf(`.`);if(o!==-1){var s=e[t.substr(0,o)];return s==null?void 0:C(s,t.substr(o+1))}}function w(e,t,n){if(!(!e||t===void 0)&&!(`isFrozen`in Object&&Object.isFrozen(e)))if(typeof t!=`string`&&`length`in t){b(typeof n!=`string`&&`length`in n);for(var r=0,i=t.length;r<i;++r)w(e,t[r],n[r])}else{var a=t.indexOf(`.`);if(a!==-1){var s=t.substr(0,a),c=t.substr(a+1);if(c===``)n===void 0?o(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var l=e[s];(!l||!u(e,s))&&(l=e[s]={}),w(l,c,n)}}else n===void 0?o(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function T(e,t){typeof t==`string`?w(e,t,void 0):`length`in t&&[].map.call(t,function(t){w(e,t,void 0)})}function E(e){var t={};for(var n in e)u(e,n)&&(t[n]=e[n]);return t}var D=[].concat;function O(e){return D.apply([],e)}var k=`BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey`.split(`,`).concat(O([8,16,32,64].map(function(e){return[`Int`,`Uint`,`Float`].map(function(t){return t+e+`Array`})}))).filter(function(e){return i[e]}),A=new Set(k.map(function(e){return i[e]}));function j(e){var t={};for(var n in e)if(u(e,n)){var r=e[n];t[n]=!r||typeof r!=`object`||A.has(r.constructor)?r:j(r)}return t}function M(e){for(var t in e)if(u(e,t))return!1;return!0}var N=null;function P(e){N=new WeakMap;var t=F(e);return N=null,t}function F(e){if(!e||typeof e!=`object`)return e;var t=N.get(e);if(t)return t;if(o(e)){t=[],N.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(F(e[n]))}else if(A.has(e.constructor))t=e;else{var i=c(e);for(var a in t=i===Object.prototype?{}:Object.create(i),N.set(e,t),e)u(e,a)&&(t[a]=F(e[a]))}return t}var I={}.toString;function L(e){return I.call(e).slice(8,-1)}var R=typeof Symbol<`u`?Symbol.iterator:`@@iterator`,z=typeof R==`symbol`?function(e){var t;return e!=null&&(t=e[R])&&t.apply(e)}:function(){return null};function B(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var V={};function H(e){var t,n,r,i;if(arguments.length===1){if(o(e))return e.slice();if(this===V&&typeof e==`string`)return[e];if(i=z(e)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(e==null)return[e];if(t=e.length,typeof t==`number`){for(n=Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=Array(t);t--;)n[t]=arguments[t];return n}var U=typeof Symbol<`u`?function(e){return e[Symbol.toStringTag]===`AsyncFunction`}:function(){return!1},W=[`Modify`,`Bulk`,`OpenFailed`,`VersionChange`,`Schema`,`Upgrade`,`InvalidTable`,`MissingAPI`,`NoSuchDatabase`,`InvalidArgument`,`SubTransaction`,`Unsupported`,`Internal`,`DatabaseClosed`,`PrematureCommit`,`ForeignAwait`],G=[`Unknown`,`Constraint`,`Data`,`TransactionInactive`,`ReadOnly`,`Version`,`NotFound`,`InvalidState`,`InvalidAccess`,`Abort`,`Timeout`,`QuotaExceeded`,`Syntax`,`DataClone`],K=W.concat(G),ee={VersionChanged:`Database version changed by other database connection`,DatabaseClosed:`Database has been closed`,Abort:`Transaction aborted`,TransactionInactive:`Transaction has already completed or failed`,MissingAPI:`IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb`};function q(e,t){this.name=e,this.message=t}m(q).from(Error).extend({toString:function(){return this.name+`: `+this.message}});function te(e,t){return e+`. Errors: `+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join(`
`)}function ne(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=te(e,t)}m(ne).from(q);function re(e,t){this.name=`BulkError`,this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=te(e,this.failures)}m(re).from(q);var ie=K.reduce(function(e,t){return e[t]=t+`Error`,e},{}),ae=q,J=K.reduce(function(e,t){var n=t+`Error`;function r(e,r){this.name=n,e?typeof e==`string`?(this.message=`${e}${r?`
 `+r:``}`,this.inner=r||null):typeof e==`object`&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=ee[t]||n,this.inner=null)}return m(r).from(ae),e[t]=r,e},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var oe=G.reduce(function(e,t){return e[t+`Error`]=J[t],e},{});function se(e,t){if(!e||e instanceof q||e instanceof TypeError||e instanceof SyntaxError||!e.name||!oe[e.name])return e;var n=new oe[e.name](t||e.message,e);return`stack`in e&&p(n,`stack`,{get:function(){return this.inner.stack}}),n}var ce=K.reduce(function(e,t){return[`Syntax`,`Type`,`Range`].indexOf(t)===-1&&(e[t+`Error`]=J[t]),e},{});ce.ModifyError=ne,ce.DexieError=q,ce.BulkError=re;function Y(){}function le(e){return e}function ue(e,t){return e==null||e===le?t:function(n){return t(e(n))}}function de(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function fe(e,t){return e===Y?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?de(r,this.onsuccess):r),i&&(this.onerror=this.onerror?de(i,this.onerror):i),a===void 0?n:a}}function pe(e,t){return e===Y?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?de(n,this.onsuccess):n),r&&(this.onerror=this.onerror?de(r,this.onerror):r)}}function me(e,t){return e===Y?t:function(n){var r=e.apply(this,arguments);s(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?de(i,this.onsuccess):i),a&&(this.onerror=this.onerror?de(a,this.onerror):a),r===void 0?o===void 0?void 0:o:s(r,o)}}function he(e,t){return e===Y?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function ge(e,t){return e===Y?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then==`function`){for(var r=this,i=arguments.length,a=Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}var _e=typeof location<`u`&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ve(e,t){_e=e}var ye={},be=100,xe=typeof Promise>`u`?[]:(function(){var e=Promise.resolve();if(typeof crypto>`u`||!crypto.subtle)return[e,c(e),e];var t=crypto.subtle.digest(`SHA-512`,new Uint8Array([0]));return[t,c(t),e]})(),Se=xe[0],Ce=xe[1],we=xe[2],Te=Ce&&Ce.then,Ee=Se&&Se.constructor,De=!!we;function Oe(){queueMicrotask(Ke)}var ke=function(e,t){Ie.push([e,t]),je&&=(Oe(),!1)},Ae=!0,je=!0,Me=[],Ne=[],Pe=le,Fe={id:`global`,global:!0,ref:0,unhandleds:[],onunhandled:Y,pgp:!1,env:{},finalize:Y},X=Fe,Ie=[],Le=0,Re=[];function Z(e){if(typeof this!=`object`)throw TypeError(`Promises must be constructed via new`);this._listeners=[],this._lib=!1;var t=this._PSD=X;if(typeof e!=`function`){if(e!==ye)throw TypeError(`Not a function`);this._state=arguments[1],this._value=arguments[2],this._state===!1&&He(this,this._value);return}this._state=null,this._value=null,++t.ref,Ve(this,e)}var ze={get:function(){var e=X,t=at;function n(n,r){var i=this,a=!e.global&&(e!==X||t!==at),o=a&&!lt(),s=new Z(function(t,s){We(i,new Be(gt(n,e,a,o),gt(r,e,a,o),t,s,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=ye,n},set:function(e){p(this,`then`,e&&e.prototype===ye?ze:{get:function(){return e},set:ze.set})}};d(Z.prototype,{then:ze,_then:function(e,t){We(this,new Be(null,null,e,t,X))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t==`function`?this.then(null,function(e){return e instanceof t?n(e):$e(e)}):this.then(null,function(e){return e&&e.name===t?n(e):$e(e)})},finally:function(e){return this.then(function(t){return Z.resolve(e()).then(function(){return t})},function(t){return Z.resolve(e()).then(function(){return $e(t)})})},timeout:function(e,t){var n=this;return e<1/0?new Z(function(r,i){var a=setTimeout(function(){return i(new J.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<`u`&&Symbol.toStringTag&&p(Z.prototype,Symbol.toStringTag,`Dexie.Promise`),Fe.env=mt();function Be(e,t,n,r,i){this.onFulfilled=typeof e==`function`?e:null,this.onRejected=typeof t==`function`?t:null,this.resolve=n,this.reject=r,this.psd=i}d(Z,{all:function(){var e=H.apply(null,arguments).map(ut);return new Z(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return Z.resolve(i).then(function(n){e[a]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof Z?e:e&&typeof e.then==`function`?new Z(function(t,n){e.then(t,n)}):new Z(ye,!0,e)},reject:$e,race:function(){var e=H.apply(null,arguments).map(ut);return new Z(function(t,n){e.map(function(e){return Z.resolve(e).then(t,n)})})},PSD:{get:function(){return X},set:function(e){return X=e}},totalEchoes:{get:function(){return at}},newPSD:st,usePSD:ht,scheduler:{get:function(){return ke},set:function(e){ke=e}},rejectionMapper:{get:function(){return Pe},set:function(e){Pe=e}},follow:function(e,t){return new Z(function(n,r){return st(function(t,n){var r=X;r.unhandleds=[],r.onunhandled=n,r.finalize=de(function(){var e=this;Xe(function(){e.unhandleds.length===0?t():n(e.unhandleds[0])})},r.finalize),e()},t,n,r)})}}),Ee&&(Ee.allSettled&&p(Z,`allSettled`,function(){var e=H.apply(null,arguments).map(ut);return new Z(function(t){e.length===0&&t([]);var n=e.length,r=Array(n);e.forEach(function(e,i){return Z.resolve(e).then(function(e){return r[i]={status:`fulfilled`,value:e}},function(e){return r[i]={status:`rejected`,reason:e}}).then(function(){return--n||t(r)})})})}),Ee.any&&typeof AggregateError<`u`&&p(Z,`any`,function(){var e=H.apply(null,arguments).map(ut);return new Z(function(t,n){e.length===0&&n(AggregateError([]));var r=e.length,i=Array(r);e.forEach(function(e,a){return Z.resolve(e).then(function(e){return t(e)},function(e){i[a]=e,--r||n(AggregateError(i))})})})}),Ee.withResolvers&&(Z.withResolvers=Ee.withResolvers));function Ve(e,t){try{t(function(t){if(e._state===null){if(t===e)throw TypeError(`A promise cannot be resolved with itself.`);var n=e._lib&&qe();t&&typeof t.then==`function`?Ve(e,function(e,n){t instanceof Z?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,Ue(e)),n&&Je()}},He.bind(null,e))}catch(t){He(e,t)}}function He(e,t){if(Ne.push(t),e._state===null){var n=e._lib&&qe();t=Pe(t),e._state=!1,e._value=t,Ze(e),Ue(e),n&&Je()}}function Ue(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)We(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Le===0&&(++Le,ke(function(){--Le===0&&Ye()},[]))}function We(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Le,ke(Ge,[n,e,t])}function Ge(e,t,n){try{var r,i=t._value;!t._state&&Ne.length&&(Ne=[]),r=_e&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),!t._state&&Ne.indexOf(i)===-1&&Qe(t),n.resolve(r)}catch(e){n.reject(e)}finally{--Le===0&&Ye(),--n.psd.ref||n.psd.finalize()}}function Ke(){ht(Fe,function(){qe()&&Je()})}function qe(){var e=Ae;return Ae=!1,je=!1,e}function Je(){var e,t,n;do for(;Ie.length>0;)for(e=Ie,Ie=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Ie.length>0);Ae=!0,je=!0}function Ye(){var e=Me;Me=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Re.slice(0),n=t.length;n;)t[--n]()}function Xe(e){function t(){e(),Re.splice(Re.indexOf(t),1)}Re.push(t),++Le,ke(function(){--Le===0&&Ye()},[])}function Ze(e){Me.some(function(t){return t._value===e._value})||Me.push(e)}function Qe(e){for(var t=Me.length;t;)if(Me[--t]._value===e._value){Me.splice(t,1);return}}function $e(e){return new Z(ye,!1,e)}function et(e,t){var n=X;return function(){var r=qe(),i=X;try{return pt(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{pt(i,!1),r&&Je()}}}var tt={awaits:0,echoes:0,id:0},nt=0,rt=[],it=0,at=0,ot=0;function st(e,t,n,r){var i=X,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++ot,Fe.env,a.env=De?{Promise:Z,PromiseProp:{value:Z,configurable:!0,writable:!0},all:Z.all,race:Z.race,allSettled:Z.allSettled,any:Z.any,resolve:Z.resolve,reject:Z.reject}:{},t&&s(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=ht(a,e,n,r);return a.ref===0&&a.finalize(),o}function ct(){return tt.id||=++nt,++tt.awaits,tt.echoes+=be,tt.id}function lt(){return tt.awaits?(--tt.awaits===0&&(tt.id=0),tt.echoes=tt.awaits*be,!0):!1}(``+Te).indexOf(`[native code]`)===-1&&(ct=lt=Y);function ut(e){return tt.echoes&&e&&e.constructor===Ee?(ct(),e.then(function(e){return lt(),e},function(e){return lt(),vt(e)})):e}function dt(e){++at,(!tt.echoes||--tt.echoes===0)&&(tt.echoes=tt.awaits=tt.id=0),rt.push(X),pt(e,!0)}function ft(){var e=rt[rt.length-1];rt.pop(),pt(e,!1)}function pt(e,t){var n=X;if((t?tt.echoes&&(!it++||e!==X):it&&(!--it||e!==X))&&queueMicrotask(t?dt.bind(null,e):ft),e!==X&&(X=e,n===Fe&&(Fe.env=mt()),De)){var r=Fe.env.Promise,a=e.env;(n.global||e.global)&&(Object.defineProperty(i,`Promise`,a.PromiseProp),r.all=a.all,r.race=a.race,r.resolve=a.resolve,r.reject=a.reject,a.allSettled&&(r.allSettled=a.allSettled),a.any&&(r.any=a.any))}}function mt(){var e=i.Promise;return De?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,`Promise`),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ht(e,t,n,r,i){var a=X;try{return pt(e,!0),t(n,r,i)}finally{pt(a,!1)}}function gt(e,t,n,r){return typeof e==`function`?function(){var i=X;n&&ct(),pt(t,!0);try{return e.apply(this,arguments)}finally{pt(i,!1),r&&queueMicrotask(lt)}}:e}function _t(e){Promise===Ee&&tt.echoes===0?it===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var vt=Z.reject;function yt(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!X.letThrough&&!e._vip){if(e._state.openComplete)return vt(new J.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return vt(new J.DatabaseClosed);e.open().catch(Y)}return e._state.dbReadyPromise.then(function(){return yt(e,t,n,r)})}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===ie.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn(`Dexie: Need to reopen db`),e.close({disableAutoOpen:!1}),e.open().then(function(){return yt(e,t,n,r)})):vt(i)}return i._promise(t,function(e,t){return st(function(){return X.trans=i,r(e,t,i)})}).then(function(e){if(t===`readwrite`)try{i.idbtrans.commit()}catch{}return t===`readonly`?e:i._completion.then(function(){return e})})}}var bt=`4.2.1`,xt=`ï¿¿`,St=-1/0,Ct=`Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.`,wt=`String expected.`,Tt=[],Et=`__dbnames`,Dt=`readonly`,Ot=`readwrite`;function kt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var At={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function jt(e){return typeof e==`string`&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=P(t),delete t[e]),t}:function(e){return e}}function Mt(){throw J.Type(`Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.`)}function Q(e,t){try{var n=Ft(e),r=Ft(t);if(n!==r)return n===`Array`?1:r===`Array`?-1:n===`binary`?1:r===`binary`?-1:n===`string`?1:r===`string`?-1:n===`Date`?1:r===`Date`?-1:NaN;switch(n){case`number`:case`Date`:case`string`:return e>t?1:e<t?-1:0;case`binary`:return Pt(It(e),It(t));case`Array`:return Nt(e,t)}}catch{}return NaN}function Nt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var o=Q(e[a],t[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}function Pt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}function Ft(e){var t=typeof e;if(t!==`object`)return t;if(ArrayBuffer.isView(e))return`binary`;var n=L(e);return n===`ArrayBuffer`?`binary`:n}function It(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Lt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){var r=n.updatesTable;return t?e.db.table(r).where(`k`).anyOf(t).delete():e.db.table(r).clear()})).then(function(){return n})):n}var Rt=function(){function e(e){this[`@@propmod`]=e}return e.prototype.execute=function(e){var t=this[`@@propmod`];if(t.add!==void 0){var n=t.add;if(o(n))return r(r([],o(e)?e:[],!0),n,!0).sort();if(typeof n==`number`)return(Number(e)||0)+n;if(typeof n==`bigint`)try{return BigInt(e)+n}catch{return BigInt(0)+n}throw TypeError(`Invalid term ${n}`)}if(t.remove!==void 0){var i=t.remove;if(o(i))return o(e)?e.filter(function(e){return!i.includes(e)}).sort():[];if(typeof i==`number`)return Number(e)-i;if(typeof i==`bigint`)try{return BigInt(e)-i}catch{return BigInt(0)-i}throw TypeError(`Invalid subtrahend ${i}`)}var a=t.replacePrefix?.[0];return a&&typeof e==`string`&&e.startsWith(a)?t.replacePrefix[1]+e.substring(a.length):e},e}();function zt(e,t){for(var n=a(t),r=n.length,i=!1,o=0;o<r;++o){var s=n[o],c=t[s],l=C(e,s);c instanceof Rt?(w(e,s,c.execute(l)),i=!0):l!==c&&(w(e,s,c),i=!0)}return i}var Bt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||X.trans,i=this.name,a=_e&&typeof console<`u`&&console.createTask&&console.createTask(`Dexie: ${e===`readonly`?`read`:`write`} ${this.name}`);function o(e,n,r){if(!r.schema[i])throw new J.NotFound(`Table `+i+` not part of transaction`);return t(r.idbtrans,r)}var s=qe();try{var c=r&&r.db._novip===this.db._novip?r===X.trans?r._promise(e,o,n):st(function(){return r._promise(e,o,n)},{trans:r,transless:X.transless||X}):yt(this.db,e,[this.name],o);return a&&(c._consoleTask=a,c=c.catch(function(e){return console.trace(e),vt(e)})),c}finally{s&&Je()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?vt(new J.Type(`Invalid argument to Table.get()`)):this._trans(`readonly`,function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},e.prototype.where=function(e){if(typeof e==`string`)return new this.db.WhereClause(this,e);if(o(e))return new this.db.WhereClause(this,`[${e.join(`+`)}]`);var t=a(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return e.keyPath.indexOf(t)>=0})){for(var n=0;n<t.length;++n)if(t.indexOf(e.keyPath[n])===-1)return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==xt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&_e&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit from a compound index [${t.join(`+`)}]`);var i=this.schema.idxByName;function s(e,t){return Q(e,t)===0}var c=t.reduce(function(t,n){var r=t[0],a=t[1],c=i[n],l=e[n];return[r||c,r||!c?kt(a,c&&c.multi?function(e){var t=C(e,n);return o(t)&&t.some(function(e){return s(l,e)})}:function(e){return s(l,C(e,n))}):a]},[null,null]),l=c[0],u=c[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(u):n?this.filter(u):this.where(t).equals(``)},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,o(e)?`[${e.join(`+`)}]`:e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var n=this,r=n.db,i=n.name;this.schema.mappedClass=e,e.prototype instanceof Mt&&(e=function(e){t(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(n.prototype,`db`,{get:function(){return r},enumerable:!1,configurable:!0}),n.prototype.table=function(){return i},n}(e));for(var a=new Set,o=e.prototype;o;o=c(o))Object.getOwnPropertyNames(o).forEach(function(e){return a.add(e)});var s=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!a.has(r))try{n[r]=t[r]}catch{}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=s,this.hook(`reading`,s),e},e.prototype.defineClass=function(){function e(e){s(this,e)}return this.mapToClass(e)},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=jt(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`add`,keys:t==null?null:[t],values:[o]})}).then(function(e){return e.numFailures?Z.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{w(e,a,t)}catch{}return t})},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans(`readwrite`,function(i){return n.core.get({trans:i,key:e}).then(function(a){var o=a??{};return zt(o,t),r&&w(o,r,e),n.core.mutate({trans:i,type:`put`,values:[o],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?Z.reject(e.failures[0]):!!a})})})},e.prototype.update=function(e,t){if(typeof e==`object`&&!o(e)){var n=C(e,this.schema.primKey.keyPath);return n===void 0?vt(new J.InvalidArgument(`Given object does not contain its primary key`)):this.where(`:id`).equals(n).modify(t)}else return this.where(`:id`).equals(e).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=jt(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`put`,values:[o],keys:t==null?null:[t]})}).then(function(e){return e.numFailures?Z.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{w(e,a,t)}catch{}return t})},e.prototype.delete=function(e){var t=this;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:[e]}).then(function(n){return Lt(t,[e],n)}).then(function(e){return e.numFailures?Z.reject(e.failures[0]):void 0})})},e.prototype.clear=function(){var e=this;return this._trans(`readwrite`,function(t){return e.core.mutate({trans:t,type:`deleteRange`,range:At}).then(function(t){return Lt(e,null,t)})}).then(function(e){return e.numFailures?Z.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var t=this;return this._trans(`readonly`,function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0;n||=i?void 0:t;var a=n?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,s=n.keyPath;if(s&&i)throw new J.InvalidArgument(`bulkAdd(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new J.InvalidArgument(`Arguments objects and keys must have the same length`);var c=e.length,l=s&&o?e.map(jt(s)):e;return r.core.mutate({trans:t,type:`add`,keys:i,values:l,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,o=e.failures,s=a?n:i;if(t===0)return s;throw new re(`${r.name}.bulkAdd(): ${t} of ${c} operations failed`,o)})})},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0;n||=i?void 0:t;var a=n?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,s=n.keyPath;if(s&&i)throw new J.InvalidArgument(`bulkPut(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new J.InvalidArgument(`Arguments objects and keys must have the same length`);var c=e.length,l=s&&o?e.map(jt(s)):e;return r.core.mutate({trans:t,type:`put`,keys:i,values:l,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,o=e.failures,s=a?n:i;if(t===0)return s;throw new re(`${r.name}.bulkPut(): ${t} of ${c} operations failed`,o)})})},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),a=[];return this._trans(`readwrite`,function(o){return n.getMany({trans:o,keys:r,cache:`clone`}).then(function(s){var c=[],l=[];e.forEach(function(e,n){var r=e.key,i=e.changes,o=s[n];if(o){for(var u=0,d=Object.keys(i);u<d.length;u++){var f=d[u],p=i[f];if(f===t.schema.primKey.keyPath){if(Q(p,r)!==0)throw new J.Constraint(`Cannot update primary key in bulkUpdate()`)}else w(o,f,p)}a.push(n),c.push(r),l.push(o)}});var u=c.length;return n.mutate({trans:o,type:`put`,keys:c,values:l,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(n===0)return u;for(var i=0,o=Object.keys(r);i<o.length;i++){var s=o[i],c=a[Number(s)];if(c!=null){var l=r[s];delete r[s],r[c]=l}}throw new re(`${t.name}.bulkUpdate(): ${n} of ${u} operations failed`,r)})})})},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:e}).then(function(n){return Lt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,a=e.failures;if(r===0)return i;throw new re(`${t.name}.bulkDelete(): ${r} of ${n} operations failed`,a)})},e}();function Vt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,a=Array(i-1);--i;)a[i-1]=arguments[i];return t[n].subscribe.apply(null,a),e}else if(typeof n==`string`)return t[n]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(e,r,i){if(typeof e==`object`)return c(e);r||=he,i||=Y;var a={subscribers:[],fire:i,subscribe:function(e){a.subscribers.indexOf(e)===-1&&(a.subscribers.push(e),a.fire=r(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter(function(t){return t!==e}),a.fire=a.subscribers.reduce(r,i)}};return t[e]=n[e]=a,a}function c(e){a(e).forEach(function(t){var n=e[t];if(o(n))s(t,e[t][0],e[t][1]);else if(n===`asap`)var r=s(t,le,function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){x(function(){e.apply(null,t)})})});else throw new J.InvalidArgument(`Invalid event config`)})}}function Ht(e,t){return m(t).from({prototype:e}),t}function Ut(e){return Ht(Bt.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Vt(null,{creating:[fe,Y],reading:[ue,le],updating:[me,Y],deleting:[pe,Y]})})}function Wt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Gt(e,t){e.filter=kt(e.filter,t)}function Kt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return kt(r(),t())}:t,e.justLimit=n&&!r}function qt(e,t){e.isMatch=kt(e.isMatch,t)}function Jt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new J.Schema(`KeyPath `+e.index+` on object store `+t.name+` is not indexed`);return n}function Yt(e,t,n){var r=Jt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir===`prev`,unique:!!e.unique,query:{index:r,range:e.range}})}function Xt(e,t,n,r){var i=e.replayFilter?kt(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(e,n,r){if(!i||i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})){var o=n.primaryKey,s=``+o;s===`[object ArrayBuffer]`&&(s=``+new Uint8Array(o)),u(a,s)||(a[s]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),Zt(Yt(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}else return Zt(Yt(e,r,n),kt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Zt(e,t,n,r){var i=et(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};(!t||t(e,function(e){return n=e},function(t){e.stop(t),n=Y},function(t){e.fail(t),n=Y}))&&i(e.value,e,function(e){return n=e}),n()})})}var Qt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,vt.bind(null,n.error)):n.table._trans(`readonly`,e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,vt.bind(null,t.error)):t.table._trans(`readwrite`,e,`locked`)},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=kt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Xt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Xt(t,e,n,t.table.core)})},e.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(Wt(n,!0))return r.count({trans:e,query:{index:Jt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Xt(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(`.`).reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o=this._ctx.dir===`next`?1:-1;function s(e,t){var n=a(e,i),r=a(t,i);return Q(n,r)*o}return this.toArray(function(e){return e.sort(s)}).then(t)},e.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if(n.dir===`next`&&Wt(n,!0)&&n.limit>0){var r=n.valueMapper,i=Jt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){var t=e.result;return r?t.map(r):t})}else{var a=[];return Xt(n,function(e){return a.push(e)},e,n.table.core).then(function(){return a})}},e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0?this:(t.offset+=e,Wt(t)?Kt(t,function(){var t=e;return function(e,n){return t===0?!0:t===1?(--t,!1):(n(function(){e.advance(t),t=0}),!1)}}):Kt(t,function(){var t=e;return function(){return--t<0}}),this)},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Kt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},e.prototype.until=function(e,t){return Gt(this._ctx,function(n,r,i){return e(n.value)?(r(i),t):!0}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Gt(this._ctx,function(t){return e(t.value)}),qt(this._ctx,e),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir===`prev`?`next`:`prev`,this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique=`unique`,this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir===`next`&&Wt(t,!0)&&t.limit>0)return this._read(function(e){var n=Jt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique=`unique`,this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Gt(this._ctx,function(e){var t=e.primaryKey.toString(),r=u(n,t);return n[t]=!0,!r}),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i=typeof e==`function`?e:function(t){return zt(t,e)},o=n.table.core,s=o.schema.primaryKey,c=s.outbound,l=s.extractKey,u=200,d=t.db._options.modifyChunkSize;d&&(u=typeof d==`object`?d[o.name]||d[`*`]||200:d);var f=[],p=0,m=[],h=function(e,t){var n=t.failures,r=t.numFailures;p+=e-r;for(var i=0,o=a(n);i<o.length;i++){var s=o[i];f.push(n[s])}},g=e===$t;return t.clone().primaryKeys().then(function(t){var a=Wt(n)&&n.limit===1/0&&(typeof e!=`function`||g)&&{index:n.index,range:n.range},s=function(d){var f=Math.min(u,t.length-d),p=t.slice(d,d+f);return(g?Promise.resolve([]):o.getMany({trans:r,keys:p,cache:`immutable`})).then(function(m){var _=[],v=[],y=c?[]:null,b=g?p:[];if(!g)for(var x=0;x<f;++x){var S=m[x],C={value:P(S),primKey:t[d+x]};i.call(C,C.value,C)!==!1&&(C.value==null?b.push(t[d+x]):!c&&Q(l(S),l(C.value))!==0?(b.push(t[d+x]),_.push(C.value)):(v.push(C.value),c&&y.push(t[d+x])))}return Promise.resolve(_.length>0&&o.mutate({trans:r,type:`add`,values:_}).then(function(e){for(var t in e.failures)b.splice(parseInt(t),1);h(_.length,e)})).then(function(){return(v.length>0||a&&typeof e==`object`)&&o.mutate({trans:r,type:`put`,keys:y,values:v,criteria:a,changeSpec:typeof e!=`function`&&e,isAdditionalChunk:d>0}).then(function(e){return h(v.length,e)})}).then(function(){return(b.length>0||a&&g)&&o.mutate({trans:r,type:`delete`,keys:b,criteria:a,isAdditionalChunk:d>0}).then(function(e){return Lt(n.table,b,e)}).then(function(e){return h(b.length,e)})}).then(function(){return t.length>d+f&&s(d+u)})})};return s(0).then(function(){if(f.length>0)throw new ne(`Error modifying one or more objects`,f,p,m);return t.length})})})},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Wt(e)&&!e.table.schema.yProps&&(e.isPrimKey||t.type===3)?this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:`deleteRange`,range:i}).then(function(e){var n=e.failures,r=e.numFailures;if(r)throw new ne(`Could not delete some values`,Object.keys(n).map(function(e){return n[e]}),t-r);return t-r})})}):this.modify($t)},e}(),$t=function(e,t){return t.value=null};function en(e){return Ht(Qt.prototype,function(t,n){this.db=e;var r=At,i=null;if(n)try{r=n()}catch(e){i=e}var a=t._ctx,o=a.table,s=o.hook.reading.fire;this._ctx={table:o,index:a.index,isPrimKey:!a.index||o.schema.primKey.keyPath&&a.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:`next`,unique:``,algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:a.or,valueMapper:s===le?null:s}})}function tn(e,t){return e<t?-1:e===t?0:1}function nn(e,t){return e>t?-1:e===t?0:1}function rn(e,t,n){var r=e instanceof fn?new e.Collection(e):e;return r._ctx.error=n?new n(t):TypeError(t),r}function an(e){return new e.Collection(e,function(){return dn(``)}).limit(0)}function on(e){return e===`next`?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function sn(e){return e===`next`?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function cn(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return o<r.length&&a===`next`?e+n.substr(e.length):o<e.length&&a===`prev`?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function ln(e,t,n,r){var i,a,o,s,c,l,u,d=n.length;if(!n.every(function(e){return typeof e==`string`}))return rn(e,wt);function f(e){i=on(e),a=sn(e),o=e===`next`?tn:nn;var t=n.map(function(e){return{lower:a(e),upper:i(e)}}).sort(function(e,t){return o(e.lower,t.lower)});s=t.map(function(e){return e.upper}),c=t.map(function(e){return e.lower}),l=e,u=e===`next`?``:r}f(`next`);var p=new e.Collection(e,function(){return un(s[0],c[d-1]+r)});p._ondirectionchange=function(e){f(e)};var m=0;return p._addAlgorithm(function(e,n,r){var i=e.key;if(typeof i!=`string`)return!1;var f=a(i);if(t(f,c,m))return!0;for(var p=null,h=m;h<d;++h){var g=cn(i,f,s[h],c[h],o,l);g===null&&p===null?m=h+1:(p===null||o(p,g)>0)&&(p=g)}return n(p===null?r:function(){e.continue(p+u)}),!1}),p}function un(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function dn(e){return{type:1,lower:e,upper:e}}var fn=function(){function e(){}return Object.defineProperty(e.prototype,`Collection`,{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(n||r)&&!(n&&r)?an(this):new this.Collection(this,function(){return un(e,t,!n,!r)})}catch{return rn(this,Ct)}},e.prototype.equals=function(e){return e==null?rn(this,Ct):new this.Collection(this,function(){return dn(e)})},e.prototype.above=function(e){return e==null?rn(this,Ct):new this.Collection(this,function(){return un(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return e==null?rn(this,Ct):new this.Collection(this,function(){return un(e,void 0,!1)})},e.prototype.below=function(e){return e==null?rn(this,Ct):new this.Collection(this,function(){return un(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return e==null?rn(this,Ct):new this.Collection(this,function(){return un(void 0,e)})},e.prototype.startsWith=function(e){return typeof e==`string`?this.between(e,e+xt,!0,!0):rn(this,wt)},e.prototype.startsWithIgnoreCase=function(e){return e===``?this.startsWith(e):ln(this,function(e,t){return e.indexOf(t[0])===0},[e],xt)},e.prototype.equalsIgnoreCase=function(e){return ln(this,function(e,t){return e===t[0]},[e],``)},e.prototype.anyOfIgnoreCase=function(){var e=H.apply(V,arguments);return e.length===0?an(this):ln(this,function(e,t){return t.indexOf(e)!==-1},e,``)},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=H.apply(V,arguments);return e.length===0?an(this):ln(this,function(e,t){return t.some(function(t){return e.indexOf(t)===0})},e,xt)},e.prototype.anyOf=function(){var e=this,t=H.apply(V,arguments),n=this._cmp;try{t.sort(n)}catch{return rn(this,Ct)}if(t.length===0)return an(this);var r=new this.Collection(this,function(){return un(t[0],t[t.length-1])});r._ondirectionchange=function(r){n=r===`next`?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,a){for(var o=e.key;n(o,t[i])>0;)if(++i,i===t.length)return r(a),!1;return n(o,t[i])===0?!0:(r(function(){e.continue(t[i])}),!1)}),r},e.prototype.notEqual=function(e){return this.inAnyRange([[St,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=H.apply(V,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return rn(this,Ct)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[St,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,s=this._max;if(e.length===0)return an(this);if(!e.every(function(e){return e[0]!==void 0&&e[1]!==void 0&&i(e[0],e[1])<=0}))return rn(this,`First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower`,J.InvalidArgument);var c=!t||t.includeLowers!==!1,l=t&&t.includeUppers===!0;function u(e,t){for(var n=0,i=e.length;n<i;++n){var a=e[n];if(r(t[0],a[1])<0&&r(t[1],a[0])>0){a[0]=o(a[0],t[0]),a[1]=s(a[1],t[1]);break}}return n===i&&e.push(t),e}var d=i;function f(e,t){return d(e[0],t[0])}var p;try{p=e.reduce(u,[]),p.sort(f)}catch{return rn(this,Ct)}var m=0,h=l?function(e){return i(e,p[m][1])>0}:function(e){return i(e,p[m][1])>=0},g=c?function(e){return a(e,p[m][0])>0}:function(e){return a(e,p[m][0])>=0};function _(e){return!h(e)&&!g(e)}var v=h,y=new this.Collection(this,function(){return un(p[0][0],p[p.length-1][1],!c,!l)});return y._ondirectionchange=function(e){e===`next`?(v=h,d=i):(v=g,d=a),p.sort(f)},y._addAlgorithm(function(e,t,r){for(var a=e.key;v(a);)if(++m,m===p.length)return t(r),!1;return _(a)?!0:(n._cmp(a,p[m][1])===0||n._cmp(a,p[m][0])===0||t(function(){d===i?e.continue(p[m][0]):e.continue(p[m][1])}),!1)}),y},e.prototype.startsWithAnyOf=function(){var e=H.apply(V,arguments);return e.every(function(e){return typeof e==`string`})?e.length===0?an(this):this.inAnyRange(e.map(function(e){return[e,e+xt]})):rn(this,`startsWithAnyOf() only works with strings`)},e}();function pn(e){return Ht(fn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:n===`:id`?null:n,or:r},this._cmp=this._ascending=Q,this._descending=function(e,t){return Q(t,e)},this._max=function(e,t){return Q(e,t)>0?e:t},this._min=function(e,t){return Q(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})}function mn(e){return et(function(t){return hn(t),e(t.target.error),!1})}function hn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var gn=`storagemutated`,_n=`x-storagemutated-1`,vn=Vt(null,gn),yn=function(){function e(){}return e.prototype._lock=function(){return b(!X.global),++this._reculock,this._reculock===1&&!X.global&&(X.lockOwnerFor=this),this},e.prototype._unlock=function(){if(b(!X.global),--this._reculock===0)for(X.global||(X.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ht(e[1],e[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&X.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(b(!this.idbtrans),!e&&!n)switch(r&&r.name){case`DatabaseClosedError`:throw new J.DatabaseClosed(r);case`MissingAPIError`:throw new J.MissingAPI(r.message,r);default:throw new J.OpenFailed(r)}if(!this.active)throw new J.TransactionInactive;return b(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=et(function(n){hn(n),t._reject(e.error)}),e.onabort=et(function(n){hn(n),t.active&&t._reject(new J.Abort(e.error)),t.active=!1,t.on(`abort`).fire(n)}),e.oncomplete=et(function(){t.active=!1,t._resolve(),`mutatedParts`in e&&vn.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,t,n){var r=this;if(e===`readwrite`&&this.mode!==`readwrite`)return vt(new J.ReadOnly(`Transaction is readonly`));if(!this.active)return vt(new J.TransactionInactive);if(this._locked())return new Z(function(i,a){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,a)},X])});if(n)return st(function(){var e=new Z(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new Z(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Z.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return n});else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);(function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)})()}var i=t._waitingFor;return new Z(function(e,r){n.then(function(n){return t._waitingQueue.push(et(e.bind(null,n)))},function(e){return t._waitingQueue.push(et(r.bind(null,e)))}).finally(function(){t._waitingFor===i&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||={};if(u(t,e))return t[e];var n=this.schema[e];if(!n)throw new J.NotFound(`Table `+e+` not part of transaction`);var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function bn(e){return Ht(yn.prototype,function(t,n,r,i,a){var o=this;t!==`readonly`&&n.forEach(function(e){var t=r[e]?.yProps;t&&(n=n.concat(t.map(function(e){return e.updatesTable})))}),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Vt(this,`complete`,`error`,`abort`),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Z(function(e,t){o._resolve=e,o._reject=t}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(e){var t=o.active;return o.active=!1,o.on.error.fire(e),o.parent?o.parent._reject(e):t&&o.idbtrans&&o.idbtrans.abort(),vt(e)})})}function xn(e,t,n,r,i,a,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?`&`:``)+(r?`*`:``)+(i?`++`:``)+Sn(t),type:s}}function Sn(e){return typeof e==`string`?e:e?`[`+[].join.call(e,`+`)+`]`:``}function Cn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:S(n,function(e){return[e.name,e]})}}function wn(e){return e.length===1?e[0]:e}var Tn=function(e){try{return e.only([[]]),Tn=function(){return[[]]},[[]]}catch{return Tn=function(){return xt},xt}};function En(e){return e==null?function(){}:typeof e==`string`?Dn(e):function(t){return C(t,e)}}function Dn(e){return e.split(`.`).length===1?function(t){return t[e]}:function(t){return C(t,e)}}function On(e){return[].slice.call(e)}var kn=0;function An(e){return e==null?`:id`:typeof e==`string`?e:`[${e.join(`+`)}]`}function jn(e,t,n){function r(e,t){var n=On(e.objectStoreNames);return{schema:{name:e.name,tables:n.map(function(e){return t.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=o(t),i=t==null,a={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:En(t)},indexes:On(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,s=o(i),c={name:t,compound:s,keyPath:i,unique:n,multiEntry:r,extractKey:En(i)};return a[An(i)]=c,c}),getIndexByKeyPath:function(e){return a[An(e)]}};return a[`:id`]=s.primaryKey,t!=null&&(a[An(t)]=s.primaryKey),s})},hasGetAll:n.length>0&&`getAll`in t.objectStore(n[0])&&!(typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(e){if(e.type===3)return null;if(e.type===4)throw Error(`Cannot convert never type to IDBKeyRange`);var n=e.lower,r=e.upper,i=e.lowerOpen,a=e.upperOpen;return n===void 0?r===void 0?null:t.upperBound(r,!!a):r===void 0?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!a)}function a(e){var t=e.name;function n(e){var n=e.trans,r=e.type,a=e.keys,o=e.values,s=e.range;return new Promise(function(e,c){e=et(e);var l=n.objectStore(t),u=l.keyPath==null,d=r===`put`||r===`add`;if(!d&&r!==`delete`&&r!==`deleteRange`)throw Error(`Invalid operation type: `+r);var f=(a||o||{length:1}).length;if(a&&o&&a.length!==o.length)throw Error(`Given keys array must have same length as given values array.`);if(f===0)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p,m=[],h=[],g=0,_=function(e){++g,hn(e)};if(r===`deleteRange`){if(s.type===4)return e({numFailures:g,failures:h,results:[],lastResult:void 0});s.type===3?m.push(p=l.clear()):m.push(p=l.delete(i(s)))}else{var v=d?u?[o,a]:[o,null]:[a,null],y=v[0],b=v[1];if(d)for(var x=0;x<f;++x)m.push(p=b&&b[x]!==void 0?l[r](y[x],b[x]):l[r](y[x])),p.onerror=_;else for(var x=0;x<f;++x)m.push(p=l[r](y[x])),p.onerror=_}var S=function(t){var n=t.target.result;m.forEach(function(e,t){return e.error!=null&&(h[t]=e.error)}),e({numFailures:g,failures:h,results:r===`delete`?a:m.map(function(e){return e.result}),lastResult:n})};p.onerror=function(e){_(e),S(e)},p.onsuccess=S})}function r(e){var n=e.trans,r=e.values,a=e.query,o=e.reverse,s=e.unique;return new Promise(function(e,c){e=et(e);var l=a.index,u=a.range,d=n.objectStore(t),f=l.isPrimaryKey?d:d.index(l.name),p=o?s?`prevunique`:`prev`:s?`nextunique`:`next`,m=r||!(`openKeyCursor`in f)?f.openCursor(i(u),p):f.openKeyCursor(i(u),p);m.onerror=mn(c),m.onsuccess=et(function(t){var r=m.result;if(!r){e(null);return}r.___id=++kn,r.done=!1;var i=r.continue.bind(r),a=r.continuePrimaryKey;a&&=a.bind(r);var o=r.advance.bind(r),s=function(){throw Error(`Cursor not started`)},l=function(){throw Error(`Cursor not stopped`)};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=s,r.fail=et(c),r.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},r.start=function(e){var t=new Promise(function(e,t){e=et(e),m.onerror=mn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=l,e(t)}}),n=function(){if(m.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw Error(`Cursor behind last entry`)},r.stop()};return m.onsuccess=et(function(e){m.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=a,r.advance=o,n(),t},e(r)},c)})}function a(e){return function(n){return new Promise(function(r,a){r=et(r);var o=n.trans,s=n.values,c=n.limit,l=n.query,u=c===1/0?void 0:c,d=l.index,f=l.range,p=o.objectStore(t),m=d.isPrimaryKey?p:p.index(d.name),h=i(f);if(c===0)return r({result:[]});if(e){var g=s?m.getAll(h,u):m.getAllKeys(h,u);g.onsuccess=function(e){return r({result:e.target.result})},g.onerror=mn(a)}else{var _=0,v=s||!(`openKeyCursor`in m)?m.openCursor(h):m.openKeyCursor(h),y=[];v.onsuccess=function(e){var t=v.result;if(!t||(y.push(s?t.value:t.primaryKey),++_===c))return r({result:y});t.continue()},v.onerror=mn(a)}})}}return{name:t,schema:e,mutate:n,getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=et(e);for(var a=n.objectStore(t),o=r.length,s=Array(o),c=0,l=0,u,d=function(t){var n=t.target;s[n._pos]=n.result,++l===c&&e(s)},f=mn(i),p=0;p<o;++p)r[p]!=null&&(u=a.get(r[p]),u._pos=p,u.onsuccess=d,u.onerror=f,++c);c===0&&e(s)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=et(e);var a=n.objectStore(t).get(r);a.onsuccess=function(t){return e(t.target.result)},a.onerror=mn(i)})},query:a(l),openCursor:r,count:function(e){var n=e.query,r=e.trans,a=n.index,o=n.range;return new Promise(function(e,n){var s=r.objectStore(t),c=a.isPrimaryKey?s:s.index(a.name),l=i(o),u=l?c.count(l):c.count();u.onsuccess=et(function(t){return e(t.target.result)}),u.onerror=mn(n)})}}}var s=r(e,n),c=s.schema,l=s.hasGetAll,u=c.tables.map(function(e){return a(e)}),d={};return u.forEach(function(e){return d[e.name]=e}),{stack:`dbcore`,transaction:e.transaction.bind(e),table:function(e){if(!d[e])throw Error(`Table '${e}' not found`);return d[e]},MIN_KEY:-1/0,MAX_KEY:Tn(t),schema:c}}function Mn(e,t){return t.reduce(function(e,t){var r=t.create;return n(n({},e),r(e))},e)}function Nn(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:Mn(jn(t,i,r),e.dbcore)}}function Pn(e,t){var n=t.db;e.core=Nn(e._middlewares,n,e._deps,t).dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function Fn(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=g(t,n);(!r||`value`in r&&r.value===void 0)&&(t===e.Transaction.prototype||t instanceof e.Transaction?p(t,n,{get:function(){return this.table(n)},set:function(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function In(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function Ln(e,t){return e._cfg.version-t._cfg.version}function Rn(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains(`$meta`)&&!i.$meta&&(i.$meta=Cn(`$meta`,Zn(``)[0],[]),e._storeNames.push(`$meta`));var o=e._createTransaction(`readwrite`,e._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),c=X.transless||X;st(function(){if(X.trans=o,X.transless=c,t===0)a(i).forEach(function(e){Un(n,e,i[e].primKey,i[e].indexes)}),Pn(e,n),Z.follow(function(){return e.on.populate.fire(o)}).catch(s);else return Pn(e,n),Bn(e,o,t).then(function(t){return Vn(e,t,o,n)}).catch(s)})}function zn(e,t){Wn(e._dbSchema,t),t.db.version%10==0&&!t.objectStoreNames.contains(`$meta`)&&t.db.createObjectStore(`$meta`).add(Math.ceil(t.db.version/10-1),`version`);var n=qn(e,e.idbdb,t);Xn(e,e._dbSchema,t);for(var r=Hn(n,e._dbSchema),i=function(e){if(e.change.length||e.recreate)return console.warn(`Unable to patch indexes of table ${e.name} because it has changes on the type of index or primary key.`),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){_e&&console.debug(`Dexie upgrade patch: Creating missing index ${e.name}.${t.src}`),Kn(n,t)})},a=0,o=r.change;a<o.length;a++){var s=o[a],c=i(s);if(typeof c==`object`)return c.value}}function Bn(e,t,n){return t.storeNames.includes(`$meta`)?t.table(`$meta`).get(`version`).then(function(e){return e??n}):Z.resolve(n)}function Vn(e,t,n,r){var i=[],o=e._versions,s=e._dbSchema=qn(e,e.idbdb,r),c=o.filter(function(e){return e._cfg.version>=t});if(c.length===0)return Z.resolve();c.forEach(function(o){i.push(function(){var i=s,c=o._cfg.dbschema;Xn(e,i,r),Xn(e,c,r),s=e._dbSchema=c;var l=Hn(i,c);l.add.forEach(function(e){Un(r,e[0],e[1].primKey,e[1].indexes)}),l.change.forEach(function(e){if(e.recreate)throw new J.Upgrade(`Not yet support for changing primary key`);var t=r.objectStore(e.name);e.add.forEach(function(e){return Kn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Kn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var u=o._cfg.contentUpgrade;if(u&&o._cfg.version>t){Pn(e,r),n._memoizedTables={};var d=E(c);l.del.forEach(function(e){d[e]=i[e]}),In(e,[e.Transaction.prototype]),Fn(e,[e.Transaction.prototype],a(d),d),n.schema=d;var f=U(u);f&&ct();var p,m=Z.follow(function(){if(p=u(n),p&&f){var e=lt.bind(null,null);p.then(e,e)}});return p&&typeof p.then==`function`?Z.resolve(p):m.then(function(){return p})}}),i.push(function(t){var r=o._cfg.dbschema;Gn(r,t),In(e,[e.Transaction.prototype]),Fn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(t){e.idbdb.objectStoreNames.contains(`$meta`)&&(Math.ceil(e.idbdb.version/10)===o._cfg.version?(e.idbdb.deleteObjectStore(`$meta`),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(e){return e!==`$meta`})):t.objectStore(`$meta`).put(o._cfg.version,`version`))})});function l(){return i.length?Z.resolve(i.shift()(n.idbtrans)).then(l):Z.resolve()}return l().then(function(){Wn(s,r)})}function Hn(e,t){var n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],a=t[r];if(!i)n.add.push([r,a]);else{var o={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(``+(i.primKey.keyPath||``)!=``+(a.primKey.keyPath||``)||i.primKey.auto!==a.primKey.auto)o.recreate=!0,n.change.push(o);else{var s=i.idxByName,c=a.idxByName,l=void 0;for(l in s)c[l]||o.del.push(l);for(l in c){var u=s[l],d=c[l];u?u.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function Un(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Kn(i,e)}),i}function Wn(e,t){a(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(_e&&console.debug(`Dexie: Creating missing table`,n),Un(t,n,e[n].primKey,e[n].indexes))})}function Gn(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function Kn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function qn(e,t,n){var r={};return v(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=t.keyPath,a=xn(Sn(i),i||``,!0,!1,!!t.autoIncrement,i&&typeof i!=`string`,!0),o=[],s=0;s<t.indexNames.length;++s){var c=t.index(t.indexNames[s]);i=c.keyPath;var l=xn(c.name,i,!!c.unique,!!c.multiEntry,!1,i&&typeof i!=`string`,!1);o.push(l)}r[e]=Cn(e,a,o)}),r}function Jn(e,t,n){e.verno=t.version/10;var r=e._dbSchema=qn(e,t,n);e._storeNames=v(t.objectStoreNames,0),Fn(e,[e._allTables],a(r),r)}function Yn(e,t){var n=qn(e,e.idbdb,t),r=Hn(n,e._dbSchema);return!(r.add.length||r.change.some(function(e){return e.add.length||e.change.length}))}function Xn(e,t,n){for(var r=n.db.objectStoreNames,a=0;a<r.length;++a){var o=r[a],s=n.objectStore(o);e._hasGetAll=`getAll`in s;for(var c=0;c<s.indexNames.length;++c){var l=s.indexNames[c],u=s.index(l).keyPath,d=typeof u==`string`?u:`[`+v(u).join(`+`)+`]`;if(t[o]){var f=t[o].idxByName[d];f&&(f.name=l,delete t[o].idxByName[d],t[o].idxByName[l]=f)}}}typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Zn(e){return e.split(`,`).map(function(e,t){var n=e.split(`:`),r=n[1]?.trim();e=n[0].trim();var i=e.replace(/([&*]|\+\+)/g,``),a=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split(`+`):i;return xn(i,a||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),o(a),t===0,r)})}var Qn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return Cn(e,t,n)},e.prototype._parseIndexSyntax=function(e){return Zn(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;a(e).forEach(function(r){if(e[r]!==null){var i=n._parseIndexSyntax(e[r]),a=i.shift();if(!a)throw new J.Schema(`Invalid schema for table `+r+`: `+e[r]);if(a.unique=!0,a.multi)throw new J.Schema(`Primary key cannot be multiEntry*`);i.forEach(function(e){if(e.auto)throw new J.Schema(`Only primary key can be marked as autoIncrement (++)`);if(!e.keyPath)throw new J.Schema(`Index must have a name and cannot be an empty string`)}),t[r]=n._createTableSchema(r,a,i)}})},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach(function(e){s(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),t._dbSchema=i,In(t,[t._allTables,t,t.Transaction.prototype]),Fn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],a(i),i),t._storeNames=a(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ge(this._cfg.contentUpgrade||Y,e),this},e}();function $n(e){return Ht(Qn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function er(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ei(Et,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:`name`})),n.table(`dbnames`)}function $(e){return e&&typeof e.databases==`function`}function tr(e){var t=e.indexedDB,n=e.IDBKeyRange;return $(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==Et})}):er(t,n).toCollection().primaryKeys()}function nr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!$(n)&&t!==Et&&er(n,r).put({name:t}).catch(Y)}function rr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!$(n)&&t!==Et&&er(n,r).delete(t).catch(Y)}function ir(e){return st(function(){return X.letThrough=!0,e()})}function ar(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}var or;function sr(e){return!(`from`in e)}var cr=function(e,t){if(this)s(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new cr;return e&&`d`in e&&s(n,e),n}};d(cr.prototype,(or={add:function(e){return ur(this,e),this},addKey:function(e){return lr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return lr(t,e,e)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&Q(t.from,e)<=0&&Q(t.to,e)>=0}},or[R]=function(){return fr(this)},or));function lr(e,t,n){var r=Q(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(sr(e))return s(e,{from:t,to:n,d:1});var i=e.l,a=e.r;if(Q(n,e.from)<0)return i?lr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},pr(e);if(Q(t,e.to)>0)return a?lr(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},pr(e);Q(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),Q(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var o=!e.r;i&&!e.l&&ur(e,i),a&&o&&ur(e,a)}}function ur(e,t){function n(e,t){var r=t.from,i=t.to,a=t.l,o=t.r;lr(e,r,i),a&&n(e,a),o&&n(e,o)}sr(t)||n(e,t)}function dr(e,t){var n=fr(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=fr(e),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(Q(s.from,i.to)<=0&&Q(s.to,i.from)>=0)return!0;Q(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function fr(e){var t=sr(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Q(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Q(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function pr(e){var t=(e.r?.d||0)-(e.l?.d||0),r=t>1?`r`:t<-1?`l`:``;if(r){var i=r===`r`?`l`:`r`,a=n({},e),o=e[r];e.from=o.from,e.to=o.to,e[r]=o[r],a[r]=o[i],e[i]=a,a.d=mr(a)}e.d=mr(e)}function mr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function hr(e,t){return a(t).forEach(function(n){e[n]?ur(e[n],t[n]):e[n]=j(t[n])}),e}function gr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&dr(t[n],e[n])})}var _r={},vr={},yr=!1;function br(e,t){hr(vr,e),yr||(yr=!0,setTimeout(function(){yr=!1;var e=vr;vr={},xr(e,!1)},0))}function xr(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(_r);r<i.length;r++){var a=i[r];Sr(a,e,n,t)}else for(var o in e){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var c=s[1],l=s[2],a=_r[`idb://${c}/${l}`];a&&Sr(a,e,n,t)}}n.forEach(function(e){return e()})}function Sr(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var s=o[a],c=s[0],l=s[1],u=[],d=0,f=l;d<f.length;d++){var p=f[d];gr(t,p.obsSet)?p.subscribers.forEach(function(e){return n.add(e)}):r&&u.push(p)}r&&i.push([c,u])}if(r)for(var m=0,h=i;m<h.length;m++){var g=h[m],c=g[0],u=g[1];e.queries.query[c]=u}}function Cr(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?vt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(e.verno*10),a=!1;function o(){if(t.openCanceller!==r)throw new J.DatabaseClosed(`db.open() was cancelled`)}var s=t.dbReadyResolve,c=null,l=!1,u=function(){return new Z(function(r,s){if(o(),!n)throw new J.MissingAPI;var d=e.name,f=t.autoSchema||!i?n.open(d):n.open(d,i);if(!f)throw new J.MissingAPI;f.onerror=mn(s),f.onblocked=et(e._fireOnBlocked),f.onupgradeneeded=et(function(r){if(c=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=hn,c.abort(),f.result.close();var i=n.deleteDatabase(d);i.onsuccess=i.onerror=et(function(){s(new J.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{c.onerror=mn(s);var o=r.oldVersion>2**62?0:r.oldVersion;l=o<1,e.idbdb=f.result,a&&zn(e,c),Rn(e,o/10,c,s)}},s),f.onsuccess=et(function(){c=null;var n=e.idbdb=f.result,o=v(n.objectStoreNames);if(o.length>0)try{var s=n.transaction(wn(o),`readonly`);if(t.autoSchema)Jn(e,n,s);else if(Xn(e,e._dbSchema,s),!Yn(e,s)&&!a)return console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.`),n.close(),i=n.version+1,a=!0,r(u());Pn(e,s)}catch{}Tt.push(e),n.onversionchange=et(function(n){t.vcFired=!0,e.on(`versionchange`).fire(n)}),n.onclose=et(function(){e.close({disableAutoOpen:!1})}),l&&nr(e._deps,d),r()},s)}).catch(function(e){switch(e?.name){case`UnknownError`:if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn(`Dexie: Workaround for Chrome UnknownError on open()`),u();break;case`VersionError`:if(i>0)return i=0,u();break}return Z.reject(e)})};return Z.race([r,(typeof navigator>`u`?Z.resolve():ar()).then(u)]).then(function(){return o(),t.onReadyBeingFired=[],Z.resolve(ir(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(ge,Y);return t.onReadyBeingFired=[],Z.resolve(ir(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{c&&c.abort()}catch{}return r===t.openCanceller&&e._close(),vt(n)}).finally(function(){t.openComplete=!0,s()}).then(function(){if(l){var t={};e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t[`idb://${e.name}/${n.name}/${r.name}`]=new cr(-1/0,[[[]]]))}),t[`idb://${e.name}/${n.name}/`]=t[`idb://${e.name}/${n.name}/:dels`]=new cr(-1/0,[[[]]])}),vn(gn).fire(t),xr(t,!0)}return e})}function wr(e){var t=function(t){return e.next(t)},n=function(t){return e.throw(t)},r=a(t),i=a(n);function a(e){return function(t){var n=e(t),a=n.value;return n.done?a:!a||typeof a.then!=`function`?o(a)?Promise.all(a).then(r,i):r(a):a.then(r,i)}}return a(t)()}function Tr(e,t,n){var r=arguments.length;if(r<2)throw new J.InvalidArgument(`Too few arguments`);for(var i=Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=O(i);return[e,a,n]}function Er(e,t,n,r,i){return Z.resolve().then(function(){var a=X.transless||X,o=e._createTransaction(t,n,e._dbSchema,r);o.explicit=!0;var s={trans:o,transless:a};if(r)o.idbtrans=r.idbtrans;else try{o.create(),o.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===ie.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn(`Dexie: Need to reopen db`),e.close({disableAutoOpen:!1}),e.open().then(function(){return Er(e,t,n,null,i)})):vt(r)}var c=U(i);c&&ct();var l,u=Z.follow(function(){if(l=i.call(o,o),l)if(c){var e=lt.bind(null,null);l.then(e,e)}else typeof l.next==`function`&&typeof l.throw==`function`&&(l=wr(l))},s);return(l&&typeof l.then==`function`?Z.resolve(l).then(function(e){return o.active?e:vt(new J.PrematureCommit(`Transaction committed too early. See http://bit.ly/2kdckMn`))}):u.then(function(){return l})).then(function(e){return r&&o._resolve(),o._completion.then(function(){return e})}).catch(function(e){return o._reject(e),vt(e)})})}function Dr(e,t,n){for(var r=o(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Or(e){return n(n({},e),{table:function(t){var r=e.table(t),i=r.schema,a={},o=[];function s(e,t,r){var i=An(e),c=a[i]=a[i]||[],l=e==null?0:typeof e==`string`?1:e.length,u=t>0,d=n(n({},r),{name:u?`${i}(virtual-from:${r.name})`:r.name,lowLevelIndex:r,isVirtual:u,keyTail:t,keyLength:l,extractKey:En(e),unique:!u&&r.unique});if(c.push(d),d.isPrimaryKey||o.push(d),l>1){var f=l===2?e[0]:e.slice(0,l-1);s(f,t+1,r)}return c.sort(function(e,t){return e.keyTail-t.keyTail}),d}var c=s(i.primaryKey.keyPath,0,i.primaryKey);a[`:id`]=[c];for(var l=0,u=i.indexes;l<u.length;l++){var d=u[l];s(d.keyPath,0,d)}function f(e){var t=a[An(e)];return t&&t[0]}function p(t,n){return{type:t.type===1?2:t.type,lower:Dr(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Dr(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function m(e){var t=e.query.index;return t.isVirtual?n(n({},e),{query:{index:t.lowLevelIndex,range:p(e.query.range,t.keyTail)}}):e}return n(n({},r),{schema:n(n({},i),{primaryKey:c,indexes:o,getIndexByKeyPath:f}),count:function(e){return r.count(m(e))},query:function(e){return r.query(m(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,a=n.isVirtual,o=n.keyLength;if(!a)return r.openCursor(t);function s(n){function r(r){r==null?t.unique?n.continue(n.key.slice(0,o).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue():n.continue(Dr(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i))}return Object.create(n,{continue:{value:r},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Dr(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return o===1?e[0]:e.slice(0,o)}},value:{get:function(){return n.value}}})}return r.openCursor(m(t)).then(function(e){return e&&s(e)})}})}})}var kr={stack:`dbcore`,name:`VirtualIndexMiddleware`,level:1,create:Or};function Ar(e,t,n,r){return n||={},r||=``,a(e).forEach(function(i){if(!u(t,i))n[r+i]=void 0;else{var a=e[i],o=t[i];if(typeof a==`object`&&typeof o==`object`&&a&&o){var s=L(a),c=L(o);s===c?s===`Object`?Ar(a,o,n,r+i+`.`):a!==o&&(n[r+i]=t[i]):n[r+i]=t[i]}else a!==o&&(n[r+i]=t[i])}}),a(t).forEach(function(i){u(e,i)||(n[r+i]=t[i])}),n}function jr(e,t){return t.type===`delete`?t.keys:t.keys||t.values.map(e.extractKey)}var Mr={stack:`dbcore`,name:`HooksMiddleware`,level:2,create:function(e){return n(n({},e),{table:function(t){var i=e.table(t),a=i.schema.primaryKey;return n(n({},i),{mutate:function(e){var o=X.trans,s=o.table(t).hook,c=s.deleting,l=s.creating,d=s.updating;switch(e.type){case`add`:if(l.fire===Y)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`put`:if(l.fire===Y&&d.fire===Y)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`delete`:if(c.fire===Y)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`deleteRange`:if(c.fire===Y)break;return o._promise(`readwrite`,function(){return p(e)},!0)}return i.mutate(e);function f(e){var t=X.trans,o=e.keys||jr(a,e);if(!o)throw Error(`Keys missing`);return e=e.type===`add`||e.type===`put`?n(n({},e),{keys:o}):n({},e),e.type!==`delete`&&(e.values=r([],e.values,!0)),e.keys&&=r([],e.keys,!0),Nr(i,e,o).then(function(n){var r=o.map(function(r,i){var o=n[i],s={onerror:null,onsuccess:null};if(e.type===`delete`)c.fire.call(s,r,o,t);else if(e.type===`add`||o===void 0){var f=l.fire.call(s,r,e.values[i],t);r==null&&f!=null&&(r=f,e.keys[i]=r,a.outbound||w(e.values[i],a.keyPath,r))}else{var p=Ar(o,e.values[i]),m=d.fire.call(s,p,r,o,t);if(m){var h=e.values[i];Object.keys(m).forEach(function(e){u(h,e)?h[e]=m[e]:w(h,e,m[e])})}}return s});return i.mutate(e).then(function(t){for(var i=t.failures,a=t.results,s=t.numFailures,c=t.lastResult,l=0;l<o.length;++l){var u=a?a[l]:o[l],d=r[l];u==null?d.onerror&&d.onerror(i[l]):d.onsuccess&&d.onsuccess(e.type===`put`&&n[l]?e.values[l]:u)}return{failures:i,results:a,numFailures:s,lastResult:c}}).catch(function(e){return r.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}function p(e){return m(e.trans,e.range,1e4)}function m(e,t,r){return i.query({trans:e,values:!1,query:{index:a,range:t},limit:r}).then(function(i){var a=i.result;return f({type:`delete`,keys:a,trans:e}).then(function(i){return i.numFailures>0?Promise.reject(i.failures[0]):a.length<r?{failures:[],numFailures:0,lastResult:void 0}:m(e,n(n({},t),{lower:a[a.length-1],lowerOpen:!0}),r)})})}}})}})}};function Nr(e,t,n){return t.type===`add`?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:`immutable`})}function Pr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)Q(t.keys[i],e[a])===0&&(r.push(n?P(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Fr={stack:`dbcore`,level:-1,create:function(e){return{table:function(t){var r=e.table(t);return n(n({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Pr(e.keys,e.trans._cache,e.cache===`clone`);return t?Z.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:e.cache===`clone`?P(t):t},t})},mutate:function(e){return e.type!==`add`&&(e.trans._cache=null),r.mutate(e)}})}}}};function Ir(e,t){return e.trans.mode===`readonly`&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!==`disabled`&&!t.schema.primaryKey.outbound}function Lr(e,t){switch(e){case`query`:return t.values&&!t.unique;case`get`:return!1;case`getMany`:return!1;case`count`:return!1;case`openCursor`:return!1}}var Rr={stack:`dbcore`,level:0,name:`Observability`,create:function(e){var t=e.schema.name,r=new cr(e.MIN_KEY,e.MAX_KEY);return n(n({},e),{transaction:function(t,n,r){if(X.subscr&&n!==`readonly`)throw new J.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${X.querier}`);return e.transaction(t,n,r)},table:function(i){var s=e.table(i),c=s.schema,l=c.primaryKey,u=c.indexes,d=l.extractKey,f=l.outbound,p=l.autoIncrement&&u.filter(function(e){return e.compound&&e.keyPath.includes(l.keyPath)}),m=n(n({},s),{mutate:function(n){var a=n.trans,u=n.mutatedParts||={},d=function(e){var n=`idb://${t}/${i}/${e}`;return u[n]||(u[n]=new cr)},f=d(``),m=d(`:dels`),h=n.type,g=n.type===`deleteRange`?[n.range]:n.type===`delete`?[n.keys]:n.values.length<50?[jr(l,n).filter(function(e){return e}),n.values]:[],_=g[0],v=g[1],y=n.trans._cache;if(o(_)){f.addKeys(_);var b=h===`delete`||_.length===v.length?Pr(_,y):null;b||m.addKeys(_),(b||v)&&zr(d,c,b,v)}else if(_){var x={from:_.lower??e.MIN_KEY,to:_.upper??e.MAX_KEY};m.add(x),f.add(x)}else f.add(r),m.add(r),c.indexes.forEach(function(e){return d(e.name).add(r)});return s.mutate(n).then(function(e){return _&&(n.type===`add`||n.type===`put`)&&(f.addKeys(e.results),p&&p.forEach(function(t){for(var r=n.values.map(function(e){return t.extractKey(e)}),i=t.keyPath.findIndex(function(e){return e===l.keyPath}),a=0,o=e.results.length;a<o;++a)r[a][i]=e.results[a];d(t.name).addKeys(r)})),a.mutatedParts=hr(a.mutatedParts||{},u),e})}}),h=function(t){var n=t.query,r=n.index,i=n.range;return[r,new cr(i.lower??e.MIN_KEY,i.upper??e.MAX_KEY)]},g={get:function(e){return[l,new cr(e.key)]},getMany:function(e){return[l,new cr().addKeys(e.keys)]},count:h,query:h,openCursor:h};return a(g).forEach(function(e){m[e]=function(a){var o=X.subscr,c=!!o,l=Ir(X,s)&&Lr(e,a)?a.obsSet={}:o;if(c){var u=function(e){var n=`idb://${t}/${i}/${e}`;return l[n]||(l[n]=new cr)},p=u(``),m=u(`:dels`),h=g[e](a),_=h[0],v=h[1];if(e===`query`&&_.isPrimaryKey&&!a.values?m.add(v):u(_.name||``).add(v),!_.isPrimaryKey)if(e===`count`)m.add(r);else{var y=e===`query`&&f&&a.values&&s.query(n(n({},a),{values:!1}));return s[e].apply(this,arguments).then(function(t){if(e===`query`){if(f&&a.values)return y.then(function(e){var n=e.result;return p.addKeys(n),t});var n=a.values?t.result.map(d):t.result;a.values?p.addKeys(n):m.addKeys(n)}else if(e===`openCursor`){var r=t,i=a.values;return r&&Object.create(r,{key:{get:function(){return m.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return m.addKey(e),e}},value:{get:function(){return i&&p.addKey(r.primaryKey),r.value}}})}return t})}}return s[e].apply(this,arguments)}}),m}})}};function zr(e,t,n,r){function i(t){var i=e(t.name||``);function a(e){return e==null?null:t.extractKey(e)}var s=function(e){return t.multiEntry&&o(e)?e.forEach(function(e){return i.addKey(e)}):i.addKey(e)};(n||r).forEach(function(e,t){var i=n&&a(n[t]),o=r&&a(r[t]);Q(i,o)!==0&&(i!=null&&s(i),o!=null&&s(o))})}t.indexes.forEach(i)}function Br(e,t,r){if(r.numFailures===0)return t;if(t.type===`deleteRange`)return null;var i=t.keys?t.keys.length:`values`in t&&t.values?t.values.length:1;if(r.numFailures===i)return null;var a=n({},t);return o(a.keys)&&(a.keys=a.keys.filter(function(e,t){return!(t in r.failures)})),`values`in a&&o(a.values)&&(a.values=a.values.filter(function(e,t){return!(t in r.failures)})),a}function Vr(e,t){return t.lower===void 0?!0:t.lowerOpen?Q(e,t.lower)>0:Q(e,t.lower)>=0}function Hr(e,t){return t.upper===void 0?!0:t.upperOpen?Q(e,t.upper)<0:Q(e,t.upper)<=0}function Ur(e,t){return Vr(e,t)&&Hr(e,t)}function Wr(e,t,n,r,i,a){if(!n||n.length===0)return e;var s=t.query.index,c=s.multiEntry,l=t.query.range,u=r.schema.primaryKey.extractKey,d=s.extractKey,f=(s.lowLevelIndex||s).extractKey,p=n.reduce(function(e,n){var r=e,i=[];if(n.type===`add`||n.type===`put`)for(var a=new cr,s=n.values.length-1;s>=0;--s){var f=n.values[s],p=u(f);if(!a.hasKey(p)){var m=d(f);(c&&o(m)?m.some(function(e){return Ur(e,l)}):Ur(m,l))&&(a.addKey(p),i.push(f))}}switch(n.type){case`add`:var h=new cr().addKeys(t.values?e.map(function(e){return u(e)}):e);r=e.concat(t.values?i.filter(function(e){var t=u(e);return h.hasKey(t)?!1:(h.addKey(t),!0)}):i.map(function(e){return u(e)}).filter(function(e){return h.hasKey(e)?!1:(h.addKey(e),!0)}));break;case`put`:var g=new cr().addKeys(n.values.map(function(e){return u(e)}));r=e.filter(function(e){return!g.hasKey(t.values?u(e):e)}).concat(t.values?i:i.map(function(e){return u(e)}));break;case`delete`:var _=new cr().addKeys(n.keys);r=e.filter(function(e){return!_.hasKey(t.values?u(e):e)});break;case`deleteRange`:var v=n.range;r=e.filter(function(e){return!Ur(u(e),v)});break}return r},e);return p===e?e:(p.sort(function(e,t){return Q(f(e),f(t))||Q(u(e),u(t))}),t.limit&&t.limit<1/0&&(p.length>t.limit?p.length=t.limit:e.length===t.limit&&p.length<t.limit&&(i.dirty=!0)),a?Object.freeze(p):p)}function Gr(e,t){return Q(e.lower,t.lower)===0&&Q(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Kr(e,t,n,r){if(e===void 0)return t===void 0?0:-1;if(t===void 0)return 1;var i=Q(e,t);if(i===0){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function qr(e,t,n,r){if(e===void 0)return t===void 0?0:1;if(t===void 0)return-1;var i=Q(e,t);if(i===0){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Jr(e,t){return Kr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&qr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Yr(e,t,n,r){var i=_r[`idb://${e}/${t}`];if(!i)return[];var a=i.queries[n];if(!a)return[null,!1,i,null];var o=r.query?r.query.index.name:null,s=a[o||``];if(!s)return[null,!1,i,null];switch(n){case`query`:var c=s.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Gr(e.req.query.range,r.query.range)});return c?[c,!0,i,s]:[s.find(function(e){return(`limit`in e.req?e.req.limit:1/0)>=r.limit&&(r.values?e.req.values:!0)&&Jr(e.req.query.range,r.query.range)}),!1,i,s];case`count`:var l=s.find(function(e){return Gr(e.req.query.range,r.query.range)});return[l,!!l,i,s]}}function Xr(e,t,n,r){e.subscribers.add(n),r.addEventListener(`abort`,function(){e.subscribers.delete(n),e.subscribers.size===0&&Zr(e,t)})}function Zr(e,t){setTimeout(function(){e.subscribers.size===0&&B(t,e)},3e3)}var Qr={stack:`dbcore`,level:0,name:`Cache`,create:function(e){var t=e.schema.name;return n(n({},e),{transaction:function(n,r,i){var a=e.transaction(n,r,i);if(r===`readwrite`){var o=new AbortController,s=o.signal,c=function(i){return function(){if(o.abort(),r===`readwrite`){for(var s=new Set,c=0,l=n;c<l.length;c++){var u=l[c],d=_r[`idb://${t}/${u}`];if(d){var f=e.table(u),p=d.optimisticOps.filter(function(e){return e.trans===a});if(a._explicit&&i&&a.mutatedParts)for(var m=0,h=Object.values(d.queries.query);m<h.length;m++)for(var g=h[m],_=0,v=g.slice();_<v.length;_++){var y=v[_];gr(y.obsSet,a.mutatedParts)&&(B(g,y),y.subscribers.forEach(function(e){return s.add(e)}))}else if(p.length>0){d.optimisticOps=d.optimisticOps.filter(function(e){return e.trans!==a});for(var b=0,x=Object.values(d.queries.query);b<x.length;b++)for(var g=x[b],S=0,C=g.slice();S<C.length;S++){var y=C[S];if(y.res!=null&&a.mutatedParts)if(i&&!y.dirty){var w=Object.isFrozen(y.res),T=Wr(y.res,y.req,p,f,y,w);y.dirty?(B(g,y),y.subscribers.forEach(function(e){return s.add(e)})):T!==y.res&&(y.res=T,y.promise=Z.resolve({result:T}))}else y.dirty&&B(g,y),y.subscribers.forEach(function(e){return s.add(e)})}}}}s.forEach(function(e){return e()})}}};a.addEventListener(`abort`,c(!1),{signal:s}),a.addEventListener(`error`,c(!1),{signal:s}),a.addEventListener(`complete`,c(!0),{signal:s})}return a},table:function(r){var i=e.table(r),a=i.schema.primaryKey;return n(n({},i),{mutate:function(e){var o=X.trans;if(a.outbound||o.db._options.cache===`disabled`||o.explicit||o.idbtrans.mode!==`readwrite`)return i.mutate(e);var s=_r[`idb://${t}/${r}`];if(!s)return i.mutate(e);var c=i.mutate(e);return(e.type===`add`||e.type===`put`)&&(e.values.length>=50||jr(a,e).some(function(e){return e==null}))?c.then(function(t){var r=n(n({},e),{values:e.values.map(function(e,r){if(t.failures[r])return e;var i=a.keyPath?.includes(`.`)?P(e):n({},e);return w(i,a.keyPath,t.results[r]),i})}),i=Br(s,r,t);s.optimisticOps.push(i),queueMicrotask(function(){return e.mutatedParts&&br(e.mutatedParts)})}):(s.optimisticOps.push(e),e.mutatedParts&&br(e.mutatedParts),c.then(function(t){if(t.numFailures>0){B(s.optimisticOps,e);var n=Br(s,e,t);n&&s.optimisticOps.push(n),e.mutatedParts&&br(e.mutatedParts)}}),c.catch(function(){B(s.optimisticOps,e),e.mutatedParts&&br(e.mutatedParts)})),c},query:function(e){if(!Ir(X,i)||!Lr(`query`,e))return i.query(e);var n=X.trans?.db._options.cache===`immutable`,a=X,o=a.requery,s=a.signal,c=Yr(t,r,`query`,e),l=c[0],u=c[1],d=c[2],f=c[3];if(l&&u)l.obsSet=e.obsSet;else{var p=i.query(e).then(function(e){var t=e.result;if(l&&(l.res=t),n){for(var r=0,i=t.length;r<i;++r)Object.freeze(t[r]);Object.freeze(t)}else e.result=P(t);return e}).catch(function(e){return f&&l&&B(f,l),Promise.reject(e)});l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:`query`,req:e,dirty:!1},f?f.push(l):(f=[l],d||=_r[`idb://${t}/${r}`]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}},d.queries.query[e.query.index.name||``]=f)}return Xr(l,f,o,s),l.promise.then(function(t){return{result:Wr(t.result,e,d?.optimisticOps,i,l,n)}})}})}})}};function $r(e,t){return new Proxy(e,{get:function(e,n,r){return n===`db`?t:Reflect.get(e,n,r)}})}var ei=function(){function e(t,r){var i=this;this._middlewares={},this.verno=0;var a=e.dependencies;this._options=r=n({addons:e.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:`cloned`},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var o=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Y,dbReadyPromise:null,cancelOpen:Y,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};s.dbReadyPromise=new Z(function(e){s.dbReadyResolve=e}),s.openCanceller=new Z(function(e,t){s.cancelOpen=t}),this._state=s,this.name=t,this.on=Vt(this,`populate`,`blocked`,`versionchange`,`close`,{ready:[ge,Y]}),this.once=function(e,t){var n=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];i.on(e).unsubscribe(n),t.apply(i,r)};return i.on(e,n)},this.on.ready.subscribe=y(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||Z.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var a=i;r||t(function e(){a.on.ready.unsubscribe(n),a.on.ready.unsubscribe(e)})}})}}),this.Collection=en(this),this.Table=Ut(this),this.Transaction=bn(this),this.Version=$n(this),this.WhereClause=pn(this),this.on(`versionchange`,function(e){e.newVersion>0?console.warn(`Another connection wants to upgrade database '${i.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${i.name}'. Closing db now to resume the delete request.`),i.close({disableAutoOpen:!1})}),this.on(`blocked`,function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${i.name}') was blocked`):console.warn(`Upgrade '${i.name}' blocked by other connection holding version ${e.oldVersion/10}`)}),this._maxKey=Tn(r.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on(`blocked`).fire(e),Tt.filter(function(e){return e.name===i.name&&e!==i&&!e._state.vcFired}).map(function(t){return t.on(`versionchange`).fire(e)})},this.use(Fr),this.use(Qr),this.use(Rr),this.use(kr),this.use(Mr);var c=new Proxy(this,{get:function(e,t,n){if(t===`_vip`)return!0;if(t===`table`)return function(e){return $r(i.table(e),c)};var r=Reflect.get(e,t,n);return r instanceof Bt?$r(r,c):t===`tables`?r.map(function(e){return $r(e,c)}):t===`_createTransaction`?function(){var e=r.apply(this,arguments);return $r(e,c)}:r}});this.vip=c,o.forEach(function(e){return e(i)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new J.Type(`Given version is not a positive number`);if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema(`Cannot add version when database is open`);this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Ln),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||X.letThrough||this._vip)?e():new Z(function(e,n){if(t._state.openComplete)return n(new J.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen){n(new J.DatabaseClosed);return}t.open().catch(Y)}t._state.dbReadyPromise.then(e,n)}).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var a=this._middlewares[t]||(this._middlewares[t]=[]);return a.push({stack:t,create:n,level:r??10,name:i}),a.sort(function(e,t){return e.level-t.level}),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:n?e.name!==n:!1})),this},e.prototype.open=function(){var e=this;return ht(Fe,function(){return Cr(e)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent(`close`));var e=this._state,t=Tt.indexOf(this);if(t>=0&&Tt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Z(function(t){e.dbReadyResolve=t}),e.openCanceller=new Z(function(t,n){e.cancelOpen=n}))},e.prototype.close=function(e){var t=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new J.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new J.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=arguments.length>0&&typeof arguments[0]!=`object`,r=this._state;return new Z(function(i,a){var o=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=et(function(){rr(t._deps,t.name),i()}),n.onerror=mn(a),n.onblocked=t._fireOnBlocked};if(n)throw new J.InvalidArgument(`Invalid closeOptions argument to db.delete()`);r.isBeingOpened?r.dbReadyPromise.then(o):o()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name===`DatabaseClosed`},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,`tables`,{get:function(){var e=this;return a(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Tr.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=X.trans;(!i||i.db!==this||e.indexOf(`!`)!==-1)&&(i=null);var a=e.indexOf(`?`)!==-1;e=e.replace(`!`,``).replace(`?`,``);var o,s;try{if(s=t.map(function(e){var t=e instanceof r.Table?e.name:e;if(typeof t!=`string`)throw TypeError(`Invalid table argument to Dexie.transaction(). Only Table or String are allowed`);return t}),e==`r`||e===Dt)o=Dt;else if(e==`rw`||e==Ot)o=Ot;else throw new J.InvalidArgument(`Invalid transaction mode: `+e);if(i){if(i.mode===Dt&&o===Ot)if(a)i=null;else throw new J.SubTransaction(`Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY`);i&&s.forEach(function(e){if(i&&i.storeNames.indexOf(e)===-1)if(a)i=null;else throw new J.SubTransaction(`Table `+e+` not included in parent transaction.`)}),a&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):vt(e)}var c=Er.bind(null,this,o,s,i,n);return i?i._promise(o,c,`lock`):X.trans?ht(X.transless,function(){return r._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(e){if(!u(this._allTables,e))throw new J.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]},e}(),ti=typeof Symbol<`u`&&`observable`in Symbol?Symbol.observable:`@@observable`,ni=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(!e||typeof e==`function`?{next:e,error:t,complete:n}:e)},e.prototype[ti]=function(){return this},e}(),ri;try{ri={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch{ri={indexedDB:null,IDBKeyRange:null}}function ii(e){var t=!1,n,r=new ni(function(r){var i=U(e);function a(t){var n=qe();try{i&&ct();var r=st(e,t);return i&&(r=r.finally(lt)),r}finally{n&&Je()}}var o=!1,s,c={},l={},u={get closed(){return o},unsubscribe:function(){o||(o=!0,s&&s.abort(),d&&vn.storagemutated.unsubscribe(m))}};r.start&&r.start(u);var d=!1,f=function(){return _t(h)};function p(){return gr(l,c)}var m=function(e){hr(c,e),p()&&f()},h=function(){if(!(o||!ri.indexedDB)){c={};var i={};s&&s.abort(),s=new AbortController;var u={subscr:i,signal:s.signal,requery:f,querier:e,trans:null},p=a(u);Promise.resolve(p).then(function(e){t=!0,n=e,!(o||u.signal.aborted)&&(c={},l=i,!M(l)&&!d&&(vn(gn,m),d=!0),_t(function(){return!o&&r.next&&r.next(e)}))},function(e){t=!1,[`DatabaseClosedError`,`AbortError`].includes(e?.name)||o||_t(function(){o||r.error&&r.error(e)})})}};return setTimeout(f,0),u});return r.hasValue=function(){return t},r.getValue=function(){return n},r}var ai=ei;d(ai,n(n({},ce),{delete:function(e){return new ai(e,{addons:[]}).delete()},exists:function(e){return new ai(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch(`NoSuchDatabaseError`,function(){return!1})},getDatabaseNames:function(e){try{return tr(ai.dependencies).then(e)}catch{return vt(new J.MissingAPI)}},defineClass:function(){function e(e){s(this,e)}return e},ignoreTransaction:function(e){return X.trans?ht(X.transless,e):e()},vip:ir,async:function(e){return function(){try{var t=wr(e.apply(this,arguments));return!t||typeof t.then!=`function`?Z.resolve(t):t}catch(e){return vt(e)}}},spawn:function(e,t,n){try{var r=wr(e.apply(n,t||[]));return!r||typeof r.then!=`function`?Z.resolve(r):r}catch(e){return vt(e)}},currentTransaction:{get:function(){return X.trans||null}},waitFor:function(e,t){var n=Z.resolve(typeof e==`function`?ai.ignoreTransaction(e):e).timeout(t||6e4);return X.trans?X.trans.waitFor(n):n},Promise:Z,debug:{get:function(){return _e},set:function(e){ve(e)}},derive:m,extend:s,props:d,override:y,Events:Vt,on:vn,liveQuery:ii,extendObservabilitySet:hr,getByKeyPath:C,setByKeyPath:w,delByKeyPath:T,shallowClone:E,deepClone:P,getObjectDiff:Ar,cmp:Q,asap:x,minKey:St,addons:[],connections:Tt,errnames:ie,dependencies:ri,cache:_r,semVer:bt,version:bt.split(`.`).map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/10**(n*2)})})),ai.maxKey=Tn(ai.dependencies.IDBKeyRange),typeof dispatchEvent<`u`&&typeof addEventListener<`u`&&(vn(gn,function(e){if(!si){var t=new CustomEvent(_n,{detail:e});si=!0,dispatchEvent(t),si=!1}}),addEventListener(_n,function(e){var t=e.detail;si||oi(t)}));function oi(e){var t=si;try{si=!0,vn.storagemutated.fire(e),xr(e,!0)}finally{si=t}}var si=!1,ci,li=function(){};typeof BroadcastChannel<`u`&&(li=function(){ci=new BroadcastChannel(_n),ci.onmessage=function(e){return e.data&&oi(e.data)}},li(),typeof ci.unref==`function`&&ci.unref(),vn(gn,function(e){si||ci.postMessage(e)})),typeof addEventListener<`u`&&(addEventListener(`pagehide`,function(e){if(!ei.disableBfCache&&e.persisted){_e&&console.debug(`Dexie: handling persisted pagehide`),ci?.close();for(var t=0,n=Tt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener(`pageshow`,function(e){!ei.disableBfCache&&e.persisted&&(_e&&console.debug(`Dexie: handling persisted pageshow`),li(),oi({all:new cr(-1/0,[[]])}))}));function ui(e){return new Rt({add:e})}function di(e){return new Rt({remove:e})}function fi(e,t){return new Rt({replacePrefix:[e,t]})}return Z.rejectionMapper=se,ve(_e),n(ei,Object.freeze({__proto__:null,Dexie:ei,liveQuery:ii,Entity:Mt,cmp:Q,PropModification:Rt,replacePrefix:fi,add:ui,remove:di,default:ei,RangeSet:cr,mergeRanges:ur,rangesOverlap:dr}),{default:ei}),ei}))})),D,O,k,A,j,M,N,P,F,I,L,R,z,B,V,H=o((()=>{if(D=u(E(),1),O=Symbol.for(`Dexie`),k=globalThis[O]||(globalThis[O]=D.default),D.default.semVer!==k.semVer)throw Error(`Two different versions of Dexie loaded in the same app: ${D.default.semVer} and ${k.semVer}`);({liveQuery:A,mergeRanges:j,rangesOverlap:M,RangeSet:N,cmp:P,Entity:F,PropModification:I,replacePrefix:L,add:R,remove:z,DexieYProvider:B}=k),V=k})),U,W,G=o((()=>{T(),H(),U=Object.freeze({APP:`app`,GRAPHS:`graphs`,COMPONENTS:`components`,CONNECTIONS:`connections`,DATASETS:`datasets`,CELLS:`cells`,SELF:`self`,PEERS:`peers`,MESSAGES:`messages`}),W=class{#dbPromise;#dbName;#stores={[U.APP]:`id,autoConnect,devMode,updatedAt,createdAt`,[U.GRAPHS]:`id,name,description,*tags,updatedAt,createdAt`,[U.COMPONENTS]:`id,typeId,parentId,layer,order,values,updatedAt,createdAt`,[U.CONNECTIONS]:`id,parentId,fromComponentId,fromGateId,toComponentId,toGateId,updatedAt,createdAt`,[U.DATASETS]:`id,name,columns,*tags,updatedAt,createdAt`,[U.CELLS]:`[datasetId+row+column],[datasetId+row],[datasetId+column],datasetId,row,column,value,updatedAt,createdAt`,[U.SELF]:`id,publicKey,privateKey,peerName,firstName,lastName,profileImage,updatedAt,createdAt`,[U.PEERS]:`id,publicKey,peerName,firstName,lastName,profileImage,*tags,updatedAt,createdAt`,[U.MESSAGES]:`id,fromId,toId,type,content,seenAt,sentAt,receivedAt,updatedAt,createdAt`};constructor(e){this.#dbName=e}async#init(){let e=new V(this.#dbName);return e.version(1).stores(this.#stores),await e.open(),e}createId(){return C()}async get(){return this.#dbPromise||=this.#init(),this.#dbPromise}async add(e,t,n=!0){let r=(await this.get())[e],i={...t,updatedAt:Date.now()};return n&&(i.id=t.id||this.createId()),await r.add(i),i.id}async put(e,t){await(await this.get())[e].put({...t,updatedAt:Date.now()})}async update(e,t,n){await(await this.get())[e].update(t,{...n,updatedAt:Date.now()})}async getById(e,t){return(await this.get())[e].get(t)}async getAll(e){return(await this.get())[e].toArray()}async where(e,t,n){return(await this.get())[e].where(t).equals(n).toArray()}async delete(e,t){await(await this.get())[e].delete(t)}async clear(e){await(await this.get())[e].clear()}async query(e,t){let n=(await this.get())[e];if(!n)throw Error(`Invalid resource: ${e}`);return t(n)}async transaction(e,t){let n=await this.get(),r=(e||[]).map(e=>n[e]).filter(Boolean);if(r.length===0)throw Error(`FnetDatabase.transaction: no valid tables provided`);return n.transaction(`rw`,...r,()=>t(...r))}async addMany(e,t,n=!0){if(!Array.isArray(t)||t.length===0)return[];let r=(await this.get())[e],i=Date.now(),a=t.map(e=>{let t={...e,updatedAt:i};return n&&(t.id=e.id||this.createId()),t});return await r.bulkAdd(a),n?a.map(e=>e.id):[]}async each(e,t,n){let r=(await this.get()).table(e);await t(r).each(n)}}}));function K(e){if(typeof e!=`object`||!e||Object.isFrozen(e))return e;let t=Object.getOwnPropertyNames(e);for(let n=0;n<t.length;n++){let r=e[t[n]];r&&typeof r==`object`&&K(r)}return Object.freeze(e)}function ee(){return Math.floor(1e4+Math.random()*9e4)}var q=o((()=>{})),te,ne=o((()=>{te={id:`empty`,tags:[`sugar`],settings:[{id:`typeId`,type:`string`,role:`setting`,shape:`FnetSettingSelectEmpty`}]}})),re,ie=o((()=>{re={id:`pipe`,tags:[`sugar`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`any`,role:`output`},{id:`input`,type:`any`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`value`,e(`value`))}}})),ae,J,oe,se,ce,Y,le,ue,de,fe,pe,me,he,ge,_e,ve,ye,be,xe,Se,Ce,we,Te,Ee,De,Oe,ke,Ae,je,Me=o((()=>{ae={id:`add`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`input1`,type:`number`,role:`input`},{id:`input2`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`input1`),r=e(`input2`);t(`output`,n+r)}},J={id:`subtract`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,(e(`a`)??0)-(e(`b`)??0))}},oe={id:`multiply`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,(e(`a`)??0)*(e(`b`)??0))}},se={id:`divide`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`b`);t(`output`,n===0?null:(e(`a`)??0)/n)}},ce={id:`power`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,(e(`a`)??0)**+(e(`b`)??0))}},Y={id:`modulo`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`b`)??1;t(`output`,(e(`a`)??0)%n)}},le={id:`abs`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.abs(e(`a`)??0))}},ue={id:`sin`,tags:[`math`,`trig`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.sin(e(`a`)??0))}},de={id:`cos`,tags:[`math`,`trig`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.cos(e(`a`)??0))}},fe={id:`tan`,tags:[`math`,`trig`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.tan(e(`a`)??0))}},pe={id:`random`,tags:[`math`,`random`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`min`,type:`number`,role:`input`},{id:`max`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`min`)??0,r=e(`max`)??1;t(`output`,Math.random()*(r-n)+n)}},me={id:`round`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.round(e(`a`)??0))}},he={id:`floor`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.floor(e(`a`)??0))}},ge={id:`ceil`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.ceil(e(`a`)??0))}},_e={id:`sqrt`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.sqrt(e(`a`)??0))}},ve={id:`exp`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.exp(e(`a`)??0))}},ye={id:`log`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`a`);t(`output`,n>0?Math.log(n):null)}},be={id:`log10`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`a`);t(`output`,n>0?Math.log10(n):null)}},xe={id:`min`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.min(e(`a`)??0,e(`b`)??0))}},Se={id:`max`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.max(e(`a`)??0,e(`b`)??0))}},Ce={id:`clamp`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`value`,type:`number`,role:`input`},{id:`min`,type:`number`,role:`input`},{id:`max`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`value`)??0,r=e(`min`)??0,i=e(`max`)??1;t(`output`,Math.min(Math.max(n,r),i))}},we={id:`average`,tags:[`math`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`b`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,((e(`a`)??0)+(e(`b`)??0))/2)}},Te={id:`asin`,tags:[`math`,`trig`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.asin(e(`a`)??0))}},Ee={id:`acos`,tags:[`math`,`trig`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.acos(e(`a`)??0))}},De={id:`atan`,tags:[`math`,`trig`],settings:[{id:`output`,type:`number`,role:`output`},{id:`a`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.atan(e(`a`)??0))}},Oe={id:`atan2`,tags:[`math`,`trig`],settings:[{id:`output`,type:`number`,role:`output`},{id:`y`,type:`number`,role:`input`},{id:`x`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,Math.atan2(e(`y`)??0,e(`x`)??0))}},ke={id:`deg2rad`,tags:[`math`,`conversion`],settings:[{id:`output`,type:`number`,role:`output`},{id:`degrees`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,(e(`degrees`)??0)*(Math.PI/180))}},Ae={id:`rad2deg`,tags:[`math`,`conversion`],settings:[{id:`output`,type:`number`,role:`output`},{id:`radians`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,(e(`radians`)??0)*(180/Math.PI))}},je={id:`mapRange`,tags:[`math`,`utility`],settings:[{id:`output`,type:`number`,role:`output`},{id:`value`,type:`number`,role:`input`},{id:`inMin`,type:`number`,role:`input`},{id:`inMax`,type:`number`,role:`input`},{id:`outMin`,type:`number`,role:`input`},{id:`outMax`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`value`)??0,r=e(`inMin`)??0,i=e(`inMax`)??1,a=e(`outMin`)??0,o=e(`outMax`)??1,s=(n-r)*(o-a)/(i-r)+a;t(`output`,s)}}})),Ne,Pe,Fe,X,Ie,Le,Re,Z,ze,Be,Ve,He,Ue,We,Ge,Ke,qe,Je,Ye=o((()=>{Ne={id:`simpleInterest`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`principal`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`time`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`principal`)??0,r=e(`rate`)??0,i=e(`time`)??0;t(`output`,n*r*i)}},Pe={id:`compoundInterest`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`principal`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`times`,type:`number`,role:`input`},{id:`time`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`principal`)??0,r=e(`rate`)??0,i=e(`times`)??1,a=e(`time`)??0;t(`output`,n*(1+r/i)**+(i*a))}},Fe={id:`futureValue`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`present`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`periods`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`present`)??0,r=e(`rate`)??0,i=e(`periods`)??0;t(`output`,n*(1+r)**+i)}},X={id:`presentValue`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`future`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`periods`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`future`)??0,r=e(`rate`)??0,i=e(`periods`)??0;t(`output`,n/(1+r)**+i)}},Ie={id:`payment`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`principal`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`periods`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`principal`)??0,r=e(`rate`)??0,i=e(`periods`)??1,a=r*n/(1-(1+r)**+-i);t(`output`,a)}},Le={id:`loanBalance`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`principal`,type:`number`,role:`input`},{id:`rate`,type:`number`,role:`input`},{id:`periods`,type:`number`,role:`input`},{id:`paid`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`principal`)??0,r=e(`rate`)??0,i=e(`periods`)??1,a=e(`paid`)??0,o=r*n/(1-(1+r)**+-i),s=n*(1+r)**+a-o*(((1+r)**+a-1)/r);t(`output`,s)}},Re={id:`roi`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`gain`,type:`number`,role:`input`},{id:`cost`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`gain`)??0,r=e(`cost`)??1;t(`output`,(n-r)/r)}},Z={id:`cagr`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`start`,type:`number`,role:`input`},{id:`end`,type:`number`,role:`input`},{id:`years`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`start`)??1,r=e(`end`)??1,i=e(`years`)??1;t(`output`,(r/n)**(1/i)-1)}},ze={id:`depreciationSL`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`cost`,type:`number`,role:`input`},{id:`salvage`,type:`number`,role:`input`},{id:`life`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`cost`)??0,r=e(`salvage`)??0,i=e(`life`)??1;t(`output`,(n-r)/i)}},Be={id:`percentChange`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`current`,type:`number`,role:`input`},{id:`previous`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`current`)??0,r=e(`previous`)??0;t(`output`,r===0?0:(n-r)/r*100)}},Ve={id:`profitLoss`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`buy`,type:`number`,role:`input`},{id:`sell`,type:`number`,role:`input`},{id:`qty`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`buy`)??0,r=e(`sell`)??0,i=e(`qty`)??0;t(`output`,(r-n)*i)}},He={id:`profitPercent`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`buy`,type:`number`,role:`input`},{id:`sell`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`buy`)??0,r=e(`sell`)??0;t(`output`,n===0?0:(r-n)/n*100)}},Ue={id:`breakEven`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`buy1`,type:`number`,role:`input`},{id:`qty1`,type:`number`,role:`input`},{id:`buy2`,type:`number`,role:`input`},{id:`qty2`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`buy1`)??0,r=e(`qty1`)??0,i=e(`buy2`)??0,a=e(`qty2`)??0,o=r+a,s=o===0?0:(n*r+i*a)/o;t(`output`,s)}},We={id:`portfolioValue`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`price1`,type:`number`,role:`input`},{id:`qty1`,type:`number`,role:`input`},{id:`price2`,type:`number`,role:`input`},{id:`qty2`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=(e(`price1`)??0)*(e(`qty1`)??0),r=(e(`price2`)??0)*(e(`qty2`)??0);t(`output`,n+r)}},Ge={id:`riskReward`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`entry`,type:`number`,role:`input`},{id:`target`,type:`number`,role:`input`},{id:`stop`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`entry`)??0,r=e(`target`)??0,i=e(`stop`)??0,a=n-i,o=r-n;t(`output`,a===0?0:o/a)}},Ke={id:`positionSize`,tags:[`finance`],settings:[{id:`output`,type:`number`,role:`output`},{id:`capital`,type:`number`,role:`input`},{id:`riskPercent`,type:`number`,role:`input`},{id:`entry`,type:`number`,role:`input`},{id:`stop`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=e(`capital`)??0,r=e(`riskPercent`)??0,i=e(`entry`)??0,a=e(`stop`)??0,o=Math.abs(i-a);t(`output`,o===0?0:n*(r/100)/o)}},qe={id:`movingAverage`,tags:[`finance`,`indicator`],settings:[{id:`output`,type:`number`,role:`output`},{id:`p1`,type:`number`,role:`input`},{id:`p2`,type:`number`,role:`input`},{id:`p3`,type:`number`,role:`input`},{id:`p4`,type:`number`,role:`input`},{id:`p5`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=[e(`p1`),e(`p2`),e(`p3`),e(`p4`),e(`p5`)].filter(e=>e!=null),r=n.length?n.reduce((e,t)=>e+t,0)/n.length:0;t(`output`,r)}},Je={id:`volatility`,tags:[`finance`,`indicator`],settings:[{id:`output`,type:`number`,role:`output`},{id:`r1`,type:`number`,role:`input`},{id:`r2`,type:`number`,role:`input`},{id:`r3`,type:`number`,role:`input`},{id:`r4`,type:`number`,role:`input`},{id:`r5`,type:`number`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){let n=[e(`r1`),e(`r2`),e(`r3`),e(`r4`),e(`r5`)].filter(e=>e!=null);if(n.length<2)return t(`output`,0);let r=n.reduce((e,t)=>e+t,0)/n.length,i=n.reduce((e,t)=>e+(t-r)**2,0)/(n.length-1);t(`output`,Math.sqrt(i))}}})),Xe,Ze,Qe,$e=o((()=>{Xe=`fnet-temp`,Object.freeze({TABLE:`table`,DEFINITION:`definition`}),Ze=Object.freeze({EMPTY:`empty`,GRAPH:`graph`,INPUT:`input`,OUTPUT:`output`,PIPE:`pipe`,DATASET:`dataset`}),Qe=`wss://www.onclick.com.tr`}));async function et(e,t){let{values:n,settings:r}=e,i=n?.programId;if(!i)return;let a=await Tt.getById(i,t);if(!a){console.warn(`Subgraph not found: ${i}`);return}let o=await xt.getByParent(i,t),s=o.filter(e=>e.typeId===Ze.INPUT),c=o.filter(e=>e.typeId===Ze.OUTPUT);s.forEach((e,t)=>r.push({id:e.id,name:e.values?.name??`input-${t+1}`,type:e.values?.type??`any`,role:`input`})),c.forEach((e,t)=>r.push({id:e.id,name:e.values?.name??`output-${t+1}`,type:e.values?.type??`any`,role:`output`})),e.values.name=e.values.name||a.name}var tt,nt,rt,it=o((()=>{$e(),Et(),St(),tt={id:`subGraph`,tags:[`subGraph`],shape:`FnetSubGraph`,settings:[{id:`name`,type:`string`,role:`setting`},{id:`graphId`,type:`graph`,role:`setting`,hidden:!0},{id:`run`,type:`signal`,role:`input`}],async activate({setting:e,getAll:t,setAll:n,activate:r},i){let a=t(),o=await r(e(`graphId`),i,a);n(o)},hooks:{async onAfterLoad({component:e,manager:t}){await et(e,t)},async onAfterUpdateSetting({component:e,settingId:t,manager:n}){t===`graphId`&&await et(e,n)}}},nt={id:`input`,tags:[`subGraph`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`type`,type:`type`,role:`setting`,shape:`FnetSettingSelectType`},{id:`output`,type:`any`,role:`output`},{id:`input`,type:`any`,role:`input`,hidden:!0},{id:`run`,type:`signal`,role:`input`}],activate({set:e,get:t}){e(`output`,t(`input`))},hooks:{onInitialize(){},onAdd(){},onRemove(){},onConnect(){},onDisconnect(){},onMove(){},onValueChange(){}}},rt={id:`output`,tags:[`subGraph`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`type`,type:`type`,role:`setting`,shape:`FnetSettingSelectType`},{id:`output`,type:`any`,role:`output`,hidden:!0},{id:`input`,type:`any`,role:`input`},{id:`run`,type:`signal`,role:`input`}],activate({get:e,set:t}){t(`output`,e(`input`))}}})),at,ot,st=o((()=>{at={id:`button`,shape:`FnetButton`,tags:[`interactive`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`run`,type:`signal`,role:`input`},{id:`click`,type:`signal`,role:`output`}],activate(e,t){if(t===`click`)return`run`}},ot={id:`interval`,shape:`FnetInterval`,tags:[`interactive`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`start`,type:`signal`,role:`input`},{id:`stop`,type:`signal`,role:`input`},{id:`run`,type:`signal`,role:`input`},{id:`tick`,type:`signal`,role:`output`},{id:`interval`,type:`number`,role:`setting`},{id:`intervalId`,type:`number`,role:`state`}],activate({emit:e,get:t,set:n},r){switch(r){case`start`:n(`intervalId`,setInterval(()=>{e(`tick`)},1e3));return;case`stop`:clearInterval(t(`intervalId`));return;case`tick`:console.log(`firing tick event`);return}},hooks:{onBeforeStart(){},onBeforeStop(){}}}})),ct,lt=o((()=>{ct={id:`debug`,tags:[`util`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`run`,type:`signal`,role:`input`}],activate(e,t){console.log(`activated`,t)}}}));function ut(e,t){let n=t.columns?{type:`cursor`,datasetId:t.id,columns:t.columns}:t,r=Object.create(dt);return Object.assign(r,n,{db:e}),r}var dt,ft,pt,mt=o((()=>{G(),dt={async each(e){await this.db.each(U.CELLS,e=>e.where(`datasetId`).equals(this.datasetId),e)},async toArray(){let e=[];return await this.each(t=>e.push(t)),e},async column(e){let t=this.db,n=[];return await t.each(U.CELLS,t=>t.where({datasetId:this.datasetId,column:e}),e=>n.push(e.value)),n}},ft={id:`dataset`,tags:[`dataset`],settings:[{id:`datasetId`,type:`dataset`,role:`setting`},{id:`run`,type:`signal`,role:`input`},{id:`cursor`,type:`object`,role:`output`}],async activate(e,t,{db:n}){if(t!==`run`)return!1;let r=e.setting(`datasetId`);if(!r)return!1;let i=await n.getById(U.DATASETS,r);if(!i)return!1;let a=ut(n,i);e.set(`cursor`,a)}},pt={id:`sum`,tags:[`math`,`dataset`],settings:[{id:`cursor`,type:`object`,role:`input`},{id:`column`,type:`string`,role:`setting`,shape:`FnetSettingSelect`},{id:`run`,type:`signal`,role:`input`},{id:`result`,type:`number`,role:`output`}],async activate(e,t){if(t!==`run`)return!1;let n=e.get(`cursor`),r=e.setting(`column`);if(!n||!r)return!1;let i=(await n.column(parseInt(r))).reduce((e,t)=>e+Number(t||0),0);e.set(`result`,i)}}})),ht,gt=o((()=>{ht={id:`constant`,tags:[`math`],settings:[{id:`name`,type:`string`,role:`setting`},{id:`output`,type:`number`,role:`output`},{id:`value`,type:`number`,role:`setting`},{id:`run`,type:`signal`,role:`input`}],activate({set:e,setting:t}){e(`output`,t(`value`))}}})),_t=c({abs:()=>le,acos:()=>Ee,add:()=>ae,asin:()=>Te,atan:()=>De,atan2:()=>Oe,average:()=>we,breakEven:()=>Ue,button:()=>at,cagr:()=>Z,ceil:()=>ge,clamp:()=>Ce,compoundInterest:()=>Pe,constant:()=>ht,cos:()=>de,createCursor:()=>ut,dataset:()=>ft,debug:()=>ct,deg2rad:()=>ke,depreciationSL:()=>ze,divide:()=>se,empty:()=>te,exp:()=>ve,floor:()=>he,futureValue:()=>Fe,input:()=>nt,interval:()=>ot,loanBalance:()=>Le,log:()=>ye,log10:()=>be,mapRange:()=>je,max:()=>Se,min:()=>xe,modulo:()=>Y,movingAverage:()=>qe,multiply:()=>oe,output:()=>rt,payment:()=>Ie,percentChange:()=>Be,pipe:()=>re,portfolioValue:()=>We,positionSize:()=>Ke,power:()=>ce,presentValue:()=>X,profitLoss:()=>Ve,profitPercent:()=>He,rad2deg:()=>Ae,random:()=>pe,riskReward:()=>Ge,roi:()=>Re,round:()=>me,simpleInterest:()=>Ne,sin:()=>ue,sqrt:()=>_e,subGraph:()=>tt,subtract:()=>J,sum:()=>pt,tan:()=>fe,volatility:()=>Je}),vt=o((()=>{ne(),ie(),Me(),Ye(),it(),st(),lt(),mt(),gt()})),yt,bt=o((()=>{q(),yt=class{static all={};static safe={};static async init(){let{all:e,safe:t}=await this.loadTypes();this.all=e,this.safe=t}static async loadTypes(){let e={},t={},n=await Promise.resolve().then(()=>(vt(),_t));for(let[r,i]of Object.entries(n)){let n=this.createType(i);e[r]=n,t[r]=n.safe}return{all:e,safe:t}}static async loadPackage(e=[]){let t={},n={},r=async e=>{try{let r=await import(e);for(let e of Object.values(r)){if(!e?.id)continue;let r=this.createType(e);t[r.id]=r,n[r.id]=r.safe}}catch(t){console.error(`Failed to load package:`,e,t)}};if(Array.isArray(e))for(let t of e)await r(t);else typeof e==`string`&&await r(e);return{all:t,safe:n}}static createType({id:e,name:t,description:n=``,emits:r,activate:i,tags:a=[],settings:o=[],shape:s=``,hooks:c={}}){let l={id:e,name:t,description:n,tags:[`Fnet`,`Core`,...a],emits:r,activate:i,hooks:c,shape:s,settings:o},u={...l,activate:void 0,hooks:void 0};return l.safe=K(u),K(l)}static get(e,t=!1){return t?this.safe[e]:this.all[e]}static resolve(e,t=!1){return this.get(e.component?.typeId||e.typeId,t)}static search(e){let t=e.toLowerCase();return Object.values(this.safe).filter(e=>e.name.toLowerCase().includes(t)).map(e=>({id:e.id,type:`primitive`,name:e.name,description:e.description||``}))}static async callHook(e,t,n){let r=e.hooks?.[t];typeof r==`function`&&await Promise.resolve(r({type:e,...n}))}static async beforeAdd(e){let t=this.resolve(e);await this.callHook(t,`onBeforeAdd`,e)}static async afterAdd(e){let t=this.resolve(e);await this.callHook(t,`onAfterAdd`,e)}static async afterLoad(e){let t=this.resolve(e);await this.callHook(t,`onAfterLoad`,e)}static async beforeUpdateSetting(e){let t=this.resolve(e);await this.callHook(t,`onBeforeUpdateSetting`,e)}static async afterUpdateSetting(e){let t=this.resolve(e);await this.callHook(t,`onAfterUpdateSetting`,e)}static async beforeRemove(e){let t=this.resolve(e);await this.callHook(t,`onBeforeRemove`,e)}static async afterRemove(e){let t=this.resolve(e);await this.callHook(t,`onAfterRemove`,e)}}})),xt,St=o((()=>{G(),bt(),xt=class{static async getById(e,{db:t}){return await t.getById(U.COMPONENTS,e)}static async getByParent(e,{db:t}){return await t.where(U.COMPONENTS,`parentId`,e)}static async afterLoad({component:e,parent:t,manager:n}){let r=yt.get(e.typeId);e.settings=r.settings?[...r.settings]:[],e.shape=r.shape,e.typeName=r.name,await yt.afterLoad({component:e,parent:t,manager:n})}static async add({typeId:e,parentId:t,order:n,layer:r,values:i={}},a){let o={typeId:e,parentId:t,order:n,layer:r,values:i,createdAt:Date.now(),updatedAt:Date.now()},s=yt.get(e);return await yt.beforeAdd({component:o,manager:a}),o.id=await a.db.add(U.COMPONENTS,o),o.typeName=s.name,o.settings=s.settings,o.shape=s.shape,await yt.afterAdd({component:o,manager:a}),a.engine.addComponent(t,o),o}static async remove(e,t){await yt.beforeRemove({component:e,manager:t}),await t.db.delete(U.COMPONENTS,e.id),await yt.afterRemove({component:e,manager:t})}static async update(e,t,{db:n}){await n.update(U.COMPONENTS,e,{...t,updatedAt:Date.now()})}static populate(e){let t=e.typeId,n=yt.get(t,!0);e.typeName=n.name,e.shape=n.shape,e.settings=[...n.settings]}static async updateSetting({id:e,settingId:t,value:n},r){let i=await this.getById(e,r);if(!i)return null;this.populate(i);let a=i.values,o=a[t];return n===o?null:(await yt.beforeUpdateSetting({component:i,settingId:t,oldValue:o,value:n,manager:r}),a[t]=n,await this.update(e,{values:a},r),await yt.afterUpdateSetting({component:i,settingId:t,oldValue:o,value:n,manager:r}),i)}}})),Ct,wt=o((()=>{G(),Ct=class{static async getByParent(e,{db:t}){return await t.where(U.CONNECTIONS,`parentId`,e)}static async add({parentId:e,fromComponentId:t,fromGateId:n,toComponentId:r,toGateId:i},{db:a}){let o={parentId:e,fromComponentId:t,fromGateId:n,toComponentId:r,toGateId:i,createdAt:Date.now(),updatedAt:Date.now()};return o.id=await a.add(U.CONNECTIONS,o),o}static async remove(e,{db:t}){await t.delete(U.CONNECTIONS,e)}static async removeByComponent(e,{db:t}){let n=[];return await t.query(U.CONNECTIONS,async t=>{let r=await t.filter(t=>t.fromComponentId===e||t.toComponentId===e).toArray();for(let e of r)await t.delete(e.id),n.push(e.id)}),n}}})),Tt,Et=o((()=>{St(),wt(),G(),q(),Tt=class{#id;#data;#components;#connections;#inMap;#outMap;#inCompMap;#outCompMap;#outGateMap;constructor(e){this.reset(e,e.components,e.connections)}get id(){return this.#id}reset(e,t=[],n=[]){this.#id=e.id,this.#data=e,this.#components=new Map,this.#connections=new Map,this.#inMap=new Map,this.#outMap=new Map,this.#inCompMap=new Map,this.#outCompMap=new Map,this.#outGateMap=new Map;for(let e of t)this.addComponent(e);for(let e of n)this.addConnection(e)}get components(){return this.#components.values()}get connections(){return this.#connections.values()}addComponent(e){let t=e.id;this.#components.has(t)||(this.#components.set(t,e),this.#inMap.set(t,new Set),this.#outMap.set(t,new Set),this.#inCompMap.set(t,new Set),this.#outCompMap.set(t,new Set))}removeComponent(e){if(!this.#components.has(e))return;let t=this.#inMap.get(e),n=this.#outMap.get(e);if(t)for(let e of t)this.removeConnection(e.id,!0);if(n)for(let e of n)this.removeConnection(e.id,!0);this.#inMap.delete(e),this.#outMap.delete(e),this.#inCompMap.delete(e),this.#outCompMap.delete(e),this.#components.delete(e)}updateComponent(e,t,n){let r=this.#components.get(e);r.values[t]=n}addConnection(e){let{id:t,fromComponentId:n,fromGateId:r,toComponentId:i}=e;if(!n||!i||!this.#components.has(n)||!this.#components.has(i)||this.#connections.has(t))return;this.#connections.set(t,e),this.#outMap.get(n).add(e),this.#inMap.get(i).add(e),this.#outCompMap.get(n).add(i),this.#inCompMap.get(i).add(n);let a=this.#outGateMap.get(n);a||(a=new Map,this.#outGateMap.set(n,a));let o=a.get(r);o||(o=new Set,a.set(r,o)),o.add(e)}removeConnection(e){let t=this.#connections.get(e);if(!t)return;let{fromComponentId:n,fromGateId:r,toComponentId:i}=t;this.#connections.delete(e),this.#outMap.get(n)?.delete(t),this.#inMap.get(i)?.delete(t),this.#outCompMap.get(n)?.delete(i),this.#inCompMap.get(i)?.delete(n);let a=this.#outGateMap.get(n);if(a){let e=a.get(r);e&&(e.delete(t),e.size===0&&a.delete(r)),a.size===0&&this.#outGateMap.delete(n)}}getOutComponents(e){return this.#outCompMap.get(e)}getInComponents(e){return this.#inCompMap.get(e)}forEachComponent(e){for(let t of this.#components.values())e(t)}getComponent(e){return this.#components.get(e)??null}getConnection(e){return this.#connections.get(e)??null}getOutEdges(e){return this.#outMap.get(e)}getInEdges(e){return this.#inMap.get(e)}getOutEdgesByGate(e,t){return this.#outGateMap.get(e)?.get(t)??new Set}toJSON(){return{id:this.id,...this.#data,components:Array.from(this.#components.values()).map(e=>({id:e.id,typeId:e.typeId,typeName:e.typeName,shape:e.shape,name:e.name,order:e.order,layer:e.layer,values:structuredClone(e.values??{}),settings:structuredClone(e.settings??[])})),connections:Array.from(this.#connections.values()).map(e=>({id:e.id,fromComponentId:e.fromComponentId,fromGateId:e.fromGateId,toComponentId:e.toComponentId,toGateId:e.toGateId}))}}[Symbol.structuredClone](){return this.toJSON()}static async create({name:e=`Graph-`+ee(),description:t=``,tags:n=[]},{db:r}){let i={name:e,description:t,tags:n,createdAt:Date.now(),updatedAt:Date.now()};return{id:await r.add(U.GRAPHS,i),...i}}static async getById(e,{db:t}){return await t.getById(U.GRAPHS,e)}static async load(e,t){let n=await this.getById(e,t);if(!n)throw Error(`Graph definition not found`);let r=await xt.getByParent(e,t),i=await Ct.getByParent(e,t);n.components=r,n.connections=i;for(let e of n.components)await xt.afterLoad({component:e,graph:n,manager:t});return n}static async update(e,t,{db:n}){await n.update(U.GRAPHS,e,t)}static async delete(e,{db:t}){await t.delete(U.GRAPHS,e)}static async search(e,t){return await t.db.query(U.GRAPHS,async t=>(await t.toArray()).filter(t=>t.name?.toLowerCase().includes(e)).map(e=>({id:e.id,type:`graph`,name:e.name,description:e.description||``})))}static async getByTags(e,{db:t}){return e.length===0?t.getAll(U.GRAPHS):t.query(U.GRAPHS,t=>t.where(`tags`).anyOf(e).toArray())}static async collectTags({db:e}){let t=new Set,n=await e.getAll(U.GRAPHS);for(let e of n)if(Array.isArray(e.tags))for(let n of e.tags)typeof n==`string`&&n.trim()&&t.add(n.toLowerCase());return Array.from(t).sort()}static getGraphIO(e){let t=[],n=[],r=[];if(!e)return{inputs:t,outputs:n,signals:r};let i=new Map,a=new Map;for(let t of e.connections??[])i.has(t.toComponentId)||i.set(t.toComponentId,[]),i.get(t.toComponentId).push(t),a.has(t.fromComponentId)||a.set(t.fromComponentId,[]),a.get(t.fromComponentId).push(t);for(let o of e.components??[]){let e=i.has(o.id),s=a.get(o.id)??[],c=(o.tags??[]).map(e=>e.toLowerCase());for(let i of o.settings??[]){let a=`${o.id}-${i.id}`;o.typeId===`input`&&i.role===`input`&&!e&&i.type!==`signal`?t.push({componentId:o.id,id:i.id,key:a,name:o.values?.name||i.id,type:i.type,default:o.values?.[i.id]}):o.typeId===`output`&&i.role===`output`&&i.type!==`signal`?s.some(e=>e.fromGateId===i.id)||n.push({componentId:o.id,id:i.id,key:a,name:o.values?.name||i.id,type:i.type}):i.type===`signal`&&c.includes(`interactive`)&&r.push({componentId:o.id,id:i.id,key:a})}}return{inputs:t,outputs:n,signals:r}}}}));T(),$e(),bt(),Et();var Dt=class{#id;#parentId;#engine;#graph;#queue=[];#built=!1;#running=!1;#ticking=!1;#scheduled=!1;#slots={};#ranks=new Map;#io=new Map;#busy=new Set;constructor(e,t,n,r){this.#engine=t,this.#id=e??C(),this.#parentId=n,this.#graph=r}get id(){return this.#id}get parentId(){return this.#parentId}get graph(){return this.#graph}get built(){return this.#built}get running(){return this.#running}get ticking(){return this.#ticking}get queueSize(){return this.#queue.length}get state(){return{id:this.#id,running:this.#running,ticking:this.#ticking,isRoot:!this.#parentId}}async build(){this.#built||=(this.#prepareSlots(),!0)}async start(){this.#running||=(this.#built||await this.build(),!0)}async stop(){this.#running&&(this.#running=!1,this.#queue.length=0,this.#ticking=!1)}async dispose(){this.#running=!1,this.#ticking=!1,this.#queue.length=0;for(let e of Object.values(this.#slots))for(let t of Object.values(e))this.#memory.freeValue(t.ptr);this.#slots={},this.#io.clear(),this.#ranks.clear(),this.#built=!1}async tick(){if(this.#ticking||this.#queue.length===0)return;this.#ticking=!0;let e=this.#queue.splice(0);await Promise.all(e.map(e=>this.#runOne(e))),this.#ticking=!1;let t=this.#getComponentIOData();this.#engine.manager.onIO(this.#graph.id,t),this.#queue.length&&queueMicrotask(()=>this.tick())}trigger(e,t){this.#enqueue({targetId:e,event:t})}triggerInitial(e=`run`,t){for(let[e,n]of Object.entries(t))for(let[t,{value:r}]of Object.entries(n))this.#setComponentGate(e,t,r);for(let t of this.#graph.components)this.#isInitial(t,this.#graph)&&this.#enqueue({targetId:t.id,event:e})}async waitIdle(){for(;this.ticking||this.queueSize>0;)await new Promise(e=>queueMicrotask(e))}addComponentSlots(e){let t=this.#slots[e.id]={},n=e.settings,r=e.values??{};for(let e of n){let n=e.id;if(e.type===`signal`&&(e.role===`input`||e.role===`output`))t[n]={ptr:this.#memory.allocValue(`boolean`,!1),type:e.type,role:e.role};else{let i=r[n];t[n]={ptr:this.#memory.allocValue(e.type,i),type:e.type,role:e.role}}}this.#createIO(e),this.#computeRanks()}removeComponentSlots(e){let t=this.#slots[e];if(t){for(let e in t)this.#memory.freeValue(t[e].ptr);delete this.#slots[e],this.#computeRanks()}}updateComponentSettingSlot(e,t,n){let r=this.#slots[e];if(!r)return;let i=r[t];i&&(i.type===`signal`||i.role===`output`||this.#memory.setValue(i.ptr,n))}addConnectionSlots(e,t=!0){let n=this.#slots[e.fromComponentId]?.[e.fromGateId];if(!n)return;let r=this.#slots[e.toComponentId];r&&(r[e.toGateId]=n,t&&this.#enqueue({targetId:e.fromComponentId,event:`run`}),this.#computeRanks())}removeConnectionSlots(e){let t=this.#slots[e.toComponentId];if(!t)return;let n=t[e.toGateId],r=n?.type===`signal`?`boolean`:n?.type??`any`;t[e.toGateId]={ptr:this.#memory.allocValue(r),type:n?.type??`any`,role:n?.role??`input`},this.#enqueue({targetId:e.fromComponentId,event:`run`}),this.#computeRanks()}setInputs(e){for(let[t,n]of Object.entries(e)){let e=this.#slots[t];if(e)for(let[t,r]of Object.entries(n)){let n=e[t];n&&this.#memory.setValue(n.ptr,r)}}}getOutputs(){let e={};for(let[t,n]of Object.entries(this.#slots)){let r=this.#graph.getComponent(t);if(!r)continue;let i={};for(let e of r.settings)if(e.role===`output`){let t=n[e.id];i[e.id]=this.#memory.getValue(t?.ptr)}e[t]=i}return e}async#runOne({targetId:e,event:t}){let n=this.#graph.getComponent(e);if(n){if(!this.#isReady(n))return this.#enqueueDefer({targetId:e,event:t});if(!this.#busy.has(n.id)){this.#busy.add(n.id);try{let e=yt.get(n.typeId);if(!e?.activate)return;let r=this.#io.get(n.id);if(r.changed.clear(),t===`run`){let e=this.#slots[n.id]?.run;e&&this.#memory.setValue(e.ptr,performance.now())}if(await e.activate(r,t,this.#engine.manager),r.changed.size){let e=this.#slots[n.id];for(let t of r.changed){this.#emit(n.id,t);let r=e[t];r?.type===`signal`&&r?.role===`output`&&this.#memory.setValue(r.ptr,performance.now())}r.changed.clear()}}catch(e){this.#engine.manager.onError(this.#graph.id,n,e)}finally{this.#busy.delete(n.id)}}}}#createIO(e){if(this.#io.has(e.id))return;let t=this,n=this.#slots[e.id],r=this.#memory,i=this.#engine,a=i.manager,o={changed:new Set,get(e){let t=n?.[e];return r.getValue(t?.ptr)},set(e,t){let i=n?.[e];r.getValue(i?.ptr)!==t&&(r.setValue(i?.ptr,t),o.changed.add(e))},emit(e,t=!0){o.set(e,t)},setting(t){return e.values[t]},getAll(){let e={};for(let t in n)e[t]=r.getValue(n[t].ptr);return e},setAll(e){for(let t in e)o.set(t,e[t])},async activate(n,r=`run`,o={}){let s=i.getGraph(n);s||(s=await Tt.load(n,a),i.registerGraph(s));let c=i.getRunner?.(e.id);return c||=i.addRunner(n,t.id,e.id),await c.start(),c.setInputs(o),c.triggerInitial(r),await c.waitIdle(),c.getOutputs()}};this.#io.set(e.id,o)}#emit(e,t){if(this.#slots[e]?.[t]?.type===`signal`){let n=this.#graph.getOutEdgesByGate(e,t);for(let e of n)this.#enqueue({targetId:e.toComponentId,event:e.toGateId})}else{let t=this.#graph.getOutComponents(e);for(let e of t)this.#enqueue({targetId:e,event:`run`})}}#enqueue(e){let t=this.#ranks.get(e.targetId)??0;for(let t=0;t<this.#queue.length;t++){let n=this.#queue[t];if(n.targetId===e.targetId&&n.event===e.event)return}this.#queue.push({...e,rank:t,ts:performance.now()}),this.#queue.sort((e,t)=>e.rank-t.rank||e.ts-t.ts),!this.#ticking&&!this.#scheduled&&(this.#scheduled=!0,queueMicrotask(()=>{this.#scheduled=!1,this.tick()}))}#enqueueDefer(e){setTimeout(()=>this.#enqueue(e),0)}#isReady(e){let t=this.#graph.getInEdges(e.id);for(let e of t)if(this.#busy.has(e.fromComponentId))return!1;return!0}#prepareSlots(){this.#slots={};for(let e of this.#graph.components)this.addComponentSlots(e);for(let e of this.#graph.components){let t=this.#graph.getOutEdges(e.id);for(let e of t)this.addConnectionSlots(e,!1)}}#computeRanks(){let e=new Map,t=this.#graph.components.filter(e=>!this.#graph.getInEdges(e.id).size),n=[...t];for(let n of t)e.set(n.id,0);for(;n.length;){let t=n.shift(),r=e.get(t.id)??0;for(let i of this.#graph.getOutEdges(t.id)){let t=r+1,a=e.get(i.toComponentId);(a==null||t>a)&&(e.set(i.toComponentId,t),n.push(this.#graph.getComponent(i.toComponentId)))}}this.#ranks=e}get#memory(){return this.#engine.manager.memory}#isInitial(e,t){return e.typeId===Ze.INPUT?!0:t.getInEdges(e.id).size===0}#getComponentIOData(){let e={};for(let t of this.#graph.components){let n=this.#slots[t.id],r=t.settings,i={};for(let e of r){let t=n[e.id],r=this.#memory.getValue(t.ptr),a=this.#formatValue(r,t.type);i[e.id]=a}e[t.id]=i}return e}#formatValue(e,t){let n=this.#engine.manager.types.get(t);try{return t===`signal`?e:n?.toJSON?n.toJSON(e):structuredClone(e)}catch{return typeof e==`object`?JSON.parse(JSON.stringify(e)):e}}#setComponentGate(e,t,n){let r=this.#slots[e];if(!r)return!1;let i=r[t];return i?(this.#memory.setValue(i.ptr,n),!0):!1}};Et();var Ot=class{#manager;#graphs;#runners;#graphsToRunners;constructor(e){this.#manager=e,this.#graphs=new Map,this.#runners=new Map,this.#graphsToRunners=new Map}get manager(){return this.#manager}get states(){return Array.from(this.#runners.values()).filter(e=>!e.parentId).map(e=>e.state)}getRunnerByGraph(e){let t=this.#graphsToRunners.get(e);if(!t||!t.size)return null;for(let e of t){let t=this.#runners.get(e);if(t&&!t.parentId)return t}return null}registerGraph(e){let t=new Tt(e);return this.#graphs.set(t.id,t),this.#graphsToRunners.has(t.id)||this.#graphsToRunners.set(t.id,new Set),t}removeGraph(e){let t=this.#graphsToRunners.get(e);if(t){for(let e of t){let t=this.#runners.get(e);t&&(t.stop?.(),t.dispose?.(),this.#runners.delete(e))}this.#graphsToRunners.delete(e)}this.#graphs.delete(e)}addRunner(e,t,n=null){let r=this.getGraph(e),i=new Dt(n,this,t,r);return this.#runners.set(i.id,i),this.#graphsToRunners.has(e)||this.#graphsToRunners.set(e,new Set),this.#graphsToRunners.get(e).add(i.id),i}async removeRunner(e){let t=this.getRunner(e);await t.stop(),await t.dispose(),this.#runners.delete(e);let n=this.#graphsToRunners.get(t.graph.id);n&&n.delete(e)}async startRunner(e){let t=this.getRunnerByGraph(e);if(!t){if(!this.getGraph(e))throw Error(`Graph not registered: `+e);t=this.addRunner(e,null)}return await t.start(),t}async stopRunner(e){let t=this.getRunnerByGraph(e);if(!t)throw Error(`Runner does not exist for graph `+e);return await t.stop(),t}async stepRunner(e,t,n){let r=await this.startRunner(e);return r.triggerInitial(t,n),await r.waitIdle(),r}trigger(e,t,n){this.getRunnerByGraph(e).trigger(t,n)}addComponent(e,t){this.getGraph(e).addComponent(t);for(let n of this.#runners.values())n.graph?.id===e&&n.addComponentSlots(t)}removeComponent(e,t){this.getGraph(e).removeComponent(t);for(let n of this.#runners.values())n.graph?.id===e&&n.removeComponentSlots(t)}addConnection(e,t){this.getGraph(e).addConnection(t);for(let n of this.#runners.values())n.graph?.id===e&&n.addConnectionSlots(t)}removeConnection(e,t){this.getGraph(e).removeConnection(t);for(let n of this.#runners.values())n.graph?.id===e&&n.removeConnectionSlots(t)}updateComponentSetting(e,t,n,r){this.getGraph(e).updateComponent(t,n,r),this.getRunnerByGraph(e).updateComponentSettingSlot(t,n,r)}getRunner(e){return this.#runners.get(e)}getGraph(e){return this.#graphs.get(e)}},kt=class{constructor(e){this.types=e,this.values=[],this.typesTable=[],this.heap=[],this.heapTypes=[],this.freeValues=[],this.freeHeap=[]}allocValue(e,t){let n=this.freeValues.pop()??this.values.length;if(this.#isHeapType(e)&&t!==void 0){let r=this.#allocHeap(t,e);this.values[n]=r}else this.values[n]=t;return this.typesTable[n]=e,n}getValue(e){let t=this.typesTable[e],n=this.values[e];return this.#isHeapType(t)?this.heap[n]:n}setValue(e,t){let n=this.typesTable[e];if(!n){this.values[e]=t;return}if(this.#isHeapType(n)){let r=this.values[e];r===void 0?this.values[e]=this.#allocHeap(t,n):this.heap[r]=t;return}if(this.types.get(n).check(t)){this.values[e]=t;return}let r=`any`;if(t==null)r=`any`;else if(typeof t==`string`&&this.types.get(t))r=`type`;else{let e=typeof t;this.types.get(e)&&(r=e)}if(this.types.canCast(r,n)){let i=this.types.castValue(t,r,n);this.values[e]=i;return}throw Error(`Type mismatch: cannot store ${typeof t} in slot of type ${n}`)}getType(e){return this.typesTable[e]}freeValue(e){let t=this.typesTable[e];if(this.#isHeapType(t)){let t=this.values[e];this.#freeHeap(t)}this.values[e]=void 0,this.typesTable[e]=void 0,this.freeValues.push(e)}#allocHeap(e,t=`any`){let n=this.freeHeap.pop()??this.heap.length;return this.heap[n]=e,this.heapTypes[n]=t,n}#freeHeap(e){this.heap[e]=void 0,this.heapTypes[e]=void 0,this.freeHeap.push(e)}#isHeapType(e){let t=this.types.get(e);if(!t)return!1;let n=new Set,r=t;for(;r&&!n.has(r.id);){if(n.add(r.id),r.id===`object`||r.id===`array`)return!0;if(!r.base)break;r=this.types.get(r.base)}return!1}},At=class e{constructor(){this.types=new Map,this.#registerBuiltins()}register(e,t={}){if(this.types.has(e))throw Error(`Type already registered: ${e}`);let n={id:e,base:t.base??`any`,meta:t.meta??{},check:t.check??(()=>!0),cast:t.cast??null,compatibleWith:t.compatibleWith??[],format:t.format??(e=>String(e)),toJSON:t.toJSON??(e=>e)};return this.types.set(e,n),n}get(e){return this.types.get(e)||this.types.get(`any`)}isCompatible(e,t){if(!e||!t||e===t)return!0;let n=this.get(e),r=this.get(t);if(n.base===t||r.base===e||n.compatibleWith.includes(t)||r.compatibleWith.includes(e))return!0;let i=n;for(;i&&i.base;){if(i.base===t)return!0;i=this.get(i.base)}return!1}canCast(e,t){let n=this.get(e),r=this.get(t);return!!(n.cast||r.cast||this.isCompatible(e,t))}castValue(e,t,n){if(t===n)return e;let r=this.get(t),i=this.get(n);if(r.cast){let t=r.cast(e,i);if(t!==void 0)return t}if(i.cast){let t=i.cast(e,r);if(t!==void 0)return t}if(this.isCompatible(t,n))return e;throw Error(`Cannot cast from ${t} to ${n}`)}#registerBuiltins(){this.types.set(`any`,{id:`any`,base:null,meta:{},check:()=>!0,format:e=>String(e)}),this.register(`number`,{base:`any`,check:e=>typeof e==`number`,cast:e=>Number(e),format:e=>String(e)}),this.register(`string`,{base:`any`,check:e=>typeof e==`string`,cast:e=>String(e),format:e=>`"${e}"`}),this.register(`boolean`,{base:`any`,check:e=>typeof e==`boolean`,cast:e=>!!e,format:e=>e?`true`:`false`}),this.register(`array`,{base:`any`,check:Array.isArray,format:e=>`[${e.length} items]`}),this.register(`object`,{base:`any`,check:e=>e&&typeof e==`object`&&!Array.isArray(e),format:e=>`{${Object.keys(e).length} keys}`}),this.register(`type`,{base:`any`,check:e=>typeof e==`string`&&this.types.has(e),format:e=>`<${e}>`,meta:{description:`Reference to a registered type id`}})}list(){return Array.from(this.types.keys())}dump(){return Array.from(this.types.values()).map(e=>({id:e.id,base:e.base,meta:e.meta,compatibleWith:e.compatibleWith}))}clone(){let t=new e;t.types=new Map;for(let[e,n]of this.types.entries())t.types.set(e,structuredClone?structuredClone(n):JSON.parse(JSON.stringify(n)));return t}toJSON(){return this.dump()}};let jt=Object.create(null);jt.open=`0`,jt.close=`1`,jt.ping=`2`,jt.pong=`3`,jt.message=`4`,jt.upgrade=`5`,jt.noop=`6`;let Mt=Object.create(null);Object.keys(jt).forEach(e=>{Mt[jt[e]]=e});let Q={type:`error`,data:`parser error`},Nt=typeof Blob==`function`||typeof Blob<`u`&&Object.prototype.toString.call(Blob)===`[object BlobConstructor]`,Pt=typeof ArrayBuffer==`function`,Ft=e=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,It=({type:e,data:t},n,r)=>Nt&&t instanceof Blob?n?r(t):Lt(t,r):Pt&&(t instanceof ArrayBuffer||Ft(t))?n?r(t):Lt(new Blob([t]),r):r(jt[e]+(t||``)),Lt=(e,t)=>{let n=new FileReader;return n.onload=function(){let e=n.result.split(`,`)[1];t(`b`+(e||``))},n.readAsDataURL(e)};function Rt(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let zt;function Bt(e,t){if(Nt&&e.data instanceof Blob)return e.data.arrayBuffer().then(Rt).then(t);if(Pt&&(e.data instanceof ArrayBuffer||Ft(e.data)))return t(Rt(e.data));It(e,!1,e=>{zt||=new TextEncoder,t(zt.encode(e))})}let Vt=typeof Uint8Array>`u`?[]:new Uint8Array(256);for(let e=0;e<64;e++)Vt[`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`.charCodeAt(e)]=e;let Ht=e=>{let t=e.length*.75,n=e.length,r,i=0,a,o,s,c;e[e.length-1]===`=`&&(t--,e[e.length-2]===`=`&&t--);let l=new ArrayBuffer(t),u=new Uint8Array(l);for(r=0;r<n;r+=4)a=Vt[e.charCodeAt(r)],o=Vt[e.charCodeAt(r+1)],s=Vt[e.charCodeAt(r+2)],c=Vt[e.charCodeAt(r+3)],u[i++]=a<<2|o>>4,u[i++]=(o&15)<<4|s>>2,u[i++]=(s&3)<<6|c&63;return l},Ut=typeof ArrayBuffer==`function`,Wt=(e,t)=>{if(typeof e!=`string`)return{type:`message`,data:Kt(e,t)};let n=e.charAt(0);return n===`b`?{type:`message`,data:Gt(e.substring(1),t)}:Mt[n]?e.length>1?{type:Mt[n],data:e.substring(1)}:{type:Mt[n]}:Q},Gt=(e,t)=>{if(Ut){let n=Ht(e);return Kt(n,t)}else return{base64:!0,data:e}},Kt=(e,t)=>{switch(t){case`blob`:return e instanceof Blob?e:new Blob([e]);case`arraybuffer`:default:return e instanceof ArrayBuffer?e:e.buffer}},qt=(e,t)=>{let n=e.length,r=Array(n),i=0;e.forEach((e,a)=>{It(e,!1,e=>{r[a]=e,++i===n&&t(r.join(``))})})},Jt=(e,t)=>{let n=e.split(``),r=[];for(let e=0;e<n.length;e++){let i=Wt(n[e],t);if(r.push(i),i.type===`error`)break}return r};function Yt(){return new TransformStream({transform(e,t){Bt(e,n=>{let r=n.length,i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);let e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{i=new Uint8Array(9);let e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&typeof e.data!=`string`&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let Xt;function Zt(e){return e.reduce((e,t)=>e+t.length,0)}function Qt(e,t){if(e[0].length===t)return e.shift();let n=new Uint8Array(t),r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function $t(e,t){Xt||=new TextDecoder;let n=[],r=0,i=-1,a=!1;return new TransformStream({transform(o,s){for(n.push(o);;){if(r===0){if(Zt(n)<1)break;let e=Qt(n,1);a=(e[0]&128)==128,i=e[0]&127,r=i<126?3:i===126?1:2}else if(r===1){if(Zt(n)<2)break;let e=Qt(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(r===2){if(Zt(n)<8)break;let e=Qt(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),a=t.getUint32(0);if(a>2**21-1){s.enqueue(Q);break}i=a*2**32+t.getUint32(4),r=3}else{if(Zt(n)<i)break;let e=Qt(n,i);s.enqueue(Wt(a?e:Xt.decode(e),t)),r=0}if(i===0||i>e){s.enqueue(Q);break}}}})}function en(e){if(e)return tn(e)}function tn(e){for(var t in en.prototype)e[t]=en.prototype[t];return e}en.prototype.on=en.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[`$`+e]=this._callbacks[`$`+e]||[]).push(t),this},en.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},en.prototype.off=en.prototype.removeListener=en.prototype.removeAllListeners=en.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks[`$`+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks[`$`+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks[`$`+e],this},en.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=Array(arguments.length-1),n=this._callbacks[`$`+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},en.prototype.emitReserved=en.prototype.emit,en.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[`$`+e]||[]},en.prototype.hasListeners=function(e){return!!this.listeners(e).length};let nn=(()=>typeof Promise==`function`&&typeof Promise.resolve==`function`?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),rn=(()=>typeof self<`u`?self:typeof window<`u`?window:Function(`return this`)())();function an(e,...t){return t.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}let on=rn.setTimeout,sn=rn.clearTimeout;function cn(e,t){t.useNativeTimers?(e.setTimeoutFn=on.bind(rn),e.clearTimeoutFn=sn.bind(rn)):(e.setTimeoutFn=rn.setTimeout.bind(rn),e.clearTimeoutFn=rn.clearTimeout.bind(rn))}function ln(e){return typeof e==`string`?un(e):Math.ceil((e.byteLength||e.size)*1.33)}function un(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function dn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function fn(e){let t=``;for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+=`&`),t+=encodeURIComponent(n)+`=`+encodeURIComponent(e[n]));return t}function pn(e){let t={},n=e.split(`&`);for(let e=0,r=n.length;e<r;e++){let r=n[e].split(`=`);t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}var mn=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type=`TransportError`}},hn=class extends en{constructor(e){super(),this.writable=!1,cn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved(`error`,new mn(e,t,n)),this}open(){return this.readyState=`opening`,this.doOpen(),this}close(){return(this.readyState===`opening`||this.readyState===`open`)&&(this.doClose(),this.onClose()),this}send(e){this.readyState===`open`&&this.write(e)}onOpen(){this.readyState=`open`,this.writable=!0,super.emitReserved(`open`)}onData(e){let t=Wt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved(`packet`,e)}onClose(e){this.readyState=`closed`,super.emitReserved(`close`,e)}pause(e){}createUri(e,t={}){return e+`://`+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(`:`)===-1?e:`[`+e+`]`}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?`:`+this.opts.port:``}_query(e){let t=fn(e);return t.length?`?`+t:``}},gn=class extends hn{constructor(){super(...arguments),this._polling=!1}get name(){return`polling`}doOpen(){this._poll()}pause(e){this.readyState=`pausing`;let t=()=>{this.readyState=`paused`,e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once(`pollComplete`,function(){--e||t()})),this.writable||(e++,this.once(`drain`,function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved(`poll`)}onData(e){Jt(e,this.socket.binaryType).forEach(e=>{if(this.readyState===`opening`&&e.type===`open`&&this.onOpen(),e.type===`close`)return this.onClose({description:`transport closed by the server`}),!1;this.onPacket(e)}),this.readyState!==`closed`&&(this._polling=!1,this.emitReserved(`pollComplete`),this.readyState===`open`&&this._poll())}doClose(){let e=()=>{this.write([{type:`close`}])};this.readyState===`open`?e():this.once(`open`,e)}write(e){this.writable=!1,qt(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved(`drain`)})})}uri(){let e=this.opts.secure?`https`:`http`,t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=dn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};let _n=!1;try{_n=typeof XMLHttpRequest<`u`&&`withCredentials`in new XMLHttpRequest}catch{}let vn=_n;function yn(){}var bn=class extends gn{constructor(e){if(super(e),typeof location<`u`){let t=location.protocol===`https:`,n=location.port;n||=t?`443`:`80`,this.xd=typeof location<`u`&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){let n=this.request({method:`POST`,data:e});n.on(`success`,t),n.on(`error`,(e,t)=>{this.onError(`xhr post error`,e,t)})}doPoll(){let e=this.request();e.on(`data`,this.onData.bind(this)),e.on(`error`,(e,t)=>{this.onError(`xhr poll error`,e,t)}),this.pollXhr=e}},xn=class e extends en{constructor(e,t,n){super(),this.createRequest=e,cn(this,n),this._opts=n,this._method=n.method||`GET`,this._uri=t,this._data=n.data===void 0?null:n.data,this._create()}_create(){var t;let n=an(this._opts,`agent`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`autoUnref`);n.xdomain=!!this._opts.xd;let r=this._xhr=this.createRequest(n);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(let e in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}catch{}if(this._method===`POST`)try{r.setRequestHeader(`Content-type`,`text/plain;charset=UTF-8`)}catch{}try{r.setRequestHeader(`Accept`,`*/*`)}catch{}(t=this._opts.cookieJar)==null||t.addCookies(r),`withCredentials`in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;r.readyState===3&&((e=this._opts.cookieJar)==null||e.parseCookies(r.getResponseHeader(`set-cookie`))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status==`number`?r.status:0)},0))},r.send(this._data)}catch(e){this.setTimeoutFn(()=>{this._onError(e)},0);return}typeof document<`u`&&(this._index=e.requestsCount++,e.requests[this._index]=this)}_onError(e){this.emitReserved(`error`,e,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(this._xhr===void 0||this._xhr===null)){if(this._xhr.onreadystatechange=yn,t)try{this._xhr.abort()}catch{}typeof document<`u`&&delete e.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved(`data`,e),this.emitReserved(`success`),this._cleanup())}abort(){this._cleanup()}};if(xn.requestsCount=0,xn.requests={},typeof document<`u`){if(typeof attachEvent==`function`)attachEvent(`onunload`,Sn);else if(typeof addEventListener==`function`){let e=`onpagehide`in rn?`pagehide`:`unload`;addEventListener(e,Sn,!1)}}function Sn(){for(let e in xn.requests)xn.requests.hasOwnProperty(e)&&xn.requests[e].abort()}let Cn=(function(){let e=Tn({xdomain:!1});return e&&e.responseType!==null})();var wn=class extends bn{constructor(e){super(e);let t=e&&e.forceBase64;this.supportsBinary=Cn&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new xn(Tn,this.uri(),e)}};function Tn(e){let t=e.xdomain;try{if(typeof XMLHttpRequest<`u`&&(!t||vn))return new XMLHttpRequest}catch{}if(!t)try{return new rn[[`Active`,`Object`].join(`X`)](`Microsoft.XMLHTTP`)}catch{}}let En=typeof navigator<`u`&&typeof navigator.product==`string`&&navigator.product.toLowerCase()===`reactnative`;var Dn=class extends hn{get name(){return`websocket`}doOpen(){let e=this.uri(),t=this.opts.protocols,n=En?{}:an(this.opts,`agent`,`perMessageDeflate`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`localAddress`,`protocolVersion`,`origin`,`maxPayload`,`family`,`checkServerIdentity`);this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(e){return this.emitReserved(`error`,e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:`websocket connection closed`,context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError(`websocket error`,e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],r=t===e.length-1;It(n,this.supportsBinary,e=>{try{this.doWrite(n,e)}catch{}r&&nn(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){this.ws!==void 0&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?`wss`:`ws`,t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=dn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}};let On=rn.WebSocket||rn.MozWebSocket,kn={websocket:class extends Dn{createSocket(e,t,n){return En?new On(e,t,n):t?new On(e,t):new On(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends hn{get name(){return`webtransport`}doOpen(){try{this._transport=new WebTransport(this.createUri(`https`),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved(`error`,e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError(`webtransport error`,e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=$t(2**53-1,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Yt();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();let i=()=>{n.read().then(({done:e,value:t})=>{e||(this.onPacket(t),i())}).catch(e=>{})};i();let a={type:`open`};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],r=t===e.length-1;this._writer.write(n).then(()=>{r&&nn(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)==null||e.close()}},polling:wn},An=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jn=[`source`,`protocol`,`authority`,`userInfo`,`user`,`password`,`host`,`port`,`relative`,`path`,`directory`,`file`,`query`,`anchor`];function Mn(e){if(e.length>8e3)throw`URI too long`;let t=e,n=e.indexOf(`[`),r=e.indexOf(`]`);n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,`;`)+e.substring(r,e.length));let i=An.exec(e||``),a={},o=14;for(;o--;)a[jn[o]]=i[o]||``;return n!=-1&&r!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,`:`),a.authority=a.authority.replace(`[`,``).replace(`]`,``).replace(/;/g,`:`),a.ipv6uri=!0),a.pathNames=Nn(a,a.path),a.queryKey=Pn(a,a.query),a}function Nn(e,t){let n=t.replace(/\/{2,9}/g,`/`).split(`/`);return(t.slice(0,1)==`/`||t.length===0)&&n.splice(0,1),t.slice(-1)==`/`&&n.splice(n.length-1,1),n}function Pn(e,t){let n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,r){t&&(n[t]=r)}),n}let Fn=typeof addEventListener==`function`&&typeof removeEventListener==`function`,In=[];Fn&&addEventListener(`offline`,()=>{In.forEach(e=>e())},!1);var Ln=class e extends en{constructor(e,t){if(super(),this.binaryType=`arraybuffer`,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e==`object`&&(t=e,e=null),e){let n=Mn(e);t.hostname=n.host,t.secure=n.protocol===`https`||n.protocol===`wss`,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=Mn(t.host).host);cn(this,t),this.secure=t.secure==null?typeof location<`u`&&location.protocol===`https:`:t.secure,t.hostname&&!t.port&&(t.port=this.secure?`443`:`80`),this.hostname=t.hostname||(typeof location<`u`?location.hostname:`localhost`),this.port=t.port||(typeof location<`u`&&location.port?location.port:this.secure?`443`:`80`),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{let t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:`/engine.io`,agent:!1,withCredentials:!1,upgrade:!0,timestampParam:`t`,rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,``)+(this.opts.addTrailingSlash?`/`:``),typeof this.opts.query==`string`&&(this.opts.query=pn(this.opts.query)),Fn&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener(`beforeunload`,this._beforeunloadEventListener,!1)),this.hostname!==`localhost`&&(this._offlineEventListener=()=>{this._onClose(`transport close`,{description:`network connection lost`})},In.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved(`error`,`No transports available`)},0);return}let t=this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&this.transports.indexOf(`websocket`)!==-1?`websocket`:this.transports[0];this.readyState=`opening`;let n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on(`drain`,this._onDrain.bind(this)).on(`packet`,this._onPacket.bind(this)).on(`error`,this._onError.bind(this)).on(`close`,e=>this._onClose(`transport close`,e))}onOpen(){this.readyState=`open`,e.priorWebsocketSuccess=this.transport.name===`websocket`,this.emitReserved(`open`),this.flush()}_onPacket(e){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`)switch(this.emitReserved(`packet`,e),this.emitReserved(`heartbeat`),e.type){case`open`:this.onHandshake(JSON.parse(e.data));break;case`ping`:this._sendPacket(`pong`),this.emitReserved(`ping`),this.emitReserved(`pong`),this._resetPingTimeout();break;case`error`:let t=Error(`server error`);t.code=e.data,this._onError(t);break;case`message`:this.emitReserved(`data`,e.data),this.emitReserved(`message`,e.data);break}}onHandshake(e){this.emitReserved(`handshake`,e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!==`closed`&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose(`ping timeout`)},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved(`drain`):this.flush()}flush(){if(this.readyState!==`closed`&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved(`flush`)}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name===`polling`&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){let n=this.writeBuffer[t].data;if(n&&(e+=ln(n)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,nn(()=>{this._onClose(`ping timeout`)},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket(`message`,e,t,n),this}send(e,t,n){return this._sendPacket(`message`,e,t,n),this}_sendPacket(e,t,n,r){if(typeof t==`function`&&(r=t,t=void 0),typeof n==`function`&&(r=n,n=null),this.readyState===`closing`||this.readyState===`closed`)return;n||={},n.compress=!1!==n.compress;let i={type:e,data:t,options:n};this.emitReserved(`packetCreate`,i),this.writeBuffer.push(i),r&&this.once(`flush`,r),this.flush()}close(){let e=()=>{this._onClose(`forced close`),this.transport.close()},t=()=>{this.off(`upgrade`,t),this.off(`upgradeError`,t),e()},n=()=>{this.once(`upgrade`,t),this.once(`upgradeError`,t)};return(this.readyState===`opening`||this.readyState===`open`)&&(this.readyState=`closing`,this.writeBuffer.length?this.once(`drain`,()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(t){if(e.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState===`opening`)return this.transports.shift(),this._open();this.emitReserved(`error`,t),this._onClose(`transport error`,t)}_onClose(e,t){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners(`close`),this.transport.close(),this.transport.removeAllListeners(),Fn&&(this._beforeunloadEventListener&&removeEventListener(`beforeunload`,this._beforeunloadEventListener,!1),this._offlineEventListener)){let e=In.indexOf(this._offlineEventListener);e!==-1&&In.splice(e,1)}this.readyState=`closed`,this.id=null,this.emitReserved(`close`,e,t),this.writeBuffer=[],this._prevBufferLen=0}}};Ln.protocol=4;var Rn=class extends Ln{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState===`open`&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Ln.priorWebsocketSuccess=!1;let r=()=>{n||(t.send([{type:`ping`,data:`probe`}]),t.once(`packet`,e=>{if(!n)if(e.type===`pong`&&e.data===`probe`){if(this.upgrading=!0,this.emitReserved(`upgrading`,t),!t)return;Ln.priorWebsocketSuccess=t.name===`websocket`,this.transport.pause(()=>{n||this.readyState!==`closed`&&(l(),this.setTransport(t),t.send([{type:`upgrade`}]),this.emitReserved(`upgrade`,t),t=null,this.upgrading=!1,this.flush())})}else{let e=Error(`probe error`);e.transport=t.name,this.emitReserved(`upgradeError`,e)}}))};function i(){n||(n=!0,l(),t.close(),t=null)}let a=e=>{let n=Error(`probe error: `+e);n.transport=t.name,i(),this.emitReserved(`upgradeError`,n)};function o(){a(`transport closed`)}function s(){a(`socket closed`)}function c(e){t&&e.name!==t.name&&i()}let l=()=>{t.removeListener(`open`,r),t.removeListener(`error`,a),t.removeListener(`close`,o),this.off(`close`,s),this.off(`upgrading`,c)};t.once(`open`,r),t.once(`error`,a),t.once(`close`,o),this.once(`close`,s),this.once(`upgrading`,c),this._upgrades.indexOf(`webtransport`)!==-1&&e!==`webtransport`?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}},zn=class extends Rn{constructor(e,t={}){let n=typeof e==`object`?e:t;(!n.transports||n.transports&&typeof n.transports[0]==`string`)&&(n.transports=(n.transports||[`polling`,`websocket`,`webtransport`]).map(e=>kn[e]).filter(e=>!!e)),super(e,n)}};zn.protocol;function Bn(e,t=``,n){let r=e;n||=typeof location<`u`&&location,e??=n.protocol+`//`+n.host,typeof e==`string`&&(e.charAt(0)===`/`&&(e=e.charAt(1)===`/`?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=n===void 0?`https://`+e:n.protocol+`//`+e),r=Mn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port=`80`:/^(http|ws)s$/.test(r.protocol)&&(r.port=`443`)),r.path=r.path||`/`;let i=r.host.indexOf(`:`)===-1?r.host:`[`+r.host+`]`;return r.id=r.protocol+`://`+i+`:`+r.port+t,r.href=r.protocol+`://`+i+(n&&n.port===r.port?``:`:`+r.port),r}let Vn=typeof ArrayBuffer==`function`,Hn=e=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Un=Object.prototype.toString,Wn=typeof Blob==`function`||typeof Blob<`u`&&Un.call(Blob)===`[object BlobConstructor]`,Gn=typeof File==`function`||typeof File<`u`&&Un.call(File)===`[object FileConstructor]`;function Kn(e){return Vn&&(e instanceof ArrayBuffer||Hn(e))||Wn&&e instanceof Blob||Gn&&e instanceof File}function qn(e,t){if(!e||typeof e!=`object`)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(qn(e[t]))return!0;return!1}if(Kn(e))return!0;if(e.toJSON&&typeof e.toJSON==`function`&&arguments.length===1)return qn(e.toJSON(),!0);for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&qn(e[t]))return!0;return!1}function Jn(e){let t=[],n=e.data,r=e;return r.data=Yn(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Yn(e,t){if(!e)return e;if(Kn(e)){let n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){let n=Array(e.length);for(let r=0;r<e.length;r++)n[r]=Yn(e[r],t);return n}else if(typeof e==`object`&&!(e instanceof Date)){let n={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Yn(e[r],t));return n}return e}function Xn(e,t){return e.data=Zn(e.data,t),delete e.attachments,e}function Zn(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num==`number`&&e.num>=0&&e.num<t.length)return t[e.num];throw Error(`illegal attachments`)}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Zn(e[n],t);else if(typeof e==`object`)for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Zn(e[n],t));return e}var Qn=c({Decoder:()=>rr,Encoder:()=>tr,PacketType:()=>$,protocol:()=>er});let $n=[`connect`,`connect_error`,`disconnect`,`disconnecting`,`newListener`,`removeListener`],er=5;var $;(function(e){e[e.CONNECT=0]=`CONNECT`,e[e.DISCONNECT=1]=`DISCONNECT`,e[e.EVENT=2]=`EVENT`,e[e.ACK=3]=`ACK`,e[e.CONNECT_ERROR=4]=`CONNECT_ERROR`,e[e.BINARY_EVENT=5]=`BINARY_EVENT`,e[e.BINARY_ACK=6]=`BINARY_ACK`})($||={});var tr=class{constructor(e){this.replacer=e}encode(e){return(e.type===$.EVENT||e.type===$.ACK)&&qn(e)?this.encodeAsBinary({type:e.type===$.EVENT?$.BINARY_EVENT:$.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=``+e.type;return(e.type===$.BINARY_EVENT||e.type===$.BINARY_ACK)&&(t+=e.attachments+`-`),e.nsp&&e.nsp!==`/`&&(t+=e.nsp+`,`),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=Jn(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}};function nr(e){return Object.prototype.toString.call(e)===`[object Object]`}var rr=class e extends en{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e==`string`){if(this.reconstructor)throw Error(`got plaintext data when reconstructing a packet`);t=this.decodeString(e);let n=t.type===$.BINARY_EVENT;n||t.type===$.BINARY_ACK?(t.type=n?$.EVENT:$.ACK,this.reconstructor=new ir(t),t.attachments===0&&super.emitReserved(`decoded`,t)):super.emitReserved(`decoded`,t)}else if(Kn(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved(`decoded`,t));else throw Error(`got binary data when not reconstructing a packet`);else throw Error(`Unknown type: `+e)}decodeString(t){let n=0,r={type:Number(t.charAt(0))};if($[r.type]===void 0)throw Error(`unknown packet type `+r.type);if(r.type===$.BINARY_EVENT||r.type===$.BINARY_ACK){let e=n+1;for(;t.charAt(++n)!==`-`&&n!=t.length;);let i=t.substring(e,n);if(i!=Number(i)||t.charAt(n)!==`-`)throw Error(`Illegal attachments`);r.attachments=Number(i)}if(t.charAt(n+1)===`/`){let e=n+1;for(;++n&&!(t.charAt(n)===`,`||n===t.length););r.nsp=t.substring(e,n)}else r.nsp=`/`;let i=t.charAt(n+1);if(i!==``&&Number(i)==i){let e=n+1;for(;++n;){let e=t.charAt(n);if(e==null||Number(e)!=e){--n;break}if(n===t.length)break}r.id=Number(t.substring(e,n+1))}if(t.charAt(++n)){let i=this.tryParse(t.substr(n));if(e.isPayloadValid(r.type,i))r.data=i;else throw Error(`invalid payload`)}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case $.CONNECT:return nr(t);case $.DISCONNECT:return t===void 0;case $.CONNECT_ERROR:return typeof t==`string`||nr(t);case $.EVENT:case $.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]==`number`||typeof t[0]==`string`&&$n.indexOf(t[0])===-1);case $.ACK:case $.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&=(this.reconstructor.finishedReconstruction(),null)}},ir=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let e=Xn(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function ar(e,t,n){return e.on(t,n),function(){e.off(t,n)}}let or=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});var sr=class extends en{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[ar(e,`open`,this.onopen.bind(this)),ar(e,`packet`,this.onpacket.bind(this)),ar(e,`error`,this.onerror.bind(this)),ar(e,`close`,this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState===`open`&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift(`message`),this.emit.apply(this,e),this}emit(e,...t){if(or.hasOwnProperty(e))throw Error(`"`+e.toString()+`" is a reserved event name`);if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:$.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]==`function`){let e=this.ids++,r=t.pop();this._registerAckCallback(e,r),n.id=e}let r=this.io.engine?.transport?.writable,i=this.connected&&!this.io.engine?._hasPingExpired();return this.flags.volatile&&!r||(i?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){let n=this.flags.timeout??this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}let r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,Error(`operation has timed out`))},n),i=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};i.withError=!0,this.acks[e]=i}emitWithAck(e,...t){return new Promise((n,r)=>{let i=(e,t)=>e?r(e):n(t);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]==`function`&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...r)=>{if(n===this._queue[0])return e===null?(this._queue.shift(),t&&t(null,...r)):n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)),n.pending=!1,this._drainQueue()}),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth==`function`?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:$.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved(`connect_error`,e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved(`disconnect`,e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){let t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,Error(`socket has been disconnected`))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case $.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved(`connect_error`,Error(`It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)`));break;case $.EVENT:case $.BINARY_EVENT:this.onevent(e);break;case $.ACK:case $.BINARY_ACK:this.onack(e);break;case $.DISCONNECT:this.ondisconnect();break;case $.CONNECT_ERROR:this.destroy();let t=Error(e.data.message);t.data=e.data.data,this.emitReserved(`connect_error`,t);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]==`string`&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...r){n||(n=!0,t.packet({type:$.ACK,id:e,data:r}))}}onack(e){let t=this.acks[e.id];typeof t==`function`&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved(`connect`),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose(`io server disconnect`)}destroy(){this.subs&&=(this.subs.forEach(e=>e()),void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$.DISCONNECT}),this.destroy(),this.connected&&this.onclose(`io client disconnect`),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function cr(e){e||={},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}cr.prototype.duration=function(){var e=this.ms*this.factor**+ this.attempts++;if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0},cr.prototype.reset=function(){this.attempts=0},cr.prototype.setMin=function(e){this.ms=e},cr.prototype.setMax=function(e){this.max=e},cr.prototype.setJitter=function(e){this.jitter=e};var lr=class extends en{constructor(e,t){super(),this.nsps={},this.subs=[],e&&typeof e==`object`&&(t=e,e=void 0),t||={},t.path=t.path||`/socket.io`,this.opts=t,cn(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor??.5),this.backoff=new cr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState=`closed`,this.uri=e;let n=t.parser||Qn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)==null||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)==null||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)==null||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf(`open`))return this;this.engine=new zn(this.uri,this.opts);let t=this.engine,n=this;this._readyState=`opening`,this.skipReconnect=!1;let r=ar(t,`open`,function(){n.onopen(),e&&e()}),i=t=>{this.cleanup(),this._readyState=`closed`,this.emitReserved(`error`,t),e?e(t):this.maybeReconnectOnOpen()},a=ar(t,`error`,i);if(!1!==this._timeout){let e=this._timeout,n=this.setTimeoutFn(()=>{r(),i(Error(`timeout`)),t.close()},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState=`open`,this.emitReserved(`open`);let e=this.engine;this.subs.push(ar(e,`ping`,this.onping.bind(this)),ar(e,`data`,this.ondata.bind(this)),ar(e,`error`,this.onerror.bind(this)),ar(e,`close`,this.onclose.bind(this)),ar(this.decoder,`decoded`,this.ondecoded.bind(this)))}onping(){this.emitReserved(`ping`)}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose(`parse error`,e)}}ondecoded(e){nn(()=>{this.emitReserved(`packet`,e)},this.setTimeoutFn)}onerror(e){this.emitReserved(`error`,e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new sr(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let e of t)if(this.nsps[e].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose(`forced close`)}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)==null||n.close(),this.backoff.reset(),this._readyState=`closed`,this.emitReserved(`close`,e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved(`reconnect_failed`),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved(`reconnect_attempt`,e.backoff.attempts),!e.skipReconnect&&e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved(`reconnect_error`,t)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved(`reconnect`,e)}};let ur={};function dr(e,t){typeof e==`object`&&(t=e,e=void 0),t||={};let n=Bn(e,t.path||`/socket.io`),r=n.source,i=n.id,a=n.path,o=ur[i]&&a in ur[i].nsps,s=t.forceNew||t[`force new connection`]||!1===t.multiplex||o,c;return s?c=new lr(r,t):(ur[i]||(ur[i]=new lr(r,t)),c=ur[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(dr,{Manager:lr,Socket:sr,io:dr,connect:dr});var fr=s(((e,t)=>{t.exports=Object.create(new Proxy({},{get(e,t){if(t!==`__esModule`&&t!==`__proto__`&&t!==`constructor`&&t!==`splice`)throw Error(`Module "" has been externalized for browser compatibility. Cannot access ".${t}" in client code.  See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}))})),pr=s(((e,t)=>{(function(e){var t=function(e){var t,n=new Float64Array(16);if(e)for(t=0;t<e.length;t++)n[t]=e[t];return n},n=function(){throw Error(`no PRNG`)},r=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var a=t(),o=t([1]),s=t([56129,1]),c=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),u=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),d=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),f=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(e,t,n,r){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=n&255,e[t+4]=r>>24&255,e[t+5]=r>>16&255,e[t+6]=r>>8&255,e[t+7]=r&255}function m(e,t,n,r,i){var a,o=0;for(a=0;a<i;a++)o|=e[t+a]^n[r+a];return(1&o-1>>>8)-1}function h(e,t,n,r){return m(e,t,n,r,16)}function g(e,t,n,r){return m(e,t,n,r,32)}function _(e,t,n,r){for(var i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,a=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,o=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,s=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,c=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24,l=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,u=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,f=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,p=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,m=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,h=n[16]&255|(n[17]&255)<<8|(n[18]&255)<<16|(n[19]&255)<<24,g=n[20]&255|(n[21]&255)<<8|(n[22]&255)<<16|(n[23]&255)<<24,_=n[24]&255|(n[25]&255)<<8|(n[26]&255)<<16|(n[27]&255)<<24,v=n[28]&255|(n[29]&255)<<8|(n[30]&255)<<16|(n[31]&255)<<24,y=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,b=i,x=a,S=o,C=s,w=c,T=l,E=u,D=d,O=f,k=p,A=m,j=h,M=g,N=_,P=v,F=y,I,L=0;L<20;L+=2)I=b+M|0,w^=I<<7|I>>>25,I=w+b|0,O^=I<<9|I>>>23,I=O+w|0,M^=I<<13|I>>>19,I=M+O|0,b^=I<<18|I>>>14,I=T+x|0,k^=I<<7|I>>>25,I=k+T|0,N^=I<<9|I>>>23,I=N+k|0,x^=I<<13|I>>>19,I=x+N|0,T^=I<<18|I>>>14,I=A+E|0,P^=I<<7|I>>>25,I=P+A|0,S^=I<<9|I>>>23,I=S+P|0,E^=I<<13|I>>>19,I=E+S|0,A^=I<<18|I>>>14,I=F+j|0,C^=I<<7|I>>>25,I=C+F|0,D^=I<<9|I>>>23,I=D+C|0,j^=I<<13|I>>>19,I=j+D|0,F^=I<<18|I>>>14,I=b+C|0,x^=I<<7|I>>>25,I=x+b|0,S^=I<<9|I>>>23,I=S+x|0,C^=I<<13|I>>>19,I=C+S|0,b^=I<<18|I>>>14,I=T+w|0,E^=I<<7|I>>>25,I=E+T|0,D^=I<<9|I>>>23,I=D+E|0,w^=I<<13|I>>>19,I=w+D|0,T^=I<<18|I>>>14,I=A+k|0,j^=I<<7|I>>>25,I=j+A|0,O^=I<<9|I>>>23,I=O+j|0,k^=I<<13|I>>>19,I=k+O|0,A^=I<<18|I>>>14,I=F+P|0,M^=I<<7|I>>>25,I=M+F|0,N^=I<<9|I>>>23,I=N+M|0,P^=I<<13|I>>>19,I=P+N|0,F^=I<<18|I>>>14;b=b+i|0,x=x+a|0,S=S+o|0,C=C+s|0,w=w+c|0,T=T+l|0,E=E+u|0,D=D+d|0,O=O+f|0,k=k+p|0,A=A+m|0,j=j+h|0,M=M+g|0,N=N+_|0,P=P+v|0,F=F+y|0,e[0]=b>>>0&255,e[1]=b>>>8&255,e[2]=b>>>16&255,e[3]=b>>>24&255,e[4]=x>>>0&255,e[5]=x>>>8&255,e[6]=x>>>16&255,e[7]=x>>>24&255,e[8]=S>>>0&255,e[9]=S>>>8&255,e[10]=S>>>16&255,e[11]=S>>>24&255,e[12]=C>>>0&255,e[13]=C>>>8&255,e[14]=C>>>16&255,e[15]=C>>>24&255,e[16]=w>>>0&255,e[17]=w>>>8&255,e[18]=w>>>16&255,e[19]=w>>>24&255,e[20]=T>>>0&255,e[21]=T>>>8&255,e[22]=T>>>16&255,e[23]=T>>>24&255,e[24]=E>>>0&255,e[25]=E>>>8&255,e[26]=E>>>16&255,e[27]=E>>>24&255,e[28]=D>>>0&255,e[29]=D>>>8&255,e[30]=D>>>16&255,e[31]=D>>>24&255,e[32]=O>>>0&255,e[33]=O>>>8&255,e[34]=O>>>16&255,e[35]=O>>>24&255,e[36]=k>>>0&255,e[37]=k>>>8&255,e[38]=k>>>16&255,e[39]=k>>>24&255,e[40]=A>>>0&255,e[41]=A>>>8&255,e[42]=A>>>16&255,e[43]=A>>>24&255,e[44]=j>>>0&255,e[45]=j>>>8&255,e[46]=j>>>16&255,e[47]=j>>>24&255,e[48]=M>>>0&255,e[49]=M>>>8&255,e[50]=M>>>16&255,e[51]=M>>>24&255,e[52]=N>>>0&255,e[53]=N>>>8&255,e[54]=N>>>16&255,e[55]=N>>>24&255,e[56]=P>>>0&255,e[57]=P>>>8&255,e[58]=P>>>16&255,e[59]=P>>>24&255,e[60]=F>>>0&255,e[61]=F>>>8&255,e[62]=F>>>16&255,e[63]=F>>>24&255}function v(e,t,n,r){for(var i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,a=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,o=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,s=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,c=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24,l=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,u=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,f=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,p=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,m=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,h=n[16]&255|(n[17]&255)<<8|(n[18]&255)<<16|(n[19]&255)<<24,g=n[20]&255|(n[21]&255)<<8|(n[22]&255)<<16|(n[23]&255)<<24,_=n[24]&255|(n[25]&255)<<8|(n[26]&255)<<16|(n[27]&255)<<24,v=n[28]&255|(n[29]&255)<<8|(n[30]&255)<<16|(n[31]&255)<<24,y=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,b=i,x=a,S=o,C=s,w=c,T=l,E=u,D=d,O=f,k=p,A=m,j=h,M=g,N=_,P=v,F=y,I,L=0;L<20;L+=2)I=b+M|0,w^=I<<7|I>>>25,I=w+b|0,O^=I<<9|I>>>23,I=O+w|0,M^=I<<13|I>>>19,I=M+O|0,b^=I<<18|I>>>14,I=T+x|0,k^=I<<7|I>>>25,I=k+T|0,N^=I<<9|I>>>23,I=N+k|0,x^=I<<13|I>>>19,I=x+N|0,T^=I<<18|I>>>14,I=A+E|0,P^=I<<7|I>>>25,I=P+A|0,S^=I<<9|I>>>23,I=S+P|0,E^=I<<13|I>>>19,I=E+S|0,A^=I<<18|I>>>14,I=F+j|0,C^=I<<7|I>>>25,I=C+F|0,D^=I<<9|I>>>23,I=D+C|0,j^=I<<13|I>>>19,I=j+D|0,F^=I<<18|I>>>14,I=b+C|0,x^=I<<7|I>>>25,I=x+b|0,S^=I<<9|I>>>23,I=S+x|0,C^=I<<13|I>>>19,I=C+S|0,b^=I<<18|I>>>14,I=T+w|0,E^=I<<7|I>>>25,I=E+T|0,D^=I<<9|I>>>23,I=D+E|0,w^=I<<13|I>>>19,I=w+D|0,T^=I<<18|I>>>14,I=A+k|0,j^=I<<7|I>>>25,I=j+A|0,O^=I<<9|I>>>23,I=O+j|0,k^=I<<13|I>>>19,I=k+O|0,A^=I<<18|I>>>14,I=F+P|0,M^=I<<7|I>>>25,I=M+F|0,N^=I<<9|I>>>23,I=N+M|0,P^=I<<13|I>>>19,I=P+N|0,F^=I<<18|I>>>14;e[0]=b>>>0&255,e[1]=b>>>8&255,e[2]=b>>>16&255,e[3]=b>>>24&255,e[4]=T>>>0&255,e[5]=T>>>8&255,e[6]=T>>>16&255,e[7]=T>>>24&255,e[8]=A>>>0&255,e[9]=A>>>8&255,e[10]=A>>>16&255,e[11]=A>>>24&255,e[12]=F>>>0&255,e[13]=F>>>8&255,e[14]=F>>>16&255,e[15]=F>>>24&255,e[16]=E>>>0&255,e[17]=E>>>8&255,e[18]=E>>>16&255,e[19]=E>>>24&255,e[20]=D>>>0&255,e[21]=D>>>8&255,e[22]=D>>>16&255,e[23]=D>>>24&255,e[24]=O>>>0&255,e[25]=O>>>8&255,e[26]=O>>>16&255,e[27]=O>>>24&255,e[28]=k>>>0&255,e[29]=k>>>8&255,e[30]=k>>>16&255,e[31]=k>>>24&255}function y(e,t,n,r){_(e,t,n,r)}function b(e,t,n,r){v(e,t,n,r)}var x=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function S(e,t,n,r,i,a,o){var s=new Uint8Array(16),c=new Uint8Array(64),l,u;for(u=0;u<16;u++)s[u]=0;for(u=0;u<8;u++)s[u]=a[u];for(;i>=64;){for(y(c,s,o,x),u=0;u<64;u++)e[t+u]=n[r+u]^c[u];for(l=1,u=8;u<16;u++)l=l+(s[u]&255)|0,s[u]=l&255,l>>>=8;i-=64,t+=64,r+=64}if(i>0)for(y(c,s,o,x),u=0;u<i;u++)e[t+u]=n[r+u]^c[u];return 0}function C(e,t,n,r,i){var a=new Uint8Array(16),o=new Uint8Array(64),s,c;for(c=0;c<16;c++)a[c]=0;for(c=0;c<8;c++)a[c]=r[c];for(;n>=64;){for(y(o,a,i,x),c=0;c<64;c++)e[t+c]=o[c];for(s=1,c=8;c<16;c++)s=s+(a[c]&255)|0,a[c]=s&255,s>>>=8;n-=64,t+=64}if(n>0)for(y(o,a,i,x),c=0;c<n;c++)e[t+c]=o[c];return 0}function w(e,t,n,r,i){var a=new Uint8Array(32);b(a,r,i,x);for(var o=new Uint8Array(8),s=0;s<8;s++)o[s]=r[s+16];return C(e,t,n,o,a)}function T(e,t,n,r,i,a,o){var s=new Uint8Array(32);b(s,a,o,x);for(var c=new Uint8Array(8),l=0;l<8;l++)c[l]=a[l+16];return S(e,t,n,r,i,c,s)}var E=function(e){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var t=e[0]&255|(e[1]&255)<<8,n,r,i,a,o,s,c;this.r[0]=t&8191,n=e[2]&255|(e[3]&255)<<8,this.r[1]=(t>>>13|n<<3)&8191,r=e[4]&255|(e[5]&255)<<8,this.r[2]=(n>>>10|r<<6)&7939,i=e[6]&255|(e[7]&255)<<8,this.r[3]=(r>>>7|i<<9)&8191,a=e[8]&255|(e[9]&255)<<8,this.r[4]=(i>>>4|a<<12)&255,this.r[5]=a>>>1&8190,o=e[10]&255|(e[11]&255)<<8,this.r[6]=(a>>>14|o<<2)&8191,s=e[12]&255|(e[13]&255)<<8,this.r[7]=(o>>>11|s<<5)&8065,c=e[14]&255|(e[15]&255)<<8,this.r[8]=(s>>>8|c<<8)&8191,this.r[9]=c>>>5&127,this.pad[0]=e[16]&255|(e[17]&255)<<8,this.pad[1]=e[18]&255|(e[19]&255)<<8,this.pad[2]=e[20]&255|(e[21]&255)<<8,this.pad[3]=e[22]&255|(e[23]&255)<<8,this.pad[4]=e[24]&255|(e[25]&255)<<8,this.pad[5]=e[26]&255|(e[27]&255)<<8,this.pad[6]=e[28]&255|(e[29]&255)<<8,this.pad[7]=e[30]&255|(e[31]&255)<<8};E.prototype.blocks=function(e,t,n){for(var r=this.fin?0:2048,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C=this.h[0],w=this.h[1],T=this.h[2],E=this.h[3],D=this.h[4],O=this.h[5],k=this.h[6],A=this.h[7],j=this.h[8],M=this.h[9],N=this.r[0],P=this.r[1],F=this.r[2],I=this.r[3],L=this.r[4],R=this.r[5],z=this.r[6],B=this.r[7],V=this.r[8],H=this.r[9];n>=16;)i=e[t+0]&255|(e[t+1]&255)<<8,C+=i&8191,a=e[t+2]&255|(e[t+3]&255)<<8,w+=(i>>>13|a<<3)&8191,o=e[t+4]&255|(e[t+5]&255)<<8,T+=(a>>>10|o<<6)&8191,s=e[t+6]&255|(e[t+7]&255)<<8,E+=(o>>>7|s<<9)&8191,c=e[t+8]&255|(e[t+9]&255)<<8,D+=(s>>>4|c<<12)&8191,O+=c>>>1&8191,l=e[t+10]&255|(e[t+11]&255)<<8,k+=(c>>>14|l<<2)&8191,u=e[t+12]&255|(e[t+13]&255)<<8,A+=(l>>>11|u<<5)&8191,d=e[t+14]&255|(e[t+15]&255)<<8,j+=(u>>>8|d<<8)&8191,M+=d>>>5|r,f=0,p=f,p+=C*N,p+=w*(5*H),p+=T*(5*V),p+=E*(5*B),p+=D*(5*z),f=p>>>13,p&=8191,p+=O*(5*R),p+=k*(5*L),p+=A*(5*I),p+=j*(5*F),p+=M*(5*P),f+=p>>>13,p&=8191,m=f,m+=C*P,m+=w*N,m+=T*(5*H),m+=E*(5*V),m+=D*(5*B),f=m>>>13,m&=8191,m+=O*(5*z),m+=k*(5*R),m+=A*(5*L),m+=j*(5*I),m+=M*(5*F),f+=m>>>13,m&=8191,h=f,h+=C*F,h+=w*P,h+=T*N,h+=E*(5*H),h+=D*(5*V),f=h>>>13,h&=8191,h+=O*(5*B),h+=k*(5*z),h+=A*(5*R),h+=j*(5*L),h+=M*(5*I),f+=h>>>13,h&=8191,g=f,g+=C*I,g+=w*F,g+=T*P,g+=E*N,g+=D*(5*H),f=g>>>13,g&=8191,g+=O*(5*V),g+=k*(5*B),g+=A*(5*z),g+=j*(5*R),g+=M*(5*L),f+=g>>>13,g&=8191,_=f,_+=C*L,_+=w*I,_+=T*F,_+=E*P,_+=D*N,f=_>>>13,_&=8191,_+=O*(5*H),_+=k*(5*V),_+=A*(5*B),_+=j*(5*z),_+=M*(5*R),f+=_>>>13,_&=8191,v=f,v+=C*R,v+=w*L,v+=T*I,v+=E*F,v+=D*P,f=v>>>13,v&=8191,v+=O*N,v+=k*(5*H),v+=A*(5*V),v+=j*(5*B),v+=M*(5*z),f+=v>>>13,v&=8191,y=f,y+=C*z,y+=w*R,y+=T*L,y+=E*I,y+=D*F,f=y>>>13,y&=8191,y+=O*P,y+=k*N,y+=A*(5*H),y+=j*(5*V),y+=M*(5*B),f+=y>>>13,y&=8191,b=f,b+=C*B,b+=w*z,b+=T*R,b+=E*L,b+=D*I,f=b>>>13,b&=8191,b+=O*F,b+=k*P,b+=A*N,b+=j*(5*H),b+=M*(5*V),f+=b>>>13,b&=8191,x=f,x+=C*V,x+=w*B,x+=T*z,x+=E*R,x+=D*L,f=x>>>13,x&=8191,x+=O*I,x+=k*F,x+=A*P,x+=j*N,x+=M*(5*H),f+=x>>>13,x&=8191,S=f,S+=C*H,S+=w*V,S+=T*B,S+=E*z,S+=D*R,f=S>>>13,S&=8191,S+=O*L,S+=k*I,S+=A*F,S+=j*P,S+=M*N,f+=S>>>13,S&=8191,f=(f<<2)+f|0,f=f+p|0,p=f&8191,f>>>=13,m+=f,C=p,w=m,T=h,E=g,D=_,O=v,k=y,A=b,j=x,M=S,t+=16,n-=16;this.h[0]=C,this.h[1]=w,this.h[2]=T,this.h[3]=E,this.h[4]=D,this.h[5]=O,this.h[6]=k,this.h[7]=A,this.h[8]=j,this.h[9]=M},E.prototype.finish=function(e,t){var n=new Uint16Array(10),r,i,a,o;if(this.leftover){for(o=this.leftover,this.buffer[o++]=1;o<16;o++)this.buffer[o]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,o=2;o<10;o++)this.h[o]+=r,r=this.h[o]>>>13,this.h[o]&=8191;for(this.h[0]+=r*5,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,n[0]=this.h[0]+5,r=n[0]>>>13,n[0]&=8191,o=1;o<10;o++)n[o]=this.h[o]+r,r=n[o]>>>13,n[o]&=8191;for(n[9]-=8192,i=(r^1)-1,o=0;o<10;o++)n[o]&=i;for(i=~i,o=0;o<10;o++)this.h[o]=this.h[o]&i|n[o];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,a=this.h[0]+this.pad[0],this.h[0]=a&65535,o=1;o<8;o++)a=(this.h[o]+this.pad[o]|0)+(a>>>16)|0,this.h[o]=a&65535;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},E.prototype.update=function(e,t,n){var r,i;if(this.leftover){for(i=16-this.leftover,i>n&&(i=n),r=0;r<i;r++)this.buffer[this.leftover+r]=e[t+r];if(n-=i,t+=i,this.leftover+=i,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(n>=16&&(i=n-n%16,this.blocks(e,t,i),t+=i,n-=i),n){for(r=0;r<n;r++)this.buffer[this.leftover+r]=e[t+r];this.leftover+=n}};function D(e,t,n,r,i,a){var o=new E(a);return o.update(n,r,i),o.finish(e,t),0}function O(e,t,n,r,i,a){var o=new Uint8Array(16);return D(o,0,n,r,i,a),h(e,t,o,0)}function k(e,t,n,r,i){var a;if(n<32)return-1;for(T(e,0,t,0,n,r,i),D(e,16,e,32,n-32,e),a=0;a<16;a++)e[a]=0;return 0}function A(e,t,n,r,i){var a,o=new Uint8Array(32);if(n<32||(w(o,0,32,r,i),O(t,16,t,32,n-32,o)!==0))return-1;for(T(e,0,t,0,n,r,i),a=0;a<32;a++)e[a]=0;return 0}function j(e,t){var n;for(n=0;n<16;n++)e[n]=t[n]|0}function M(e){var t,n,r=1;for(t=0;t<16;t++)n=e[t]+r+65535,r=Math.floor(n/65536),e[t]=n-r*65536;e[0]+=r-1+37*(r-1)}function N(e,t,n){for(var r,i=~(n-1),a=0;a<16;a++)r=i&(e[a]^t[a]),e[a]^=r,t[a]^=r}function P(e,n){var r,i,a,o=t(),s=t();for(r=0;r<16;r++)s[r]=n[r];for(M(s),M(s),M(s),i=0;i<2;i++){for(o[0]=s[0]-65517,r=1;r<15;r++)o[r]=s[r]-65535-(o[r-1]>>16&1),o[r-1]&=65535;o[15]=s[15]-32767-(o[14]>>16&1),a=o[15]>>16&1,o[14]&=65535,N(s,o,1-a)}for(r=0;r<16;r++)e[2*r]=s[r]&255,e[2*r+1]=s[r]>>8}function F(e,t){var n=new Uint8Array(32),r=new Uint8Array(32);return P(n,e),P(r,t),g(n,0,r,0)}function I(e){var t=new Uint8Array(32);return P(t,e),t[0]&1}function L(e,t){var n;for(n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}function R(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]+n[r]}function z(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]-n[r]}function B(e,t,n){var r,i,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=0,j=0,M=0,N=0,P=0,F=0,I=n[0],L=n[1],R=n[2],z=n[3],B=n[4],V=n[5],H=n[6],U=n[7],W=n[8],G=n[9],K=n[10],ee=n[11],q=n[12],te=n[13],ne=n[14],re=n[15];r=t[0],a+=r*I,o+=r*L,s+=r*R,c+=r*z,l+=r*B,u+=r*V,d+=r*H,f+=r*U,p+=r*W,m+=r*G,h+=r*K,g+=r*ee,_+=r*q,v+=r*te,y+=r*ne,b+=r*re,r=t[1],o+=r*I,s+=r*L,c+=r*R,l+=r*z,u+=r*B,d+=r*V,f+=r*H,p+=r*U,m+=r*W,h+=r*G,g+=r*K,_+=r*ee,v+=r*q,y+=r*te,b+=r*ne,x+=r*re,r=t[2],s+=r*I,c+=r*L,l+=r*R,u+=r*z,d+=r*B,f+=r*V,p+=r*H,m+=r*U,h+=r*W,g+=r*G,_+=r*K,v+=r*ee,y+=r*q,b+=r*te,x+=r*ne,S+=r*re,r=t[3],c+=r*I,l+=r*L,u+=r*R,d+=r*z,f+=r*B,p+=r*V,m+=r*H,h+=r*U,g+=r*W,_+=r*G,v+=r*K,y+=r*ee,b+=r*q,x+=r*te,S+=r*ne,C+=r*re,r=t[4],l+=r*I,u+=r*L,d+=r*R,f+=r*z,p+=r*B,m+=r*V,h+=r*H,g+=r*U,_+=r*W,v+=r*G,y+=r*K,b+=r*ee,x+=r*q,S+=r*te,C+=r*ne,w+=r*re,r=t[5],u+=r*I,d+=r*L,f+=r*R,p+=r*z,m+=r*B,h+=r*V,g+=r*H,_+=r*U,v+=r*W,y+=r*G,b+=r*K,x+=r*ee,S+=r*q,C+=r*te,w+=r*ne,T+=r*re,r=t[6],d+=r*I,f+=r*L,p+=r*R,m+=r*z,h+=r*B,g+=r*V,_+=r*H,v+=r*U,y+=r*W,b+=r*G,x+=r*K,S+=r*ee,C+=r*q,w+=r*te,T+=r*ne,E+=r*re,r=t[7],f+=r*I,p+=r*L,m+=r*R,h+=r*z,g+=r*B,_+=r*V,v+=r*H,y+=r*U,b+=r*W,x+=r*G,S+=r*K,C+=r*ee,w+=r*q,T+=r*te,E+=r*ne,D+=r*re,r=t[8],p+=r*I,m+=r*L,h+=r*R,g+=r*z,_+=r*B,v+=r*V,y+=r*H,b+=r*U,x+=r*W,S+=r*G,C+=r*K,w+=r*ee,T+=r*q,E+=r*te,D+=r*ne,O+=r*re,r=t[9],m+=r*I,h+=r*L,g+=r*R,_+=r*z,v+=r*B,y+=r*V,b+=r*H,x+=r*U,S+=r*W,C+=r*G,w+=r*K,T+=r*ee,E+=r*q,D+=r*te,O+=r*ne,k+=r*re,r=t[10],h+=r*I,g+=r*L,_+=r*R,v+=r*z,y+=r*B,b+=r*V,x+=r*H,S+=r*U,C+=r*W,w+=r*G,T+=r*K,E+=r*ee,D+=r*q,O+=r*te,k+=r*ne,A+=r*re,r=t[11],g+=r*I,_+=r*L,v+=r*R,y+=r*z,b+=r*B,x+=r*V,S+=r*H,C+=r*U,w+=r*W,T+=r*G,E+=r*K,D+=r*ee,O+=r*q,k+=r*te,A+=r*ne,j+=r*re,r=t[12],_+=r*I,v+=r*L,y+=r*R,b+=r*z,x+=r*B,S+=r*V,C+=r*H,w+=r*U,T+=r*W,E+=r*G,D+=r*K,O+=r*ee,k+=r*q,A+=r*te,j+=r*ne,M+=r*re,r=t[13],v+=r*I,y+=r*L,b+=r*R,x+=r*z,S+=r*B,C+=r*V,w+=r*H,T+=r*U,E+=r*W,D+=r*G,O+=r*K,k+=r*ee,A+=r*q,j+=r*te,M+=r*ne,N+=r*re,r=t[14],y+=r*I,b+=r*L,x+=r*R,S+=r*z,C+=r*B,w+=r*V,T+=r*H,E+=r*U,D+=r*W,O+=r*G,k+=r*K,A+=r*ee,j+=r*q,M+=r*te,N+=r*ne,P+=r*re,r=t[15],b+=r*I,x+=r*L,S+=r*R,C+=r*z,w+=r*B,T+=r*V,E+=r*H,D+=r*U,O+=r*W,k+=r*G,A+=r*K,j+=r*ee,M+=r*q,N+=r*te,P+=r*ne,F+=r*re,a+=38*x,o+=38*S,s+=38*C,c+=38*w,l+=38*T,u+=38*E,d+=38*D,f+=38*O,p+=38*k,m+=38*A,h+=38*j,g+=38*M,_+=38*N,v+=38*P,y+=38*F,i=1,r=a+i+65535,i=Math.floor(r/65536),a=r-i*65536,r=o+i+65535,i=Math.floor(r/65536),o=r-i*65536,r=s+i+65535,i=Math.floor(r/65536),s=r-i*65536,r=c+i+65535,i=Math.floor(r/65536),c=r-i*65536,r=l+i+65535,i=Math.floor(r/65536),l=r-i*65536,r=u+i+65535,i=Math.floor(r/65536),u=r-i*65536,r=d+i+65535,i=Math.floor(r/65536),d=r-i*65536,r=f+i+65535,i=Math.floor(r/65536),f=r-i*65536,r=p+i+65535,i=Math.floor(r/65536),p=r-i*65536,r=m+i+65535,i=Math.floor(r/65536),m=r-i*65536,r=h+i+65535,i=Math.floor(r/65536),h=r-i*65536,r=g+i+65535,i=Math.floor(r/65536),g=r-i*65536,r=_+i+65535,i=Math.floor(r/65536),_=r-i*65536,r=v+i+65535,i=Math.floor(r/65536),v=r-i*65536,r=y+i+65535,i=Math.floor(r/65536),y=r-i*65536,r=b+i+65535,i=Math.floor(r/65536),b=r-i*65536,a+=i-1+37*(i-1),i=1,r=a+i+65535,i=Math.floor(r/65536),a=r-i*65536,r=o+i+65535,i=Math.floor(r/65536),o=r-i*65536,r=s+i+65535,i=Math.floor(r/65536),s=r-i*65536,r=c+i+65535,i=Math.floor(r/65536),c=r-i*65536,r=l+i+65535,i=Math.floor(r/65536),l=r-i*65536,r=u+i+65535,i=Math.floor(r/65536),u=r-i*65536,r=d+i+65535,i=Math.floor(r/65536),d=r-i*65536,r=f+i+65535,i=Math.floor(r/65536),f=r-i*65536,r=p+i+65535,i=Math.floor(r/65536),p=r-i*65536,r=m+i+65535,i=Math.floor(r/65536),m=r-i*65536,r=h+i+65535,i=Math.floor(r/65536),h=r-i*65536,r=g+i+65535,i=Math.floor(r/65536),g=r-i*65536,r=_+i+65535,i=Math.floor(r/65536),_=r-i*65536,r=v+i+65535,i=Math.floor(r/65536),v=r-i*65536,r=y+i+65535,i=Math.floor(r/65536),y=r-i*65536,r=b+i+65535,i=Math.floor(r/65536),b=r-i*65536,a+=i-1+37*(i-1),e[0]=a,e[1]=o,e[2]=s,e[3]=c,e[4]=l,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e[9]=m,e[10]=h,e[11]=g,e[12]=_,e[13]=v,e[14]=y,e[15]=b}function V(e,t){B(e,t,t)}function H(e,n){var r=t(),i;for(i=0;i<16;i++)r[i]=n[i];for(i=253;i>=0;i--)V(r,r),i!==2&&i!==4&&B(r,r,n);for(i=0;i<16;i++)e[i]=r[i]}function U(e,n){var r=t(),i;for(i=0;i<16;i++)r[i]=n[i];for(i=250;i>=0;i--)V(r,r),i!==1&&B(r,r,n);for(i=0;i<16;i++)e[i]=r[i]}function W(e,n,r){var i=new Uint8Array(32),a=new Float64Array(80),o,c,l=t(),u=t(),d=t(),f=t(),p=t(),m=t();for(c=0;c<31;c++)i[c]=n[c];for(i[31]=n[31]&127|64,i[0]&=248,L(a,r),c=0;c<16;c++)u[c]=a[c],f[c]=l[c]=d[c]=0;for(l[0]=f[0]=1,c=254;c>=0;--c)o=i[c>>>3]>>>(c&7)&1,N(l,u,o),N(d,f,o),R(p,l,d),z(l,l,d),R(d,u,f),z(u,u,f),V(f,p),V(m,l),B(l,d,l),B(d,u,p),R(p,l,d),z(l,l,d),V(u,l),z(d,f,m),B(l,d,s),R(l,l,f),B(d,d,l),B(l,f,m),B(f,u,a),V(u,p),N(l,u,o),N(d,f,o);for(c=0;c<16;c++)a[c+16]=l[c],a[c+32]=d[c],a[c+48]=u[c],a[c+64]=f[c];var h=a.subarray(32),g=a.subarray(16);return H(h,h),B(g,g,h),P(e,g),0}function G(e,t){return W(e,t,i)}function K(e,t){return n(t,32),G(e,t)}function ee(e,t,n){var i=new Uint8Array(32);return W(i,n,t),b(e,r,i,x)}var q=k,te=A;function ne(e,t,n,r,i,a){var o=new Uint8Array(32);return ee(o,i,a),q(e,t,n,r,o)}function re(e,t,n,r,i,a){var o=new Uint8Array(32);return ee(o,i,a),te(e,t,n,r,o)}var ie=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function ae(e,t,n,r){for(var i=new Int32Array(16),a=new Int32Array(16),o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,k,A,j,M=e[0],N=e[1],P=e[2],F=e[3],I=e[4],L=e[5],R=e[6],z=e[7],B=t[0],V=t[1],H=t[2],U=t[3],W=t[4],G=t[5],K=t[6],ee=t[7],q=0;r>=128;){for(w=0;w<16;w++)T=8*w+q,i[w]=n[T+0]<<24|n[T+1]<<16|n[T+2]<<8|n[T+3],a[w]=n[T+4]<<24|n[T+5]<<16|n[T+6]<<8|n[T+7];for(w=0;w<80;w++)if(o=M,s=N,c=P,l=F,u=I,d=L,f=R,p=z,m=B,h=V,g=H,_=U,v=W,y=G,b=K,x=ee,E=z,D=ee,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=(I>>>14|W<<18)^(I>>>18|W<<14)^(W>>>9|I<<23),D=(W>>>14|I<<18)^(W>>>18|I<<14)^(I>>>9|W<<23),O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,E=I&L^~I&R,D=W&G^~W&K,O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,E=ie[w*2],D=ie[w*2+1],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,E=i[w%16],D=a[w%16],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,S=A&65535|j<<16,C=O&65535|k<<16,E=S,D=C,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=(M>>>28|B<<4)^(B>>>2|M<<30)^(B>>>7|M<<25),D=(B>>>28|M<<4)^(M>>>2|B<<30)^(M>>>7|B<<25),O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,E=M&N^M&P^N&P,D=B&V^B&H^V&H,O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,p=A&65535|j<<16,x=O&65535|k<<16,E=l,D=_,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=S,D=C,O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,l=A&65535|j<<16,_=O&65535|k<<16,N=o,P=s,F=c,I=l,L=u,R=d,z=f,M=p,V=m,H=h,U=g,W=_,G=v,K=y,ee=b,B=x,w%16==15)for(T=0;T<16;T++)E=i[T],D=a[T],O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=i[(T+9)%16],D=a[(T+9)%16],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,S=i[(T+1)%16],C=a[(T+1)%16],E=(S>>>1|C<<31)^(S>>>8|C<<24)^S>>>7,D=(C>>>1|S<<31)^(C>>>8|S<<24)^(C>>>7|S<<25),O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,S=i[(T+14)%16],C=a[(T+14)%16],E=(S>>>19|C<<13)^(C>>>29|S<<3)^S>>>6,D=(C>>>19|S<<13)^(S>>>29|C<<3)^(C>>>6|S<<26),O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,i[T]=A&65535|j<<16,a[T]=O&65535|k<<16;E=M,D=B,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[0],D=t[0],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[0]=M=A&65535|j<<16,t[0]=B=O&65535|k<<16,E=N,D=V,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[1],D=t[1],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[1]=N=A&65535|j<<16,t[1]=V=O&65535|k<<16,E=P,D=H,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[2],D=t[2],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[2]=P=A&65535|j<<16,t[2]=H=O&65535|k<<16,E=F,D=U,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[3],D=t[3],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[3]=F=A&65535|j<<16,t[3]=U=O&65535|k<<16,E=I,D=W,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[4],D=t[4],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[4]=I=A&65535|j<<16,t[4]=W=O&65535|k<<16,E=L,D=G,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[5],D=t[5],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[5]=L=A&65535|j<<16,t[5]=G=O&65535|k<<16,E=R,D=K,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[6],D=t[6],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[6]=R=A&65535|j<<16,t[6]=K=O&65535|k<<16,E=z,D=ee,O=D&65535,k=D>>>16,A=E&65535,j=E>>>16,E=e[7],D=t[7],O+=D&65535,k+=D>>>16,A+=E&65535,j+=E>>>16,k+=O>>>16,A+=k>>>16,j+=A>>>16,e[7]=z=A&65535|j<<16,t[7]=ee=O&65535|k<<16,q+=128,r-=128}return r}function J(e,t,n){var r=new Int32Array(8),i=new Int32Array(8),a=new Uint8Array(256),o,s=n;for(r[0]=1779033703,r[1]=3144134277,r[2]=1013904242,r[3]=2773480762,r[4]=1359893119,r[5]=2600822924,r[6]=528734635,r[7]=1541459225,i[0]=4089235720,i[1]=2227873595,i[2]=4271175723,i[3]=1595750129,i[4]=2917565137,i[5]=725511199,i[6]=4215389547,i[7]=327033209,ae(r,i,t,n),n%=128,o=0;o<n;o++)a[o]=t[s-n+o];for(a[n]=128,n=256-128*(n<112?1:0),a[n-9]=0,p(a,n-8,s/536870912|0,s<<3),ae(r,i,a,n),o=0;o<8;o++)p(e,8*o,r[o],i[o]);return 0}function oe(e,n){var r=t(),i=t(),a=t(),o=t(),s=t(),c=t(),u=t(),d=t(),f=t();z(r,e[1],e[0]),z(f,n[1],n[0]),B(r,r,f),R(i,e[0],e[1]),R(f,n[0],n[1]),B(i,i,f),B(a,e[3],n[3]),B(a,a,l),B(o,e[2],n[2]),R(o,o,o),z(s,i,r),z(c,o,a),R(u,o,a),R(d,i,r),B(e[0],s,c),B(e[1],d,u),B(e[2],u,c),B(e[3],s,d)}function se(e,t,n){var r;for(r=0;r<4;r++)N(e[r],t[r],n)}function ce(e,n){var r=t(),i=t(),a=t();H(a,n[2]),B(r,n[0],a),B(i,n[1],a),P(e,i),e[31]^=I(r)<<7}function Y(e,t,n){var r,i;for(j(e[0],a),j(e[1],o),j(e[2],o),j(e[3],a),i=255;i>=0;--i)r=n[i/8|0]>>(i&7)&1,se(e,t,r),oe(t,e),oe(e,e),se(e,t,r)}function le(e,n){var r=[t(),t(),t(),t()];j(r[0],u),j(r[1],d),j(r[2],o),B(r[3],u,d),Y(e,r,n)}function ue(e,r,i){var a=new Uint8Array(64),o=[t(),t(),t(),t()],s;for(i||n(r,32),J(a,r,32),a[0]&=248,a[31]&=127,a[31]|=64,le(o,a),ce(e,o),s=0;s<32;s++)r[s+32]=e[s];return 0}var de=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function fe(e,t){var n,r,i,a;for(r=63;r>=32;--r){for(n=0,i=r-32,a=r-12;i<a;++i)t[i]+=n-16*t[r]*de[i-(r-32)],n=Math.floor((t[i]+128)/256),t[i]-=n*256;t[i]+=n,t[r]=0}for(n=0,i=0;i<32;i++)t[i]+=n-(t[31]>>4)*de[i],n=t[i]>>8,t[i]&=255;for(i=0;i<32;i++)t[i]-=n*de[i];for(r=0;r<32;r++)t[r+1]+=t[r]>>8,e[r]=t[r]&255}function pe(e){var t=new Float64Array(64),n;for(n=0;n<64;n++)t[n]=e[n];for(n=0;n<64;n++)e[n]=0;fe(e,t)}function me(e,n,r,i){var a=new Uint8Array(64),o=new Uint8Array(64),s=new Uint8Array(64),c,l,u=new Float64Array(64),d=[t(),t(),t(),t()];J(a,i,32),a[0]&=248,a[31]&=127,a[31]|=64;var f=r+64;for(c=0;c<r;c++)e[64+c]=n[c];for(c=0;c<32;c++)e[32+c]=a[32+c];for(J(s,e.subarray(32),r+32),pe(s),le(d,s),ce(e,d),c=32;c<64;c++)e[c]=i[c];for(J(o,e,r+64),pe(o),c=0;c<64;c++)u[c]=0;for(c=0;c<32;c++)u[c]=s[c];for(c=0;c<32;c++)for(l=0;l<32;l++)u[c+l]+=o[c]*a[l];return fe(e.subarray(32),u),f}function he(e,n){var r=t(),i=t(),s=t(),l=t(),u=t(),d=t(),p=t();return j(e[2],o),L(e[1],n),V(s,e[1]),B(l,s,c),z(s,s,e[2]),R(l,e[2],l),V(u,l),V(d,u),B(p,d,u),B(r,p,s),B(r,r,l),U(r,r),B(r,r,s),B(r,r,l),B(r,r,l),B(e[0],r,l),V(i,e[0]),B(i,i,l),F(i,s)&&B(e[0],e[0],f),V(i,e[0]),B(i,i,l),F(i,s)?-1:(I(e[0])===n[31]>>7&&z(e[0],a,e[0]),B(e[3],e[0],e[1]),0)}function ge(e,n,r,i){var a,o=new Uint8Array(32),s=new Uint8Array(64),c=[t(),t(),t(),t()],l=[t(),t(),t(),t()];if(r<64||he(l,i))return-1;for(a=0;a<r;a++)e[a]=n[a];for(a=0;a<32;a++)e[a+32]=i[a];if(J(s,e,r),pe(s),Y(c,l,s),le(l,n.subarray(32)),oe(c,l),ce(o,c),r-=64,g(n,0,o,0)){for(a=0;a<r;a++)e[a]=0;return-1}for(a=0;a<r;a++)e[a]=n[a+64];return r}var _e=32,ve=24,ye=32,be=16,xe=32,Se=32,Ce=32,we=32,Te=32,Ee=ve,De=ye,Oe=be,ke=64,Ae=32,je=64,Me=32,Ne=64;e.lowlevel={crypto_core_hsalsa20:b,crypto_stream_xor:T,crypto_stream:w,crypto_stream_salsa20_xor:S,crypto_stream_salsa20:C,crypto_onetimeauth:D,crypto_onetimeauth_verify:O,crypto_verify_16:h,crypto_verify_32:g,crypto_secretbox:k,crypto_secretbox_open:A,crypto_scalarmult:W,crypto_scalarmult_base:G,crypto_box_beforenm:ee,crypto_box_afternm:q,crypto_box:ne,crypto_box_open:re,crypto_box_keypair:K,crypto_hash:J,crypto_sign:me,crypto_sign_keypair:ue,crypto_sign_open:ge,crypto_secretbox_KEYBYTES:_e,crypto_secretbox_NONCEBYTES:ve,crypto_secretbox_ZEROBYTES:ye,crypto_secretbox_BOXZEROBYTES:be,crypto_scalarmult_BYTES:xe,crypto_scalarmult_SCALARBYTES:Se,crypto_box_PUBLICKEYBYTES:Ce,crypto_box_SECRETKEYBYTES:we,crypto_box_BEFORENMBYTES:Te,crypto_box_NONCEBYTES:Ee,crypto_box_ZEROBYTES:De,crypto_box_BOXZEROBYTES:Oe,crypto_sign_BYTES:ke,crypto_sign_PUBLICKEYBYTES:Ae,crypto_sign_SECRETKEYBYTES:je,crypto_sign_SEEDBYTES:Me,crypto_hash_BYTES:Ne,gf:t,D:c,L:de,pack25519:P,unpack25519:L,M:B,A:R,S:V,Z:z,pow2523:U,add:oe,set25519:j,modL:fe,scalarmult:Y,scalarbase:le};function Pe(e,t){if(e.length!==_e)throw Error(`bad key size`);if(t.length!==ve)throw Error(`bad nonce size`)}function Fe(e,t){if(e.length!==Ce)throw Error(`bad public key size`);if(t.length!==we)throw Error(`bad secret key size`)}function X(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw TypeError(`unexpected type, use Uint8Array`)}function Ie(e){for(var t=0;t<e.length;t++)e[t]=0}e.randomBytes=function(e){var t=new Uint8Array(e);return n(t,e),t},e.secretbox=function(e,t,n){X(e,t,n),Pe(n,t);for(var r=new Uint8Array(ye+e.length),i=new Uint8Array(r.length),a=0;a<e.length;a++)r[a+ye]=e[a];return k(i,r,r.length,t,n),i.subarray(be)},e.secretbox.open=function(e,t,n){X(e,t,n),Pe(n,t);for(var r=new Uint8Array(be+e.length),i=new Uint8Array(r.length),a=0;a<e.length;a++)r[a+be]=e[a];return r.length<32||A(i,r,r.length,t,n)!==0?null:i.subarray(ye)},e.secretbox.keyLength=_e,e.secretbox.nonceLength=ve,e.secretbox.overheadLength=be,e.scalarMult=function(e,t){if(X(e,t),e.length!==Se)throw Error(`bad n size`);if(t.length!==xe)throw Error(`bad p size`);var n=new Uint8Array(xe);return W(n,e,t),n},e.scalarMult.base=function(e){if(X(e),e.length!==Se)throw Error(`bad n size`);var t=new Uint8Array(xe);return G(t,e),t},e.scalarMult.scalarLength=Se,e.scalarMult.groupElementLength=xe,e.box=function(t,n,r,i){var a=e.box.before(r,i);return e.secretbox(t,n,a)},e.box.before=function(e,t){X(e,t),Fe(e,t);var n=new Uint8Array(Te);return ee(n,e,t),n},e.box.after=e.secretbox,e.box.open=function(t,n,r,i){var a=e.box.before(r,i);return e.secretbox.open(t,n,a)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(Ce),t=new Uint8Array(we);return K(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(X(e),e.length!==we)throw Error(`bad secret key size`);var t=new Uint8Array(Ce);return G(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=Ce,e.box.secretKeyLength=we,e.box.sharedKeyLength=Te,e.box.nonceLength=Ee,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(X(e,t),t.length!==je)throw Error(`bad secret key size`);var n=new Uint8Array(ke+e.length);return me(n,e,e.length,t),n},e.sign.open=function(e,t){if(X(e,t),t.length!==Ae)throw Error(`bad public key size`);var n=new Uint8Array(e.length),r=ge(n,e,e.length,t);if(r<0)return null;for(var i=new Uint8Array(r),a=0;a<i.length;a++)i[a]=n[a];return i},e.sign.detached=function(t,n){for(var r=e.sign(t,n),i=new Uint8Array(ke),a=0;a<i.length;a++)i[a]=r[a];return i},e.sign.detached.verify=function(e,t,n){if(X(e,t,n),t.length!==ke)throw Error(`bad signature size`);if(n.length!==Ae)throw Error(`bad public key size`);var r=new Uint8Array(ke+e.length),i=new Uint8Array(ke+e.length),a;for(a=0;a<ke;a++)r[a]=t[a];for(a=0;a<e.length;a++)r[a+ke]=e[a];return ge(i,r,r.length,n)>=0},e.sign.keyPair=function(){var e=new Uint8Array(Ae),t=new Uint8Array(je);return ue(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(X(e),e.length!==je)throw Error(`bad secret key size`);for(var t=new Uint8Array(Ae),n=0;n<t.length;n++)t[n]=e[32+n];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(X(e),e.length!==Me)throw Error(`bad seed size`);for(var t=new Uint8Array(Ae),n=new Uint8Array(je),r=0;r<32;r++)n[r]=e[r];return ue(t,n,!0),{publicKey:t,secretKey:n}},e.sign.publicKeyLength=Ae,e.sign.secretKeyLength=je,e.sign.seedLength=Me,e.sign.signatureLength=ke,e.hash=function(e){X(e);var t=new Uint8Array(Ne);return J(t,e,e.length),t},e.hash.hashLength=Ne,e.verify=function(e,t){return X(e,t),e.length===0||t.length===0||e.length!==t.length?!1:m(e,0,t,0,e.length)===0},e.setPRNG=function(e){n=e},(function(){var t=typeof self<`u`?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){var n=65536;e.setPRNG(function(e,r){var i,a=new Uint8Array(r);for(i=0;i<r;i+=n)t.getRandomValues(a.subarray(i,i+Math.min(r-i,n)));for(i=0;i<r;i++)e[i]=a[i];Ie(a)})}else typeof require<`u`&&(t=fr(),t&&t.randomBytes&&e.setPRNG(function(e,n){var r,i=t.randomBytes(n);for(r=0;r<n;r++)e[r]=i[r];Ie(i)}))})()})(t!==void 0&&t.exports?t.exports:self.nacl=self.nacl||{})})),mr=s(((e,t)=>{(function(e,n){t!==void 0&&t.exports?t.exports=n():(e.nacl||={},e.nacl.util=n())})(e,function(){var e={};function t(e){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e))throw TypeError(`invalid encoding`)}return e.decodeUTF8=function(e){if(typeof e!=`string`)throw TypeError(`expected string`);var t,n=unescape(encodeURIComponent(e)),r=new Uint8Array(n.length);for(t=0;t<n.length;t++)r[t]=n.charCodeAt(t);return r},e.encodeUTF8=function(e){var t,n=[];for(t=0;t<e.length;t++)n.push(String.fromCharCode(e[t]));return decodeURIComponent(escape(n.join(``)))},typeof atob>`u`?Buffer.from===void 0?(e.encodeBase64=function(e){return new Buffer(e).toString(`base64`)},e.decodeBase64=function(e){return t(e),new Uint8Array(Array.prototype.slice.call(new Buffer(e,`base64`),0))}):(e.encodeBase64=function(e){return Buffer.from(e).toString(`base64`)},e.decodeBase64=function(e){return t(e),new Uint8Array(Array.prototype.slice.call(Buffer.from(e,`base64`),0))}):(e.encodeBase64=function(e){var t,n=[],r=e.length;for(t=0;t<r;t++)n.push(String.fromCharCode(e[t]));return btoa(n.join(``))},e.decodeBase64=function(e){t(e);var n,r=atob(e),i=new Uint8Array(r.length);for(n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}),e})})),hr=u(pr()),gr=u(mr()),_r=class{#serverUrl=null;#socket=null;#self=null;constructor(e){this.#serverUrl=e}init(e){this.#self={id:e.id,publicKey:gr.decodeBase64(e.publicKey),privateKey:gr.decodeBase64(e.privateKey)}}start(e){this.#socket=dr(this.#serverUrl,{transports:[`websocket`]}),this.#socket.on(`connect`,()=>{this.#socket.emit(`hello`,this.getSelfPublicKey())}),this.#socket.on(`msg`,async({from:t,data:n})=>{let r=gr.decodeBase64(t),i=this.#decrypt(r,n);if(!i)return;let a=e[i.type];a&&await a(i.payload,t)})}stop(){this.#socket&&=(this.#socket.disconnect(),null)}send(e,t,n){let r=gr.decodeBase64(e),i=this.#encrypt(r,{type:t,payload:n});this.#socket.emit(`msg`,{to:e,data:i})}getSelfPublicKey(){return gr.encodeBase64(this.#self.publicKey)}getSelfId(){return this.#self.id}#encrypt(e,t){let n=hr.default.randomBytes(24),r=gr.decodeUTF8(JSON.stringify(t)),i=hr.default.box(r,n,e,this.#self.privateKey);return{nonce:gr.encodeBase64(n),box:gr.encodeBase64(i)}}#decrypt(e,t){let n=gr.decodeBase64(t.nonce),r=gr.decodeBase64(t.box),i=hr.default.box.open(r,n,e,this.#self.privateKey);return i?JSON.parse(gr.encodeUTF8(i)):null}static generateKeyPair(){let e=hr.default.box.keyPair();return{publicKey:gr.encodeBase64(e.publicKey),privateKey:gr.encodeBase64(e.secretKey)}}};G(),bt(),q(),$e();var vr=class{#db;#types;#memory;#worker;#engine;#web;constructor(e){this.#worker=e}get db(){return this.#db}get memory(){return this.#memory}get types(){return this.#types}get engine(){return this.#engine}get web(){return this.#web}async init(){await yt.init(),this.#types=new At,this.#memory=new kt(this.#types),this.#db=new W(Xe),this.#engine=new Ot(this),this.#web=new _r(Qe),await this.#createGlobalSettings();let e=await this.#createSelf();this.#web.init(e)}async#createGlobalSettings(){await this.db.getById(U.APP,`global`)||await this.db.put(U.APP,{id:`global`,workspaces:[],language:``,theme:``,devMode:!1,autoConnect:!0})}async#createSelf(){let e=await this.db.getById(U.SELF,`self`);if(!e){let t=_r.generateKeyPair();e={id:`self`,peerName:`Peer-`+ee(),...t,createdAt:Date.now()},await this.db.put(U.SELF,e)}return e}send(e,t){this.#worker.send(e,t)}onIO(e,t){this.#worker.send(`updateIO`,{id:e,io:t})}onError(e,t){this.#worker.send(`error`,{id:e,err:t})}},yr=class{#scope;#manager;#handlers;constructor(e=self){this.#scope=e,this.#manager=new vr(this),this.#handlers={}}setHandlers(e={}){for(let[t,n]of Object.entries(e))typeof n==`function`&&(this.#handlers[t]=n)}async start(){this.#scope.onmessage=e=>this.#dispatch(e.data,this.#manager),await this.#manager.init(),this.#post({type:`initialized`})}send(e,t){this.#post({type:e,payload:t})}#post(e){this.#scope.postMessage(e)}async#dispatch({type:e,payload:t,requestId:n}){let r=this.#handlers[e];if(!r){this.#post({requestId:n,error:`Unknown command: ${e}`});return}try{let i=await r(t,this.#manager);if(i===null)return;n?this.#post({type:e,requestId:n,payload:i}):this.#post({type:e,payload:i})}catch(t){let r=t?.message??String(t);n?this.#post({requestId:n,error:r}):this.#post({type:`error`,payload:{message:r,cmd:e}})}}};G(),Et(),bt();var br={async getSettings(e,{db:t}){return await t.getById(U.APP,`global`)},async getTypes(e,{types:t}){return t.list()},async getSearchables(e,{db:t}){let n=await t.getAll(U.GRAPHS),r=await t.getAll(U.DATASETS),i=await t.getAll(U.PEERS),a=new Set,o=e=>Array.isArray(e)?e.map(e=>e.toLowerCase().trim()).filter(Boolean):[],s=Object.values(yt.safe).map(e=>{let t=o(e.tags);return t.forEach(e=>a.add(e)),{id:e.id,name:e.name??``,description:e.description??``,tags:t,settings:e.settings??[],type:`primitive`}}),c=n.map(e=>{let t=o(e.tags);return t.forEach(e=>a.add(e)),{id:e.id,name:e.name??``,description:e.description??``,tags:t,type:`graph`}}),l=r.map(e=>{let t=o(e.tags);return t.forEach(e=>a.add(e)),{id:e.id,name:e.name??``,description:e.description??``,columns:e.columns,tags:t,type:`dataset`}}),u=i.map(e=>{let t=o(e.tags);return t.forEach(e=>a.add(e)),{id:e.id,name:e.peerName??``,description:``,tags:t,type:`peer`}});return{primitives:s,graphs:c,datasets:l,peers:u,tags:Array.from(a).sort()}}};G(),q();var xr={async createDataset(e,{db:t}){let n={name:`Dataset-`+ee(),columns:[{name:`Column 1`,type:`string`},{name:`Column 2`,type:`string`},{name:`Column 3`,type:`string`}],tags:[]},r=await t.add(U.DATASETS,n),i=[{datasetId:r,row:0,column:0,value:`Alice`},{datasetId:r,row:0,column:1,value:`Engineer`},{datasetId:r,row:0,column:2,value:`Active`},{datasetId:r,row:1,column:0,value:`Bob`},{datasetId:r,row:1,column:1,value:`Designer`},{datasetId:r,row:1,column:2,value:`Inactive`},{datasetId:r,row:2,column:0,value:`Charlie`},{datasetId:r,row:2,column:1,value:`Manager`},{datasetId:r,row:2,column:2,value:`Active`}];return await t.addMany(U.CELLS,i,!1),{id:r,...n}},getDataset(e,{db:t}){return Sr(e,t)},async getCells({datasetId:e,offset:t=0,limit:n=100},{db:r}){return await r.query(U.CELLS,r=>r.where(`[datasetId+row]`).between([e,t],[e,t+n-1]).toArray())},updateCell({datasetId:e,row:t,column:n,value:r},{db:i}){return i.put(U.CELLS,{datasetId:e,row:t,column:n,value:r}),{row:t,column:n,value:r}},removeRow(){},async updateColumn({id:e,index:t,data:n},{db:r}){let i=await Sr(e,r);return Object.assign(i.columns[t],n),await Cr(e,i,r),i},async updateDataset(e,{db:t}){let n=await Sr(e.id,t);return Object.assign(n,e),await Cr(e.id,n,t),n}};function Sr(e,t){return t.getById(U.DATASETS,e)}function Cr(e,t,n){return n.update(U.DATASETS,e,t)}$e(),St(),wt(),Et();var wr={async createGraph(e,t){return await Tt.create(e,t)},async getGraph(e,t){let{engine:n}=t,r=n.getGraph(e);if(!r){let i=await Tt.load(e,t);r=n.registerGraph(i)}return r.toJSON()},async updateGraph({id:e,data:t},n){let r=await Tt.load(e,n);return Object.assign(r,t),await Tt.update(e,r,n),r},async removeGraph(e,t){return await t.engine.removeGraph(e),await Tt.delete(e,t),e},async unloadGraph(e,t){let{engine:n}=t;return await n.removeGraph(e),e},async startRunner(e,t){let{engine:n}=t;return{...(await n.startRunner(e)).state,graphId:e}},async stopRunner(e,t){let{engine:n}=t;return{...(await n.stopRunner(e)).state,graphId:e}},async stepRunner({graphId:e,eventName:t,inputs:n={}},r){let{engine:i}=r;return{...(await i.stepRunner(e,t,n)).state,graphId:e}},async addComponent({parentId:e,order:t=0,layer:n=0,typeId:r=Ze.EMPTY,values:i={}},a){let o=await xt.add({parentId:e,order:t,layer:n,typeId:r,values:i},a);return a.engine.addComponent(e,o),o},async removeComponent({parentId:e,componentId:t},n){let r=await xt.getById(t,n);await xt.remove(r,n);let i=await Ct.removeByComponent(t,n);n.engine.removeComponent(e,t);for(let t of i)n.engine.removeConnection(e,t);return{component:t,connections:i}},async convertComponent({parentId:e,componentId:t,typeId:n,values:r={}},i){let a=await xt.getById(t,i);return a.typeId=n,await xt.update(t,{typeId:n,values:{...a.values,...r}},i),xt.populate(a),i.engine.removeComponent(e,t),i.engine.addComponent(e,a),a},async cloneComponent({parentId:e,componentId:t,layer:n,order:r},i){let a=await xt.getById(t,i);return await xt.add({parentId:e,order:r,layer:n,typeId:a.typeId,values:a.values},i)},async addConnection({parentId:e,fromComponentId:t,fromGateId:n,toComponentId:r,toGateId:i},a){let o=Ct.add({parentId:e,fromComponentId:t,fromGateId:n,toComponentId:r,toGateId:i},a);return a.engine.addConnection(e,o),o},async removeConnection({parentId:e,id:t},n){Ct.remove(t,n),n.engine.removeConnection(e,t)},async moveComponent({id:e,layer:t,order:n},r){return await xt.update(e,{layer:t,order:n},r),{id:e,layer:t,order:n}},async updateComponentSetting({parentId:e,id:t,settingId:n,value:r},i){let a=await xt.updateSetting({id:t,settingId:n,value:r},i);return i.engine.updateComponentSetting(e,t,n,r),a},trigger({parentId:e,componentId:t,eventName:n},{engine:r}){r.trigger(e,t,n)}};G(),bt();async function Tr(e,t,n){let r={graphs:new Map,components:new Map,connections:new Map,datasets:new Map,cells:new Map};if(t===U.GRAPHS)await Er(e,n,r);else if(t===U.DATASETS)await Dr(e,n,r);else throw Error(`Only graphs and datasets can be exported`);return{version:1,exportedAt:Date.now(),root:{resource:t,id:n},resources:{graphs:[...r.graphs.values()],components:[...r.components.values()],connections:[...r.connections.values()],datasets:[...r.datasets.values()],cells:[...r.cells.values()]}}}async function Er(e,t,n){if(n.graphs.has(t))return;let r=await e.getById(U.GRAPHS,t);if(!r)return;n.graphs.set(t,r);let i=await e.where(U.COMPONENTS,`parentId`,t);for(let t of i)await Or(e,t.id,n);(await e.where(U.CONNECTIONS,`parentId`,t)).forEach(e=>n.connections.set(e.id,e))}async function Dr(e,t,n){if(n.datasets.has(t))return;let r=await e.getById(U.DATASETS,t);r&&(n.datasets.set(t,r),(await e.where(U.CELLS,`datasetId`,t)).forEach(e=>{let t=`${e.datasetId}:${e.row}:${e.column}`;n.cells.set(t,e)}))}async function Or(e,t,n){if(n.components.has(t))return;let r=await e.getById(U.COMPONENTS,t);if(!r)return;n.components.set(t,r);let i=yt.get(r.typeId);if(!i)return;let a=r.values||{};for(let t of i.settings||[]){let r=t.id,i=t.type,o=a[r];o&&(i===`dataset`&&await Dr(e,o,n),i===`graph`&&await Er(e,o,n))}}async function kr(e,t){let n=Date.now(),r=e=>({...e,updatedAt:n,createdAt:e.createdAt||n}),i=t.resources.graphs.map(r),a=t.resources.components.map(r),o=t.resources.connections.map(r),s=t.resources.datasets.map(r),c=t.resources.cells.map(r);return await e.transaction([U.GRAPHS,U.COMPONENTS,U.CONNECTIONS,U.DATASETS,U.CELLS],async(e,t,n,r,l)=>{i.length&&await e.bulkPut(i),a.length&&await t.bulkPut(a),o.length&&await n.bulkPut(o),s.length&&await r.bulkPut(s),c.length&&await l.bulkPut(c)}),{rootId:t.root.id}}G();var Ar={startWeb(e,t){let{web:n,db:r}=t;n.start({async connect(e,t){await Nr(e,r);let i=await Mr(r);n.send(t,`info`,{publicKey:i.publicKey,peerName:i.peerName})},async info(e){await Nr(e,r)},async message(e,i){console.log(e);let a=await r.where(U.PEERS,`publicKey`,i);if(!a.length)return;let o=a[0],s={id:r.createId(),fromId:o.id,toId:n.getSelfId(),type:e.type,content:e.content,sentAt:Date.now()};await r.put(U.MESSAGES,s),t.send(`addMessage`,s)},async requestResource({type:e,id:t},i){let a;e===`graph`?a=U.GRAPHS:e===`dataset`&&(a=U.DATASETS);let o=await Tr(r,a,t);n.send(i,`resource`,{type:e,data:o})},async resource({data:e}){await kr(r,e)}})},stopWeb(e,{web:t}){t.stop()},async connectPeer(e,{web:t,db:n}){let r=await Mr(n);await Nr({publicKey:e},n),console.log(e),t.send(e,`connect`,{publicKey:r.publicKey,peerName:r.peerName})},async getPeer(e,{db:t}){return await t.getById(U.PEERS,e)},async getMessages(e,{db:t}){let n=await t.where(U.MESSAGES,`fromId`,e),r=await t.where(U.MESSAGES,`toId`,e);return[...n,...r].sort((e,t)=>e.sentAt-t.sentAt)},async getSelf(e,{db:t}){return await Mr(t)},async sendMessage({toId:e,toPublicKey:t,type:n,content:r},{web:i,db:a}){return await jr(e,t,n,r,i,a)},async shareResource({toId:e,toPublicKey:t,resource:n},{web:r,db:i}){return await jr(e,t,`resource`,n,r,i)},async requestResource({publicKey:e,resource:t},{web:n}){n.send(e,`requestResource`,t)},async updateSelf(e,{db:t}){return console.log(e),await t.update(U.SELF,`self`,e),e}};async function jr(e,t,n,r,i,a){let o={id:a.createId(),fromId:i.getSelfId(),toId:e,type:n,content:r,sentAt:Date.now()};return await a.put(U.MESSAGES,o),i.send(t,`message`,{type:n,content:r}),o}async function Mr(e){return await e.getById(U.SELF,`self`)}async function Nr(e,t){let n=await t.where(U.PEERS,`publicKey`,e.publicKey);if(!n.length){let n=t.createId();await t.put(U.PEERS,{id:n,...e,createdAt:Date.now(),updatedAt:Date.now()});return}let r=n[0].id;await t.update(U.PEERS,r,{...e,updatedAt:Date.now()})}var Pr={...xr,...br,...wr,...Ar};let Fr=new yr(self);Fr.setHandlers(Pr),Fr.start()})();